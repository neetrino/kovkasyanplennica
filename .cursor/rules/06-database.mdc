---
description: ’è’æ’µ’°’¨’∂’•÷Ä’´ ’¢’°’¶’°’µ’´ ’°’∑’≠’°’ø’°’∂÷Ñ’´ ’Ø’°’∂’∏’∂’∂’•÷Ä÷â ‘ø’´÷Ä’°’º’æ’∏÷Ç’¥ ’ß ’Ω’≠’•’¥’°’∂’•÷Ä’´’∂, ’¥’´’£÷Ä’°÷Å’´’°’∂’•÷Ä’´’∂ ÷á ’∞’°÷Ä÷Å’∏÷Ç’¥’∂’•÷Ä’´’∂÷â
globs: ["**/prisma/**", "**/*.prisma", "**/db/**", "**/database/**", "**/migrations/**"]
alwaysApply: false
---

# ’è’é’Ö‘±‘º’Ü‘µ’ê‘ª ‘≤‘±‘∂‘±’Ö‘ª ‘±’á‘Ω‘±’è‘±’Ü’î‘ª ‘ø‘±’Ü’à’Ü’Ü‘µ’ê

> PostgreSQL ’∏÷Ä’∫’•’Ω ’∞’´’¥÷Ñ÷â Prisma ’∏÷Ä’∫’•’Ω ORM÷â ‘±’∂’æ’ø’°’∂’£’∏÷Ç’©’µ’∏÷Ç’∂ ÷á ’°÷Ä’ø’°’§÷Ä’∏’≤’°’Ø’°’∂’∏÷Ç’©’µ’∏÷Ç’∂÷â

---

## üéØ ’Ä‘ª’Ñ’Ü‘±‘ø‘±’Ü ’ç‘ø‘∂‘≤’à’í’Ü’î’Ü‘µ’ê

1. **PostgreSQL ’¨’º’•’¨’µ’°’µ’∂** ‚Äî 95% ’∂’°’≠’°’£’Æ’•÷Ä’´ ’∞’°’¥’°÷Ä
2. **Prisma ORM** ‚Äî raw SQL ’°’º’°’∂÷Å ’°’∂’∞÷Ä’°’™’•’∑’ø’∏÷Ç’©’µ’°’∂ ’π÷Ö’£’ø’°’£’∏÷Ä’Æ’•’¨
3. **’Ñ’´’£÷Ä’°÷Å’´’°’∂’•÷Ä ’∫’°÷Ä’ø’°’§’´÷Ä** ‚Äî ’¢’∏’¨’∏÷Ä ÷É’∏÷É’∏’≠’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’® ’¥’´’£÷Ä’°÷Å’´’°’∂’•÷Ä’∏’æ
4. **‘ª’∂’§’•÷Ñ’Ω’∂’•÷Ä’® ’¥’ø’°’Æ’æ’°’Æ** ‚Äî ’¢’∏’¨’∏÷Ä ’∞’°’≥’°’≠’°’Ø’´ ’∞’°÷Ä÷Å’∏÷Ç’¥’∂’•÷Ä’´ ’∞’°’¥’°÷Ä

---

## üóÑÔ∏è ’è’é’Ö‘±‘º’Ü‘µ’ê‘ª ‘≤‘±‘∂‘±’Ö‘ª ‘∏’Ü’è’ê’à’í‘π’Ö’à’í’Ü

### ‘µ÷Ä’¢ ’´’∂’π ÷Ö’£’ø’°’£’∏÷Ä’Æ’•’¨

| ’è’æ’µ’°’¨’∂’•÷Ä’´ ’¢’°’¶’° | ‘µ÷Ä’¢ ÷Ö’£’ø’°’£’∏÷Ä’Æ’•’¨ | ‘µ÷Ä’¢ ’â÷Ö’£’ø’°’£’∏÷Ä’Æ’•’¨ |
|-----------------|-----------------|-------------------|
| **PostgreSQL** | 95% ’∂’°’≠’°’£’Æ’•÷Ä, ACID, ’¢’°÷Ä’§ ’∞’°÷Ä÷Å’∏÷Ç’¥’∂’•÷Ä | ’á’°’ø ’∫’°÷Ä’¶ ’∂’°’≠’°’£’Æ’•÷Ä |
| **MongoDB** | ’ì’°’Ω’ø’°’©’≤’©’•÷Ä, ’≥’Ø’∏÷Ç’∂ ’Ω’≠’•’¥’°, ’∫÷Ä’∏’ø’∏’ø’´’∫’∂’•÷Ä | ’è÷Ä’°’∂’¶’°’Ø÷Å’´’°’∂’•÷Ä, ’ø’æ’µ’°’¨’∂’•÷Ä’´ ’Ø’°’∫’•÷Ä |
| **SQLite** | ’ä÷Ä’∏’ø’∏’ø’´’∫’∂’•÷Ä, ’∂’•÷Ä’Ø’°’º’∏÷Ç÷Å’æ’°’Æ ’∞’°’æ’•’¨’æ’°’Æ’∂’•÷Ä | Production web-’∞’°’æ’•’¨’æ’°’Æ’∂’•÷Ä |
| **Redis** | Cache, ’Ω’•’Ω’´’°’∂’•÷Ä, ’∞’•÷Ä’©’•÷Ä | ’Ä’´’¥’∂’°’Ø’°’∂ ’∫’°’∞’∏÷Å |

### ’ç’ø’°’∂’§’°÷Ä’ø stack

```
Production:
‚îú‚îÄ‚îÄ PostgreSQL 15+ ‚Äî ’∞’´’¥’∂’°’Ø’°’∂ ‘≤‘¥
‚îú‚îÄ‚îÄ Redis 7+ ‚Äî cache ÷á ’∞’•÷Ä’©’•÷Ä
‚îî‚îÄ‚îÄ (’®’∂’ø÷Ä’∏’æ’´) Elasticsearch ‚Äî ’°’¥’¢’∏’≤’ª’°’ø’•÷Ñ’Ω’ø ’∏÷Ä’∏’∂’∏÷Ç’¥
```

---

## üìù PRISMA SCHEMA

### schema.prisma-’´ ’Ø’°’º’∏÷Ç÷Å’æ’°’Æ÷Ñ

```prisma
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==========================================
// ’ï‘≥’è‘±’è‘ª’ê’à’Ç’Ü‘µ’ê ‘µ’é ’Ü’é‘ª’ê‘±‘≥’ê’à’í’Ñ
// ==========================================

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  role      UserRole @default(USER)
  isActive  Boolean  @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // ‘ø’°’∫’•÷Ä (relations)
  orders    Order[]
  sessions  Session[]
  
  @@index([email])
  @@index([role, isActive])
  @@map("users")
}

enum UserRole {
  USER
  ADMIN
  MANAGER
}

model Session {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([token])
  @@index([userId])
  @@map("sessions")
}

// ==========================================
// ‘±’ä’ê‘±’Ü’î’Ü‘µ’ê ‘µ’é ‘ø‘±’è‘µ‘≥’à’ê‘ª‘±’Ü‘µ’ê
// ==========================================

model Category {
  id          String  @id @default(cuid())
  slug        String  @unique
  name        String
  description String?
  parentId    String?
  sortOrder   Int     @default(0)
  isActive    Boolean @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // ‘ø’°’∫’•÷Ä
  parent   Category?  @relation("CategoryTree", fields: [parentId], references: [id])
  children Category[] @relation("CategoryTree")
  products Product[]
  
  @@index([slug])
  @@index([parentId])
  @@index([isActive, sortOrder])
  @@map("categories")
}

model Product {
  id          String  @id @default(cuid())
  slug        String  @unique
  sku         String? @unique
  name        String
  description String?
  price       Int     // ‘≥’´’∂ ’Ø’∏’∫’•’Ø’∂’•÷Ä’∏’æ
  comparePrice Int?   // ’Ä’´’∂ ’£’´’∂ ’¶’•’≤’π’´ ’∞’°’¥’°÷Ä
  stock       Int     @default(0)
  categoryId  String
  isActive    Boolean @default(true)
  isFeatured  Boolean @default(false)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // ‘ø’°’∫’•÷Ä
  category   Category    @relation(fields: [categoryId], references: [id])
  variants   Variant[]
  images     Image[]
  orderItems OrderItem[]
  
  @@index([slug])
  @@index([sku])
  @@index([categoryId])
  @@index([isActive, isFeatured])
  @@index([price])
  @@map("products")
}

model Variant {
  id        String @id @default(cuid())
  productId String
  sku       String @unique
  name      String // "‘ø’°÷Ä’¥’´÷Ä, L"
  price     Int?   // ’ç’•÷É’°’Ø’°’∂ ’£’´’∂ ’Ø’°’¥ null = ’°’∫÷Ä’°’∂÷Ñ’´ ’£’´’∂
  stock     Int    @default(0)
  
  // ‘±’ø÷Ä’´’¢’∏÷Ç’ø’∂’•÷Ä ’∏÷Ä’∫’•’Ω JSON
  attributes Json @default("{}")
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  product    Product     @relation(fields: [productId], references: [id], onDelete: Cascade)
  orderItems OrderItem[]
  
  @@index([productId])
  @@index([sku])
  @@map("variants")
}

model Image {
  id        String @id @default(cuid())
  productId String
  url       String
  alt       String?
  sortOrder Int    @default(0)
  
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@index([productId])
  @@map("images")
}

// ==========================================
// ’ä‘±’è’é‘µ’ê’Ü‘µ’ê
// ==========================================

model Order {
  id          String      @id @default(cuid())
  number      String      @unique // ORD-2024-00001
  userId      String?
  status      OrderStatus @default(PENDING)
  
  // ‘≥’∏÷Ç’¥’°÷Ä’∂’•÷Ä ’Ø’∏’∫’•’Ø’∂’•÷Ä’∏’æ
  subtotal    Int
  discount    Int         @default(0)
  shipping    Int         @default(0)
  total       Int
  
  // ‘±’º’°÷Ñ’¥’°’∂ ’ø’æ’µ’°’¨’∂’•÷Ä
  shippingAddress Json
  billingAddress  Json?
  
  // ‘ø’∏’∂’ø’°’Ø’ø
  email       String
  phone       String
  
  // ’Ñ’•’ø’°
  notes       String?
  metadata    Json        @default("{}")
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  // ‘ø’°’∫’•÷Ä
  user        User?       @relation(fields: [userId], references: [id])
  items       OrderItem[]
  payments    Payment[]
  events      OrderEvent[]
  
  @@index([number])
  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("orders")
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

model OrderItem {
  id        String @id @default(cuid())
  orderId   String
  productId String
  variantId String?
  
  name      String // ’ä’°’∞’∫’°’∂’∏÷Ç’¥ ’•’∂÷Ñ ’∫’°’ø’æ’•÷Ä’´ ’∫’°’∞’´’∂
  sku       String
  price     Int    // ‘≥’´’∂ ’∫’°’ø’æ’•÷Ä’´ ’∫’°’∞’´’∂
  quantity  Int
  total     Int    // price * quantity
  
  order   Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product  @relation(fields: [productId], references: [id])
  variant Variant? @relation(fields: [variantId], references: [id])
  
  @@index([orderId])
  @@map("order_items")
}

model OrderEvent {
  id        String   @id @default(cuid())
  orderId   String
  type      String   // status_changed, payment_received, note_added
  data      Json     @default("{}")
  createdAt DateTime @default(now())
  createdBy String?  // User ID ’Ø’°’¥ 'system'
  
  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  @@index([orderId])
  @@index([type])
  @@map("order_events")
}

model Payment {
  id            String        @id @default(cuid())
  orderId       String
  provider      String        // stripe, idram, arca
  externalId    String?       @unique
  status        PaymentStatus @default(PENDING)
  amount        Int
  currency      String        @default("AMD")
  metadata      Json          @default("{}")
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  order Order @relation(fields: [orderId], references: [id])
  
  @@index([orderId])
  @@index([externalId])
  @@index([status])
  @@map("payments")
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}
```

---

## üîß ’ç‘Ω‘µ’Ñ‘±’Ö‘ª ‘ø‘±’Ü’à’Ü’Ü‘µ’ê

### ‘±’∂’æ’°’∂’°’æ’∏÷Ä’∏÷Ç’¥

```prisma
// ‚úÖ ’É‘ª’á’è
model User { ... }           // PascalCase ’¥’∏’§’•’¨’∂’•÷Ä’´ ’∞’°’¥’°÷Ä
model OrderItem { ... }      // PascalCase ’¢’°’≤’°’§÷Ä’µ’°’¨

// ‘¥’°’∑’ø’•÷Ä ‚Äî camelCase
firstName String
createdAt DateTime
isActive  Boolean

// Enum ‚Äî UPPER_SNAKE ’°÷Ä’™’•÷Ñ’∂’•÷Ä’´ ’∞’°’¥’°÷Ä
enum OrderStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

// ‘±’≤’µ’∏÷Ç’Ω’°’Ø’∂’•÷Ä ‚Äî snake_case @@map-’∏’æ
model OrderItem {
  ...
  @@map("order_items")
}
```

### ID ’º’°’¶’¥’°’æ’°÷Ä’∏÷Ç’©’µ’∏÷Ç’∂

```prisma
// ‚úÖ CUID ‚Äî ’≠’∏÷Ä’∞’∏÷Ç÷Ä’§ (’Ø’°÷Ä’≥ UUID-’´÷Å, ’§’°’Ω’°’æ’∏÷Ä’•’¨’´)
id String @id @default(cuid())

// ‚úÖ UUID ‚Äî ’•÷Ä’¢ ’∞’°’¥’°’ø’•’≤’•’¨’´’∏÷Ç’©’µ’∏÷Ç’∂ ’ß ’∫’•’ø÷Ñ
id String @id @default(uuid())

// ‚ö†Ô∏è Auto-increment ‚Äî ’¥’´’°’µ’∂ ’∂’•÷Ä÷Ñ’´’∂ ’°’≤’µ’∏÷Ç’Ω’°’Ø’∂’•÷Ä’´ ’∞’°’¥’°÷Ä
id Int @id @default(autoincrement())
```

### ’ä’°÷Ä’ø’°’§’´÷Ä ’§’°’∑’ø’•÷Ä

```prisma
// ‚úÖ ’Ñ’´’∑’ø ’°’æ’•’¨’°÷Å÷Ä’∏÷Ç’õ timestamps
model Entity {
  id        String   @id @default(cuid())
  // ... ’§’°’∑’ø’•÷Ä
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

---

## üìä ‘ª’Ü‘¥‘µ’î’ç’Ü‘µ’ê

### ‘µ÷Ä’¢ ’°’æ’•’¨’°÷Å’∂’•’¨ ’´’∂’§’•÷Ñ’Ω’∂’•÷Ä

```prisma
// ‚úÖ ‘¥’°’∑’ø’•÷Ä ’∏÷Ä’∏’∂’¥’°’∂ ’∞’°’¥’°÷Ä
@@index([email])
@@index([slug])

// ‚úÖ ‘¥’°’∑’ø’•÷Ä ÷Ü’´’¨’ø÷Ä’°÷Å’´’°’µ’´ ’∞’°’¥’°÷Ä
@@index([status])
@@index([isActive])
@@index([categoryId])

// ‚úÖ ‘≤’°’≤’°’§÷Ä’µ’°’¨ ’´’∂’§’•÷Ñ’Ω’∂’•÷Ä ’∞’°’≥’°’≠’°’Ø’´ ’∞’°÷Ä÷Å’∏÷Ç’¥’∂’•÷Ä’´ ’∞’°’¥’°÷Ä
@@index([isActive, createdAt])
@@index([userId, status])

// ‚úÖ ’à÷Ç’∂’´’Ø’°’¨ ’´’∂’§’•÷Ñ’Ω’∂’•÷Ä
email String @unique
slug  String @unique

// ‚úÖ ‘≤’°’≤’°’§÷Ä’µ’°’¨ ’∏÷Ç’∂’´’Ø’°’¨
@@unique([productId, variantId])
```

### ‘ª’∂’π ’â’´’∂’§’•÷Ñ’Ω’°’æ’∏÷Ä’•’¨

```prisma
// ‚ùå ’â’´’∂’§’•÷Ñ’Ω’°’æ’∏÷Ä’•’¨.
// - ’ë’°’Æ÷Ä ’Ø’°÷Ä’§’´’∂’°’¨’∏÷Ç’©’µ’°’∂ ’§’°’∑’ø’•÷Ä (boolean 50/50)
// - WHERE-’∏÷Ç’¥ ’∞’°’¶’æ’°’§’•’∫ ÷Ö’£’ø’°’£’∏÷Ä’Æ’æ’∏’≤
// - ’Ñ’•’Æ ’ø’•÷Ñ’Ω’ø’°’µ’´’∂ ’§’°’∑’ø’•÷Ä (description)
```

---

## üîÑ ’Ñ‘ª‘≥’ê‘±’ë‘ª‘±’Ü‘µ’ê

### ’Ñ’´’£÷Ä’°÷Å’´’°’∂’•÷Ä’´ workflow

```bash
# 1. ’ì’∏’≠’•’¨ schema.prisma

# 2. ’ç’ø’•’≤’Æ’•’¨ ’¥’´’£÷Ä’°÷Å’´’° (development)
pnpm prisma migrate dev --name add_user_role

# 3. ‘ø’´÷Ä’°’º’•’¨ ’¥’´’£÷Ä’°÷Å’´’°’∂ (production)
pnpm prisma migrate deploy

# 4. ‘≥’•’∂’•÷Ä’°÷Å’∂’•’¨ ’Ø’¨’´’•’∂’ø
pnpm prisma generate
```

### ’Ñ’´’£÷Ä’°÷Å’´’°’∂’•÷Ä’´ ’°’∂’æ’°’∂’°’æ’∏÷Ä’∏÷Ç’¥

```bash
# ‚úÖ ’É‘ª’á’è ‚Äî ’∂’Ø’°÷Ä’°’£÷Ä’°’Ø’°’∂ ’°’∂’∏÷Ç’∂’∂’•÷Ä
add_users_table
add_user_email_index
add_order_status_column
rename_price_to_amount
remove_deprecated_field

# ‚ùå ’é‘±’è
update
fix
changes
migration1
```

### ’é’ø’°’∂’£’°’æ’∏÷Ä ’¥’´’£÷Ä’°÷Å’´’°’∂’•÷Ä

```prisma
// ‚ö†Ô∏è ‘∂‘≥’à’í’á‘±’ë‘ª’õ’ê ‚Äî ’ø’æ’µ’°’¨’∂’•÷Ä’´ ’Ø’∏÷Ä’∏÷Ç’Ω’ø

// ’ç’µ’∏÷Ç’∂’°’Ø’´ ’ª’∂’ª’∏÷Ç’¥
// ’Ü‘±‘Ω. ’∞’°’¥’∏’¶’æ’´’õ÷Ä, ’∏÷Ä ’ø’æ’µ’°’¨’∂’•÷Ä’® ’∫’•’ø÷Ñ ’π’•’∂ ’Ø’°’¥ ’¥’´’£÷Ä’°÷Å’æ’°’Æ ’•’∂

// ’ç’µ’∏÷Ç’∂’°’Ø’´ ’æ’•÷Ä’°’∂’æ’°’∂’∏÷Ç’¥
// ’ï‘≥’è‘±‘≥’à’ê‘æ‘ª’õ’ê @map ’∞’•’ø’®’∂’©’°÷Å ’∞’°’¥’°’ø’•’≤’•’¨’´’∏÷Ç’©’µ’°’∂ ’∞’°’¥’°÷Ä
model User {
  firstName String @map("first_name") // ‘≤‘¥-’∏÷Ç’¥ ’•’≤’•’¨ ’ß first_name
}

// ’è’´’∫’´ ÷É’∏÷É’∏’≠’∏÷Ç’©’µ’∏÷Ç’∂
// ’ç’è‘µ’Ç‘æ‘ª’õ’ê ’∂’∏÷Ä ’Ω’µ’∏÷Ç’∂’°’Ø, ’¥’´’£÷Ä’°÷Å÷Ä’∏÷Ç’õ ’ø’æ’µ’°’¨’∂’•÷Ä’®, ’ª’∂’ª’´’õ÷Ä ’∞’´’∂’®
```

---

## üìù PRISMA ’Ä‘±’ê’ë’à’í’Ñ’Ü‘µ’ê

### ’É’´’∑’ø ’∫’°’ø’•÷Ä’∂’∂’•÷Ä

```typescript
// ‚úÖ Select ’¥’´’°’µ’∂ ’°’∂’∞÷Ä’°’™’•’∑’ø ’§’°’∑’ø’•÷Ä’®
const users = await prisma.user.findMany({
  select: {
    id: true,
    name: true,
    email: true,
  },
});

// ‚úÖ Include ’Ø’°’∫’•÷Ä’´ ’∞’°’¥’°÷Ä
const order = await prisma.order.findUnique({
  where: { id: orderId },
  include: {
    items: true,
    user: {
      select: { id: true, name: true, email: true },
    },
  },
});

// ‚úÖ ‘∑’ª’°’æ’∏÷Ä’∏÷Ç’¥
const products = await prisma.product.findMany({
  skip: (page - 1) * limit,
  take: limit,
  orderBy: { createdAt: 'desc' },
});

// ‚úÖ ’è÷Ä’°’∂’¶’°’Ø÷Å’´’°’∂’•÷Ä
const [order, payment] = await prisma.$transaction([
  prisma.order.create({ data: orderData }),
  prisma.payment.create({ data: paymentData }),
]);

// ‚úÖ ‘ª’∂’ø’•÷Ä’°’Ø’ø’´’æ ’ø÷Ä’°’∂’¶’°’Ø÷Å’´’°’∂’•÷Ä
const result = await prisma.$transaction(async (tx) => {
  const product = await tx.product.findUnique({ where: { id } });
  
  if (product.stock < quantity) {
    throw new Error('Insufficient stock');
  }
  
  await tx.product.update({
    where: { id },
    data: { stock: { decrement: quantity } },
  });
  
  return tx.orderItem.create({ data: itemData });
});
```

### ’Ä’°’Ø’°’∫’°’ø’•÷Ä’∂’∂’•÷Ä

```typescript
// ‚ùå N+1 ’≠’∂’§’´÷Ä
const orders = await prisma.order.findMany();
for (const order of orders) {
  const items = await prisma.orderItem.findMany({
    where: { orderId: order.id },
  }); // N ’¨÷Ä’°÷Å’∏÷Ç÷Å’´’π ’∞’°÷Ä÷Å’∏÷Ç’¥
}

// ‚úÖ ’ï’£’ø’°’£’∏÷Ä’Æ’´’õ÷Ä include
const orders = await prisma.order.findMany({
  include: { items: true },
});

// ‚ùå ‘≤’∏’¨’∏÷Ä ’ø’æ’µ’°’¨’∂’•÷Ä’´ ’¢’•’º’∂’∏÷Ç’¥
const allProducts = await prisma.product.findMany(); // ’Ñ’´’¨’´’∏’∂’∂’•÷Ä ’£÷Ä’°’º’∏÷Ç’¥

// ‚úÖ ’ï’£’ø’°’£’∏÷Ä’Æ’´’õ÷Ä ’ß’ª’°’æ’∏÷Ä’∏÷Ç’¥
const products = await prisma.product.findMany({
  take: 100,
  skip: offset,
});

// ‚ùå Raw SQL ’°’∂’∞÷Ä’°’™’•’∑’ø’∏÷Ç’©’µ’∏÷Ç’∂’´÷Å ’§’∏÷Ç÷Ä’Ω
const users = await prisma.$queryRaw`SELECT * FROM users WHERE ...`;

// ‚úÖ ’ï’£’ø’°’£’∏÷Ä’Æ’´’õ÷Ä Prisma Query API
const users = await prisma.user.findMany({
  where: { ... },
});
```

---

## üîí ‘±’Ü’é’è‘±’Ü‘≥’à’í‘π’Ö’à’í’Ü

### SQL Injection-’´÷Å ’∫’°’∑’ø’∫’°’∂’∏÷Ç’©’µ’∏÷Ç’∂

```typescript
// ‚úÖ Prisma-’∂ ’°’æ’ø’∏’¥’°’ø ’ß’Ø÷Ä’°’∂’°’æ’∏÷Ä’∏÷Ç’¥ ’ß ’∫’°÷Ä’°’¥’•’ø÷Ä’•÷Ä’®
const user = await prisma.user.findFirst({
  where: { email: userInput }, // ‘±’∂’æ’ø’°’∂’£
});

// ‚ö†Ô∏è Raw SQL ‚Äî ÷Ö’£’ø’°’£’∏÷Ä’Æ’´’õ÷Ä ’∫’°÷Ä’°’¥’•’ø÷Ä’•÷Ä
const result = await prisma.$queryRaw`
  SELECT * FROM users WHERE email = ${userInput}
`; // Prisma-’∂ ’ß’Ø÷Ä’°’∂’°’æ’∏÷Ä’∏÷Ç’¥ ’ß

// ‚ùå ‘µ’ê‘µ’î‘µ‘º‘µ’é ’ø’∏’≤’•÷Ä ’¥’´’°÷Å’∂’•’¨
const result = await prisma.$queryRawUnsafe(
  `SELECT * FROM users WHERE email = '${userInput}'` // SQL INJECTION
);
```

### ‘ª’¥’∏÷Ç’ø’°÷Å’´’∏’∂ ’ª’∂’ª’∏÷Ç’¥ (soft delete)

```prisma
model Product {
  id        String    @id @default(cuid())
  // ...
  deletedAt DateTime? // null = ’°’Ø’ø’´’æ, ’°’¥’Ω’°’©’´’æ = ’ª’∂’ª’æ’°’Æ
  
  @@index([deletedAt])
}
```

```typescript
// Middleware ’°’æ’ø’∏’¥’°’ø ÷Ü’´’¨’ø÷Ä’°÷Å’´’°’µ’´ ’∞’°’¥’°÷Ä
prisma.$use(async (params, next) => {
  if (params.model === 'Product') {
    if (params.action === 'findMany' || params.action === 'findFirst') {
      params.args.where = {
        ...params.args.where,
        deletedAt: null,
      };
    }
  }
  return next(params);
});
```

---

## üíæ ‘≤‘µ’î‘±’ì ‘µ’é ’é‘µ’ê‘±‘ø‘±’Ü‘≥’Ü’à’í’Ñ

### ‘≤’•÷Ñ’°÷É’∂’•÷Ä’´ ’º’°’¶’¥’°’æ’°÷Ä’∏÷Ç’©’µ’∏÷Ç’∂

```markdown
## ‘≤’•÷Ñ’°÷É’∂’•÷Ä’´ ’ø’´’∫’•÷Ä

| ’è’´’∫ | ’Ä’°’≥’°’≠’°’Ø’°’∂’∏÷Ç’©’µ’∏÷Ç’∂ | Retention | ‘µ÷Ä’¢ ÷Ö’£’ø’°’£’∏÷Ä’Æ’•’¨ |
|-----|---------|-----------|-------------------|
| Full backup | ’ï÷Ä’°’Ø’°’∂ | 30 ÷Ö÷Ä | ‘±’¥’¢’∏’≤’ª’°’Ø’°’∂ ’æ’•÷Ä’°’Ø’°’∂’£’∂’∏÷Ç’¥ |
| Incremental | ‘∫’°’¥’°’Ø’°’∂ | 7 ÷Ö÷Ä | ‘ø’•’ø’´ ’æ’•÷Ä’°’Ø’°’∂’£’∂’∏÷Ç’¥ |
| WAL archiving | ‘±’∂’®’∂’§’∞’°’ø | 7 ÷Ö÷Ä | Point-in-time recovery |
```

### PostgreSQL ’¢’•÷Ñ’°÷É’∂’•÷Ä’´ ’Ø’°÷Ä’£’°’æ’∏÷Ä’∏÷Ç’¥

```bash
# ‘±’¥’¢’∏’≤’ª’°’Ø’°’∂ ’¢’•÷Ñ’°÷É
pg_dump -h localhost -U user -d database -F c -f backup_$(date +%Y%m%d).dump

# ’é’•÷Ä’°’Ø’°’∂’£’∂’∏÷Ç’¥
pg_restore -h localhost -U user -d database -c backup_20240115.dump

# ’Ñ’´’°’µ’∂ ’Ω’≠’•’¥’°’µ’´ ’¢’•÷Ñ’°÷É
pg_dump -h localhost -U user -d database --schema-only -f schema.sql

# ’Ñ’´’°’µ’∂ ’ø’æ’µ’°’¨’∂’•÷Ä’´ ’¢’•÷Ñ’°÷É
pg_dump -h localhost -U user -d database --data-only -f data.sql
```

### ‘±’æ’ø’∏’¥’°’ø’°÷Å’∏÷Ç’¥ (Docker/Kubernetes)

```yaml
# docker-compose.yml ‚Äî backup service
services:
  backup:
    image: postgres:15-alpine
    environment:
      PGHOST: postgres
      PGUSER: ${DB_USER}
      PGPASSWORD: ${DB_PASSWORD}
      PGDATABASE: ${DB_NAME}
    volumes:
      - ./backups:/backups
    command: |
      sh -c 'while true; do
        pg_dump -F c -f /backups/backup_$$(date +%Y%m%d_%H%M%S).dump
        find /backups -mtime +30 -delete
        sleep 86400
      done'
```

### üî¥ ’ä‘±’ê’è‘±‘¥‘ª’ê. Restore Testing

```markdown
## ’é’•÷Ä’°’Ø’°’∂’£’∂’¥’°’∂ ’©’•’Ω’ø’°’æ’∏÷Ä’¥’°’∂ ’Ω’ø’∏÷Ç’£’°÷Å’∏÷Ç÷Å’°’Ø

### ‘±’¥’•’∂ ’°’¥’´’Ω
- [ ] ’é’•÷Ä’°’Ø’°’∂’£’∂’•’¨ ’æ’•÷Ä’ª’´’∂ ’¢’•÷Ñ’°÷É’® ’©’•’Ω’ø’°’µ’´’∂ ‘≤‘¥-’∏÷Ç’¥
- [ ] ’ç’ø’∏÷Ç’£’•’¨ ’ø’æ’µ’°’¨’∂’•÷Ä’´ ’°’¥’¢’∏’≤’ª’°’Ø’°’∂’∏÷Ç’©’µ’∏÷Ç’∂’®
- [ ] ’ç’ø’∏÷Ç’£’•’¨, ’∏÷Ä ’∞’°’æ’•’¨’æ’°’Æ’® ’°’∑’≠’°’ø’∏÷Ç’¥ ’ß ’æ’•÷Ä’°’Ø’°’∂’£’∂’æ’°’Æ ’ø’æ’µ’°’¨’∂’•÷Ä’∏’æ
- [ ] ’â’°÷É’•’¨ ’æ’•÷Ä’°’Ø’°’∂’£’∂’¥’°’∂ ’™’°’¥’°’∂’°’Ø’® (RTO)
- [ ] ’ì’°’Ω’ø’°’©’≤’©’°’æ’∏÷Ä’•’¨ ’°÷Ä’§’µ’∏÷Ç’∂÷Ñ’®

### ‘ª’∂’π ’Ω’ø’∏÷Ç’£’•’¨ ’æ’•÷Ä’°’Ø’°’∂’£’∂’∏÷Ç’¥’´÷Å ’∞’•’ø’∏
- [ ] ‘≥÷Ä’°’º’∏÷Ç’¥’∂’•÷Ä’´ ÷Ñ’°’∂’°’Ø’® ’∞’´’¥’∂’°’Ø’°’∂ ’°’≤’µ’∏÷Ç’Ω’°’Ø’∂’•÷Ä’∏÷Ç’¥ ’∞’°’¥’®’∂’Ø’∂’∏÷Ç’¥ ’ß
- [ ] ‘ø’°’∫’•÷Ä’® (FK) ’≠’°’≠’ø’æ’°’Æ ’π’•’∂
- [ ] ’Ä’°’æ’•’¨’æ’°’Æ’® ’£’∏÷Ä’Æ’°÷Ä’Ø’æ’∏÷Ç’¥ ÷á ’°’∑’≠’°’ø’∏÷Ç’¥ ’ß
- [ ] ‘ø÷Ä’´’ø’´’Ø ÷Ü’∏÷Ç’∂’Ø÷Å’´’°’∂’•÷Ä’® ’°’∑’≠’°’ø’∏÷Ç’¥ ’•’∂ (’∂’æ’´÷Ä’°’£÷Ä’∏÷Ç’¥, ’∫’°’ø’æ’•÷Ä’∂’•÷Ä, ’æ’≥’°÷Ä’∏÷Ç’¥’∂’•÷Ä)
```

### ’é’•÷Ä’°’Ø’°’∂’£’∂’¥’°’∂ Runbook

```markdown
## ‘≤’•÷Ñ’°÷É’´÷Å ’æ’•÷Ä’°’Ø’°’∂’£’∂’∏÷Ç’¥

### 1. ’Ü’°’≠’°’∫’°’ø÷Ä’°’Ω’ø’∏÷Ç’¥
- ’à÷Ä’∏’∑’•’¨ ’æ’•÷Ä’°’Ø’°’∂’£’∂’¥’°’∂ ’Ø’•’ø’® (’∏÷Ä ’¢’•÷Ñ’°÷É’®)
- ‘æ’°’∂’∏÷Ç÷Å’•’¨ ’©’´’¥’´’∂ downtime-’´ ’¥’°’Ω’´’∂
- ’ä’°’ø÷Ä’°’Ω’ø’•’¨ ’¥’°÷Ñ’∏÷Ç÷Ä ‘≤‘¥ ’Ø’°’¥ ’Ø’°’∂’£’∂’•÷Å’∂’•’¨ ’®’∂’©’°÷Å’´’Ø’®

### 2. ’é’•÷Ä’°’Ø’°’∂’£’∂’∏÷Ç’¥
\`\`\`bash
# ‘ø’°’∂’£’∂’•÷Å’∂’•’¨ ’∞’°’æ’•’¨’æ’°’Æ’®
docker-compose stop app

# ’é’•÷Ä’°’Ø’°’∂’£’∂’•’¨ ‘≤‘¥-’®
pg_restore -h localhost -U user -d database -c backup.dump

# ’ç’ø’∏÷Ç’£’•’¨
psql -h localhost -U user -d database -c "SELECT COUNT(*) FROM users;"

# ‘≥’∏÷Ä’Æ’°÷Ä’Ø’•’¨ ’∞’°’æ’•’¨’æ’°’Æ’®
docker-compose start app
\`\`\`

### 3. ’é’•÷Ä’°’∞’Ω’Ø’∏÷Ç’¥
- [ ] ’Ä’°’æ’•’¨’æ’°’Æ’® ’£’∏÷Ä’Æ’°÷Ä’Ø’æ’•’¨ ’ß
- [ ] Health checks-’® ’°’∂÷Å’∂’∏÷Ç’¥ ’•’∂
- [ ] Smoke tests-’® ’°’∂÷Å’∂’∏÷Ç’¥ ’•’∂
- [ ] ’Ñ’∏’∂’´’ø’∏÷Ä’´’∂’£’® ’∂’∏÷Ä’¥’°’µ’∏÷Ç’¥ ’ß

### 4. ’Ä’°’≤’∏÷Ä’§’°’Ø÷Å’∏÷Ç’¥
- ‘æ’°’∂’∏÷Ç÷Å’•’¨ ’©’´’¥’´’∂ ’°’æ’°÷Ä’ø’´ ’¥’°’Ω’´’∂
- ’ç’ø’•’≤’Æ’•’¨ incident report
```

### ‘≤’•÷Ñ’°÷É’∂’•÷Ä’´ ’¥’•’ø÷Ä’´’Ø’°’∂’•÷Ä

```typescript
// ‘ª’∂’π ’¥’∏’∂’´’ø’∏÷Ä’•’¨
const backupMetrics = {
  lastBackupTime: Date,        // ‘µ÷Ä’¢ ’ß÷Ä ’æ’•÷Ä’ª’´’∂ ’¢’•÷Ñ’°÷É’®
  backupSize: number,          // ‘≤’•÷Ñ’°÷É’´ ’π’°÷É’®
  backupDuration: number,      // ‘≤’•÷Ñ’°÷É’´ ’Ω’ø’•’≤’Æ’¥’°’∂ ’™’°’¥’°’∂’°’Ø
  lastRestoreTest: Date,       // ‘µ÷Ä’¢ ’©’•’Ω’ø’°’æ’∏÷Ä’•’¨ ’•’∂ ’æ’•÷Ä’°’Ø’°’∂’£’∂’∏÷Ç’¥’®
  restoreDuration: number,     // ’é’•÷Ä’°’Ø’°’∂’£’∂’¥’°’∂ ’™’°’¥’°’∂’°’Ø (RTO)
};

// ‘±’¨’•÷Ä’ø’∂’•÷Ä
// - ‘≤’•÷Ñ’°÷É ’π’´ ’Ω’ø’•’≤’Æ’æ’•’¨ > 24 ’™’°’¥
// - Restore test ’π’´ ’Ø’°’ø’°÷Ä’æ’•’¨ > 30 ÷Ö÷Ä
// - ‘≤’•÷Ñ’°÷É’´ ’π’°÷É’® ’°’∂’Ω’∏’æ’∏÷Ä ÷É’∏’≠’æ’•’¨ ’ß
```

---

## ‚òÅÔ∏è NEON (MANAGED POSTGRES)

> ‘µ’©’• ÷Ö’£’ø’°’£’∏÷Ä’Æ’æ’∏÷Ç’¥ ’ß Neon ‚Äî ’æ’•÷Ä÷á’´ ’∑’°’ø ’¢’°’™’´’∂’∂’•÷Ä ’∫’°÷Ä’¶’•÷Å’æ’∏÷Ç’¥ ’•’∂÷â

### ‘ª’∂’π Neon-’® ’°’æ’ø’∏’¥’°’ø ’°’∂’∏÷Ç’¥ ’ß

```markdown
## ‘≤’•÷Ñ’°÷É’∂’•÷Ä
- ‚úÖ ‘±’æ’ø’∏’¥’°’ø ’¢’•÷Ñ’°÷É’∂’•÷Ä (’Ø’°÷Ä’£’°’æ’∏÷Ä’•’¨ ’∫’•’ø÷Ñ ’π’ß)
- ‚úÖ Point-in-time recovery (7/30 ÷Ö÷Ä’ù ’Ø’°’≠’æ’°’Æ ’∫’¨’°’∂’´÷Å)
- ‚úÖ ’ä’°’∞’∫’°’∂’∏÷Ç’¥ ’°’º’°’∂’±’´’∂ ’ø’•’≤’∏÷Ç’¥ (S3-’∞’°’¥’°’ø’•’≤’•’¨’´ ’∫’°’∞’∏÷Å)

## Branching
- ‚úÖ Database branches (’´’∂’π’∫’•’Ω git branches ‘≤‘¥-’´ ’∞’°’¥’°÷Ä)
- ‚úÖ Preview environments ’°’º’°’∂’±’´’∂ ‘≤‘¥-’∏’æ
- ‚úÖ Instant branching (copy-on-write)

## ’Ñ’°’Ω’∑’ø’°’¢’°’æ’∏÷Ä’∏÷Ç’¥
- ‚úÖ Autoscaling compute
- ‚úÖ Scale to zero (’≠’∂’°’µ’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂ dev-’∏÷Ç’¥)
- ‚úÖ Read replicas (Pro ’∫’¨’°’∂’∏÷Ç’¥)
```

### Neon Branching ’¶’°÷Ä’£’°÷Å’¥’°’∂ ’∞’°’¥’°÷Ä

```bash
# docker-compose-’´ ÷É’∏’≠’°÷Ä’•’∂ ’ø’•’≤’°’Ø’°’∂ Postgres-’∏’æ.
# 1. Main branch = production
# 2. Dev branch = ’¶’°÷Ä’£’°÷Å’¥’°’∂ ’∞’°’¥’°÷Ä
# 3. PR branches = preview deployments-’´ ’∞’°’¥’°÷Ä

# Branch-’´ ’Ω’ø’•’≤’Æ’∏÷Ç’¥ Neon CLI-’∏’æ
neonctl branches create --name feature-auth

# ‘ø’°’¥ Vercel Integration ‚Äî ’°’æ’ø’∏’¥’°’ø ’µ’∏÷Ç÷Ä’°÷Ñ’°’∂’π’µ’∏÷Ç÷Ä PR-’´ ’∞’°’¥’°÷Ä
```

### Connection String

```typescript
// .env.local (development)
DATABASE_URL="postgresql://user:pass@ep-xxx-123.us-east-2.aws.neon.tech/neondb?sslmode=require"

// Prisma ‚Äî ’°’æ’•’¨’°÷Å’∂’•’¨ serverless-’´ ’∞’°’¥’°÷Ä
// schema.prisma
datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")  // ’Ñ’´’£÷Ä’°÷Å’´’°’∂’•÷Ä’´ ’∞’°’¥’°÷Ä (’°’º’°’∂÷Å connection pooling)
}
```

### ‘ª’∂’π ’°’µ’∂’∏÷Ç’°’¥’•’∂’°’µ’∂’´’æ ’∫’•’ø÷Ñ ’ß ’°’∂’•’¨

```markdown
## ’î’∏ ’∫’°’ø’°’Ω’≠’°’∂’°’ø’æ’∏÷Ç’©’µ’∏÷Ç’∂’®

- ‚úÖ ‘≤‘¥ ’Ω’≠’•’¥’° ÷á ’¥’´’£÷Ä’°÷Å’´’°’∂’•÷Ä (Prisma)
- ‚úÖ ‘ª’∂’§’•÷Ñ’Ω’∂’•÷Ä ’°÷Ä’ø’°’§÷Ä’∏’≤’°’Ø’°’∂’∏÷Ç’©’µ’°’∂ ’∞’°’¥’°÷Ä
- ‚úÖ ’É’´’∑’ø ’∞’°÷Ä÷Å’∏÷Ç’¥’∂’•÷Ä (’°’º’°’∂÷Å N+1)
- ‚úÖ ’è÷Ä’°’∂’¶’°’Ø÷Å’´’°’∂’•÷Ä ’∏÷Ä’ø’•’≤ ’∫’•’ø÷Ñ ’ß
- ‚úÖ Soft delete ’Ø’°÷Ä÷á’∏÷Ä ’ø’æ’µ’°’¨’∂’•÷Ä’´ ’∞’°’¥’°÷Ä

## ’ä‘µ’è’î ’â‘∑ (Neon-’® ’°’∂’∏÷Ç’¥ ’ß)

- ‚ùå ‘≤’•÷Ñ’°÷É’∂’•÷Ä’´ ’Ø’°÷Ä’£’°’æ’∏÷Ä’∏÷Ç’¥
- ‚ùå docker-compose ’ø’•’≤’°’Ø’°’∂ ‘≤‘¥-’´ ’∞’°’¥’°÷Ä
- ‚ùå Restore testing (Neon-’® ’•÷Ä’°’∑’≠’°’æ’∏÷Ä’∏÷Ç’¥ ’ß)
- ‚ùå ’ç’Ø’°’æ’°’º’°’Ø’´ ’ø’°÷Ä’°’Æ’∏÷Ç’©’µ’°’∂ ’¥’∏’∂’´’ø’∏÷Ä’´’∂’£
```

### Neon + Vercel Integration

```markdown
## ‘±’æ’ø’∏’¥’°’ø ’´’∂’ø’•’£÷Ä’°÷Å’´’°’µ’´ ’™’°’¥’°’∂’°’Ø

1. Preview deployment ‚Üí Neon-’® ’Ω’ø’•’≤’Æ’∏÷Ç’¥ ’ß branch
2. PR merged ‚Üí branch-’® ’ª’∂’ª’æ’∏÷Ç’¥ ’ß
3. Environment variables-’® ’°’æ’ø’∏’¥’°’ø ÷É’∏’≠’°’∂÷Å’æ’∏÷Ç’¥ ’•’∂
```

---

## üõ°Ô∏è POSTGRES ‘¥‘µ’ê‘µ’ê ‘µ’é ‘º‘ª’Ñ‘ª’è’Ü‘µ’ê

> ’Ü’æ’°’¶’°’£’∏÷Ç’µ’∂ ’°÷Ä’ø’∏’∂’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’´ ’Ω’Ø’¶’¢’∏÷Ç’∂÷Ñ. runtime ’∞’°’æ’•’¨’æ’°’Æ’® ’â‘∑ ’°’∑’≠’°’ø’∏÷Ç’¥ owner/superuser-’´ ’∂’•÷Ä÷Ñ’∏÷â

### ‘ª’∂’π’∏÷Ç ’ß ’Ω’° ’°’∂’∞÷Ä’°’™’•’∑’ø

Owner-’§’•÷Ä’® (Neon-’® ’°’æ’ø’∏’¥’°’ø ’Ω’ø’•’≤’Æ’∏÷Ç’¥ ’ß) ’∏÷Ç’∂’´ `CREATE`, `DROP`, `ALTER` ’´÷Ä’°’æ’∏÷Ç’∂÷Ñ’∂’•÷Ä ‚Äî ’Ø’°÷Ä’∏’≤ ’ß ÷É’∏’≠’•’¨ ‘≤‘¥-’´ ’Ø’°’º’∏÷Ç÷Å’æ’°’Æ÷Ñ’®÷â ‘µ’©’• ’∞’°’æ’•’¨’æ’°’Æ’® ’Ø’∏’¥’∫÷Ä’∏’¥’•’ø’°÷Å’æ’•’¨ ’ß (RCE, SQL injection `$queryRawUnsafe`-’∏’æ), ’∞’°÷Ä’±’°’Ø’æ’∏’≤’® ’Ω’ø’°’∂’∏÷Ç’¥ ’ß ’°’¥’¢’∏’≤’ª’°’Ø’°’∂ ’æ’•÷Ä’°’∞’Ω’Ø’∏÷Ç’¥ ’Ω’≠’•’¥’°’µ’´ ’∂’Ø’°’ø’¥’°’¥’¢÷â ‘±’º’°’∂’±’´’∂ `app_user` DML-only ’´÷Ä’°’æ’∏÷Ç’∂÷Ñ’∂’•÷Ä’∏’æ ’Ω’°’∞’¥’°’∂’°÷É’°’Ø’∏÷Ç’¥ ’ß blast radius-’®÷â

### ‘¥’•÷Ä’•÷Ä’´ ’¥’°’ø÷Ä’´÷Å’° ’®’Ω’ø ’∂’°’≠’°’£’Æ’´ ’π’°÷É’´

| ‘¥’•÷Ä | Size A (÷É’∏÷Ñ÷Ä) | Size B (’¥’´’ª’´’∂) | Size C (’¥’•’Æ) |
|-----|---------------|------------------|------------------|
| **owner** (Neon default) | ’Ñ’´’£÷Ä’°÷Å’´’°’∂’•÷Ä, ’±’•’º÷Ñ’∏’æ ’£’∏÷Ä’Æ’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä | ’Ñ’´’£÷Ä’°÷Å’´’°’∂’•÷Ä CI/CD-’∏÷Ç’¥ | ’Ñ’´’£÷Ä’°÷Å’´’°’∂’•÷Ä CI/CD-’∏÷Ç’¥ |
| **app_user** | ‚úÖ ’Ä’°’æ’•’¨’æ’°’Æ’´ runtime | ‚úÖ ’Ä’°’æ’•’¨’æ’°’Æ’´ runtime | ‚úÖ ’Ä’°’æ’•’¨’æ’°’Æ’´ runtime |
| **readonly_user** | ‚ùå ’ä’•’ø÷Ñ ’π’ß | ‚ö†Ô∏è ‘∏’∂’ø÷Ä’∏’æ’´ (’°’∂’°’¨’´’ø’´’Ø’°) | ‚úÖ ’ä’°÷Ä’ø’°’§’´÷Ä (’°’∂’°’¨’´’ø’´’Ø’°, ’°’ª’°’Ø÷Å’∏÷Ç’©’µ’∏÷Ç’∂) |
| **analytics_user** | ‚ùå ’ä’•’ø÷Ñ ’π’ß | ‚ùå ’ä’•’ø÷Ñ ’π’ß | ‚ö†Ô∏è ‘∏’∂’ø÷Ä’∏’æ’´ (’•÷Ä’Ø’°÷Ä ’∞’°’∑’æ’•’ø’æ’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä) |

---

### Runtime ÷Ö’£’ø’°’ø’´÷Ä’∏’ª (app_user) ’Ω’ø’•’≤’Æ’∏÷Ç’¥

> üî¥ **’ä’°÷Ä’ø’°’§’´÷Ä ’¢’∏’¨’∏÷Ä ’∂’°’≠’°’£’Æ’•÷Ä’´ ’π’°÷É’•÷Ä’´ ’∞’°’¥’°÷Ä (A/B/C)**

```sql
-- 1. ’ç’ø’•’≤’Æ’•’¨ runtime ’§’•÷Ä
CREATE ROLE app_user WITH LOGIN PASSWORD '<’£’•’∂’•÷Ä’°÷Å’∂’•’¨: openssl rand -base64 32>';

-- 2. ’Ñ’∏÷Ç’ø÷Ñ ‘≤‘¥ ÷á ’Ω’≠’•’¥’°
GRANT CONNECT ON DATABASE neondb TO app_user;
GRANT USAGE ON SCHEMA public TO app_user;

-- 3. DML-only ’´÷Ä’°’æ’∏÷Ç’∂÷Ñ’∂’•÷Ä (SELECT, INSERT, UPDATE, DELETE)
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO app_user;

-- 4. Sequences-’´ ’´÷Ä’°’æ’∏÷Ç’∂÷Ñ’∂’•÷Ä (CUID/autoincrement-’´ ’∞’°’¥’°÷Ä)
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO app_user;

-- 5. DEFAULT PRIVILEGES ‚Äî ’∏÷Ä ’∂’∏÷Ä ’°’≤’µ’∏÷Ç’Ω’°’Ø’∂’•÷Ä’∂ ’ß’¨ ’∞’°’Ω’°’∂’•’¨’´ ’¨’´’∂’•’∂
-- ‚ö†Ô∏è ‘ø’°’ø’°÷Ä’•’¨ owner-’´ ’°’∂’∏÷Ç’∂’´÷Å (’∏’æ ’£’∏÷Ä’Æ’°÷Ä’Ø’∏÷Ç’¥ ’ß prisma migrate deploy)
ALTER DEFAULT PRIVILEGES IN SCHEMA public
  GRANT SELECT, INSERT, UPDATE, DELETE ON TABLES TO app_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public
  GRANT USAGE, SELECT ON SEQUENCES TO app_user;
```

### Readonly ÷Ö’£’ø’°’ø’´÷Ä’∏’ª (Size B/C) ’Ω’ø’•’≤’Æ’∏÷Ç’¥

```sql
-- ‘±’∂’°’¨’´’ø’´’Ø’°’µ’´, ’°’ª’°’Ø÷Å’∏÷Ç’©’µ’°’∂, debug-’´ ’∞’°’¥’°÷Ä
CREATE ROLE readonly_user WITH LOGIN PASSWORD '<’£’•’∂’•÷Ä’°÷Å’∂’•’¨>';

GRANT CONNECT ON DATABASE neondb TO readonly_user;
GRANT USAGE ON SCHEMA public TO readonly_user;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO readonly_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public
  GRANT SELECT ON TABLES TO readonly_user;
```

### Analytics ÷Ö’£’ø’°’ø’´÷Ä’∏’ª (Size C) ’Ω’ø’•’≤’Æ’∏÷Ç’¥

```sql
-- ‘µ÷Ä’Ø’°÷Ä ’∞’°’∑’æ’•’ø’æ’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’´ ’∞’°’¥’°÷Ä ‚Äî ’¥’•’≤’¥ timeout-’∂’•÷Ä
CREATE ROLE analytics_user WITH LOGIN PASSWORD '<’£’•’∂’•÷Ä’°÷Å’∂’•’¨>';

GRANT CONNECT ON DATABASE neondb TO analytics_user;
GRANT USAGE ON SCHEMA public TO analytics_user;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO analytics_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public
  GRANT SELECT ON TABLES TO analytics_user;

-- ’Ñ’•’≤’¥ timeout-’∂’•÷Ä ’•÷Ä’Ø’°÷Ä ’∞’°÷Ä÷Å’∏÷Ç’¥’∂’•÷Ä’´ ’∞’°’¥’°÷Ä
ALTER ROLE analytics_user SET statement_timeout = '5min';
ALTER ROLE analytics_user SET idle_in_transaction_session_timeout = '5min';
ALTER ROLE analytics_user SET lock_timeout = '30s';
ALTER ROLE analytics_user CONNECTION LIMIT 3;
```

---

### CONNECTION LIMIT

> ‘º’´’¥’´’ø ’§’∂’•’¨’® ’Ø’°’≠’æ’°’Æ ’ß ’§’•’∫’¨’∏’µ’´ ’ø’´’∫’´÷Å, ’∏’π ’∂’°’≠’°’£’Æ’´ ’π’°÷É’´÷Å÷â

| ‘¥’•’∫’¨’∏’µ’´ ’Ω÷Å’•’∂’°÷Ä | CONNECTION LIMIT | ’ä’°’ø’≥’°’º |
|-----------------|-----------------|---------|
| **Vercel serverless** (pooled) | ‚ùå ‘¥’•÷Ä’´ ’æ÷Ä’° ’π’§’∂’•’¨ | Neon Pooler-’® ’Ø’°’º’°’æ’°÷Ä’∏÷Ç’¥ ’ß ’Ø’°’∫’•÷Ä’®÷â ‘¥’•÷Ä’´ ’¨’´’¥’´’ø’® ’Ø’¢’•÷Ä’´ `too many connections` ’Ω’∫’°’µ÷Ñ’∂’•÷Ä’´ ’™’°’¥’°’∂’°’Ø |
| **NestJS Render/Railway-’∏÷Ç’¥** (long-running) | ‚úÖ ‘¥’∂’•’¨ | ’ä’°’∑’ø’∫’°’∂’∏÷Ç’©’µ’∏÷Ç’∂ ’Ø’°’∫’•÷Ä’´ ’°÷Ä’ø’°’∞’∏’Ω÷Ñ’´÷Å autoscaling instance-’∂’•÷Ä’´ ’™’°’¥’°’∂’°’Ø |
| **Monorepo (web + api)** | ‚úÖ api-’∏÷Ç’¥ ’§’∂’•’¨, web-’∏÷Ç’¥ ’∏’π | Web pooler-’∏’æ, API ‚Äî direct/pooled ’æ’•÷Ä’°’∞’Ω’Ø’∏÷Ç’¥’∏’æ |

#### CONNECTION LIMIT-’´ ’∞’°’∑’æ’°÷Ä’Ø’´ ’¢’°’∂’°’±÷á

```
CONNECTION LIMIT = (instance-’∂’•÷Ä’´ ÷Ñ’°’∂’°’Ø √ó pool-’´ ’π’°÷É) + ’∫’°’∞’∏÷Ç’Ω’ø (5-10)

’ï÷Ä’´’∂’°’Ø’∂’•÷Ä.
- 2 NestJS instance √ó 10 pool = 20 + 10 ’∫’°’∞’∏÷Ç’Ω’ø = 30
- 3 instance √ó 15 pool = 45 + 10 ’∫’°’∞’∏÷Ç’Ω’ø = 55
```

#### ‘Ω’∏÷Ä’∞’∏÷Ç÷Ä’§’∂’•÷Ä ’®’Ω’ø ’π’°÷É’´

| ’ä’°÷Ä’°’¥’•’ø÷Ä | Size A | Size B | Size C |
|----------|--------|--------|--------|
| CONNECTION LIMIT (long-running backend) | 15 | 30 | 50-100 |
| Prisma `connection_limit` (serverless) | 3-5 | 5-10 | 10-15 |
| Prisma `connection_limit` (long-running) | 5-10 | 10-15 | 15-25 |
| Prisma `pool_timeout` | 10s | 15s | 15s |

```sql
-- Size A (NestJS backend)
ALTER ROLE app_user CONNECTION LIMIT 15;

-- Size B (NestJS backend)
ALTER ROLE app_user CONNECTION LIMIT 30;

-- Size C (NestJS backend, ’¥’´ ÷Ñ’°’∂’´ instance)
ALTER ROLE app_user CONNECTION LIMIT 55;
```

---

### Postgres ’§’•÷Ä’´ ’¥’°’Ø’°÷Ä’§’°’Ø’´ timeout-’∂’•÷Ä

> Defence-in-depth. ’§’•÷Ä’´ timeout-’∂’•÷Ä’® ’¨÷Ä’°÷Å’∂’∏÷Ç’¥ ’•’∂ application-level timeout-’∂’•÷Ä’® `18-reliability.mdc`-’´÷Å÷â

```sql
-- ‚è±Ô∏è statement_timeout ‚Äî ’¥’•’Ø ’∞’°÷Ä÷Å’¥’°’∂ ’°’º’°’æ’•’¨’°’£’∏÷Ç’µ’∂ ’™’°’¥’°’∂’°’Ø
-- ‚è±Ô∏è idle_in_transaction_session_timeout ‚Äî ’§’°’§’°÷Ä’•÷Å’∂’•’¨ idle ’ø÷Ä’°’∂’¶’°’Ø÷Å’´’°’∂
-- ‚è±Ô∏è lock_timeout ‚Äî ’¢’¨’∏’Ø’°’æ’∏÷Ä’¥’°’∂ ’°’º’°’æ’•’¨’°’£’∏÷Ç’µ’∂ ’Ω’∫’°’Ω’∏÷Ç’¥
```

#### ‘±÷Ä’™’•÷Ñ’∂’•÷Ä’´ ’°’≤’µ’∏÷Ç’Ω’°’Ø ’®’Ω’ø ’π’°÷É’´ ÷á ’Ω÷Å’•’∂’°÷Ä’´

| ’ä’°÷Ä’°’¥’•’ø÷Ä | Size A (serverless) | Size A (backend) | Size B | Size C |
|----------|--------------------|-----------------:|-------:|-------:|
| `statement_timeout` | `10s` | `15s` | `30s` | `30s` |
| `idle_in_transaction_session_timeout` | `20s` | `30s` | `60s` | `60s` |
| `lock_timeout` | `5s` | `5s` | `10s` | `10s` |

#### Size A ‚Äî ’ì’∏÷Ñ÷Ä ’∂’°’≠’°’£’´’Æ

```sql
-- Vercel serverless (’Ø’∏’∑’ø ’¨’´’¥’´’ø’∂’•÷Ä ‚Äî serverless functions-’∂ ’∏÷Ç’∂’•’∂ ’´÷Ä’•’∂÷Å timeout)
ALTER ROLE app_user SET statement_timeout = '10s';
ALTER ROLE app_user SET idle_in_transaction_session_timeout = '20s';
ALTER ROLE app_user SET lock_timeout = '5s';
```

```sql
-- NestJS backend (’¥’´ ÷Ñ’´’π ’°’æ’•’¨’´ ’¥’•’≤’¥)
ALTER ROLE app_user SET statement_timeout = '15s';
ALTER ROLE app_user SET idle_in_transaction_session_timeout = '30s';
ALTER ROLE app_user SET lock_timeout = '5s';
```

#### Size B ‚Äî ’Ñ’´’ª’´’∂ ’∂’°’≠’°’£’´’Æ

```sql
ALTER ROLE app_user SET statement_timeout = '30s';
ALTER ROLE app_user SET idle_in_transaction_session_timeout = '60s';
ALTER ROLE app_user SET lock_timeout = '10s';
```

#### Size C ‚Äî ’Ñ’•’Æ ’∂’°’≠’°’£’´’Æ

```sql
-- app_user ‚Äî ’∂’∏÷Ç’µ’∂’® ’´’∂’π Size B
ALTER ROLE app_user SET statement_timeout = '30s';
ALTER ROLE app_user SET idle_in_transaction_session_timeout = '60s';
ALTER ROLE app_user SET lock_timeout = '10s';

-- analytics_user ‚Äî ’¥’•’≤’¥ ’¨’´’¥’´’ø’∂’•÷Ä ’∞’°’∑’æ’•’ø’æ’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’´ ’∞’°’¥’°÷Ä
ALTER ROLE analytics_user SET statement_timeout = '5min';
ALTER ROLE analytics_user SET idle_in_transaction_session_timeout = '5min';
ALTER ROLE analytics_user SET lock_timeout = '30s';
```

---

### .env-’´ ’Ø’°÷Ä’£’°’æ’∏÷Ä’∏÷Ç’¥ ’§’•÷Ä’•÷Ä’´ ’¢’°’™’°’∂’¥’°’∂ ’∞’°’¥’°÷Ä

#### Vercel Fullstack (Size A/B)

```bash
# Runtime ‚Äî app_user pooler-’∏’æ
DATABASE_URL="postgresql://app_user:pass@ep-xxx-pooler.neon.tech/neondb?sslmode=require&connection_limit=5&pool_timeout=10"

# ’Ñ’´’£÷Ä’°÷Å’´’°’∂’•÷Ä ‚Äî owner ’∏÷Ç’≤’≤’°’Ø’´ (’¥’´’°’µ’∂ CI/CD ÷á ’±’•’º÷Ñ’∏’æ ’£’∏÷Ä’Æ’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä)
DIRECT_URL="postgresql://neon_owner:pass@ep-xxx.neon.tech/neondb?sslmode=require"
```

#### Vercel Frontend + NestJS Backend (Size B/C)

```bash
# NestJS (.env Render/Railway-’∏÷Ç’¥) ‚Äî app_user pooler-’∏’æ
DATABASE_URL="postgresql://app_user:pass@ep-xxx-pooler.neon.tech/neondb?sslmode=require&connection_limit=10&pool_timeout=15"

# ’Ñ’´’£÷Ä’°÷Å’´’°’∂’•÷Ä CI/CD-’∏÷Ç’¥ ‚Äî owner
DIRECT_URL="postgresql://neon_owner:pass@ep-xxx.neon.tech/neondb?sslmode=require"
```

---

### ‚ö†Ô∏è ‘Ω’∏’π’®’∂’§’∏’ø’∂’•÷Ä

#### 1. DEFAULT PRIVILEGES ÷á Prisma migrate

`ALTER DEFAULT PRIVILEGES` ’Ø’´÷Ä’°’º’æ’∏÷Ç’¥ ’ß ’¥’´’°’µ’∂ **’®’∂’©’°÷Å’´’Ø ÷Ö’£’ø’°’ø’´÷Ä’∏’ª** ’Ω’ø’•’≤’Æ’°’Æ ’°’≤’µ’∏÷Ç’Ω’°’Ø’∂’•÷Ä’´’∂÷â ’Ä’°’¥’∏’¶’æ’´’õ÷Ä, ’∏÷Ä.
- `ALTER DEFAULT PRIVILEGES`-’® ’Ø’°’ø’°÷Ä’æ’∏÷Ç’¥ ’ß ’∂’∏÷Ç’µ’∂ owner-’´ ’°’∂’∏÷Ç’∂’´÷Å, ’∏’æ ’£’∏÷Ä’Æ’°÷Ä’Ø’∏÷Ç’¥ ’ß `prisma migrate deploy`
- ’Ö’∏÷Ç÷Ä’°÷Ñ’°’∂’π’µ’∏÷Ç÷Ä ’¥’´’£÷Ä’°÷Å’´’°’µ’´÷Å ’∞’•’ø’∏ `app_user`-’® ’°’æ’ø’∏’¥’°’ø ’Ω’ø’°’∂’∏÷Ç’¥ ’ß ’¥’∏÷Ç’ø÷Ñ ’∂’∏÷Ä ’°’≤’µ’∏÷Ç’Ω’°’Ø’∂’•÷Ä’´’∂

#### 2. Neon Branching ÷á ’§’•÷Ä’•÷Ä

Neon branch ’Ω’ø’•’≤’Æ’•’¨’´’Ω ’§’•÷Ä’•÷Ä’® **’∫’°’ø’≥’•’∂’æ’∏÷Ç’¥** ’•’∂ ’ø’æ’µ’°’¨’∂’•÷Ä’´ ’∞’•’ø, ’¢’°’µ÷Å.
- ’Å’•’º÷Ñ’∏’æ ’Ω’ø’•’≤’Æ’æ’°’Æ ’§’•÷Ä’•÷Ä’´ ’£’°’≤’ø’∂’°’¢’°’º’•÷Ä’® **’Ø’°÷Ä’∏’≤ ’•’∂ ’π’°’∑’≠’°’ø’•’¨** preview branches-’∏÷Ç’¥ Vercel Integration-’´ ’¥’´’ª’∏÷Å’∏’æ
- ‘º’∏÷Ç’Æ’∏÷Ç’¥ Size A/B-’´ ’∞’°’¥’°÷Ä. ÷Ö’£’ø’°’£’∏÷Ä’Æ’´’õ÷Ä ’¥’•’Ø `app_user` ’£’°’≤’ø’∂’°’¢’°’º ’¢’∏’¨’∏÷Ä branches-’´ ’∞’°’¥’°÷Ä
- ‘º’∏÷Ç’Æ’∏÷Ç’¥ Size C-’´ ’∞’°’¥’°÷Ä. CI-’∏÷Ç’¥ ’Ω’Ø÷Ä’´’∫’ø, ’∏÷Ä’® ’µ’∏÷Ç÷Ä’°÷Ñ’°’∂’π’µ’∏÷Ç÷Ä branch-’∏÷Ç’¥ ’æ’•÷Ä’°’Ω’ø’•’≤’Æ’∏÷Ç’¥/’Ω’ø’∏÷Ç’£’∏÷Ç’¥ ’ß ’§’•÷Ä’•÷Ä’®

```bash
# CI ’Ω’Ø÷Ä’´’∫’ø preview branches-’´ ’∞’°’¥’°÷Ä (Size C)
neonctl query "DO \$\$ BEGIN
  IF NOT EXISTS (SELECT FROM pg_roles WHERE rolname = 'app_user') THEN
    CREATE ROLE app_user WITH LOGIN PASSWORD '$APP_USER_PASSWORD';
  END IF;
END \$\$;" --project-id $NEON_PROJECT_ID --branch $BRANCH_NAME
```

#### 3. idle_in_transaction ÷á Prisma interactive transactions

Prisma `$transaction(async (tx) => { ... })` callback-’´ ’®’∂’©’°÷Å÷Ñ’∏÷Ç’¥ ’∫’°’∞’∏÷Ç’¥ ’ß ’ø÷Ä’°’∂’¶’°’Ø÷Å’´’°’∂ ’¢’°÷Å÷â ‘µ’©’• ’∂’•÷Ä’Ω’∏÷Ç’¥ ’°÷Ä’ø’°÷Ñ’´’∂ ’Ø’°’∂’π’•÷Ä ’Ø’°’∂ (API payment, email) ‚Äî ’Ø’°÷Ä’∏’≤ ’•’Ω ’§’∏÷Ç÷Ä’Ω ’£’°’¨ `idle_in_transaction_session_timeout`-’∏’æ÷â

```typescript
// ‚ùå ’é‘±’è ‚Äî ’°÷Ä’ø’°÷Ñ’´’∂ ’Ø’°’∂’π ’ø÷Ä’°’∂’¶’°’Ø÷Å’´’°’µ’´ ’∂’•÷Ä’Ω’∏÷Ç’¥
await prisma.$transaction(async (tx) => {
  const order = await tx.order.create({ data: orderData });
  await paymentService.charge(order.id); // ‘ø’°÷Ä’∏’≤ ’ß ’Ø’°’≠’æ’•’¨
  await tx.order.update({ where: { id: order.id }, data: { status: 'PAID' } });
});

// ‚úÖ ’É‘ª’á’è ‚Äî ’°÷Ä’ø’°÷Ñ’´’∂ ’Ø’°’∂’π’•÷Ä ’ø÷Ä’°’∂’¶’°’Ø÷Å’´’°’µ’´÷Å ’§’∏÷Ç÷Ä’Ω
const order = await prisma.order.create({ data: orderData });
const payment = await paymentService.charge(order.id);
await prisma.order.update({ where: { id: order.id }, data: { status: 'PAID' } });
```

#### 4. CONNECTION LIMIT ÷á autoscaling

Instance-’∂’•÷Ä’´ ’°’≥’´ ’™’°’¥’°’∂’°’Ø (Size B ‚Üí C) ’∫’•’ø÷Ñ ’ß ’æ’•÷Ä’°’∂’°’µ’•’¨ `CONNECTION LIMIT`-’®.
- ’Ñ’∏’∂’´’ø’∏÷Ä’´’õ÷Ä `pg_stat_activity` ’Ø’°’¥ Neon Dashboard ‚Üí Connections
- ‘±’¨’•÷Ä’ø ’•’©’• ÷Ö’£’ø’°’£’∏÷Ä’Æ’∏÷Ç’¥’® > 80% ’¨’´’¥’´’ø’´
- ‘π’°÷Ä’¥’°÷Å÷Ä’∏÷Ç’õ ’¨’´’¥’´’ø’® instance-’∂’•÷Ä’´ ’¥’°’Ω’∑’ø’°’¢’°’æ’∏÷Ä’¥’°’∂ ’Ü‘±‘Ω

---

## üìã ’ç’è’à’í‘≥‘±’ë’à’í’ë‘±‘ø

### Production-’´÷Å ’°’º’°’ª

- [ ] ‘≤’∏’¨’∏÷Ä ’´’∂’§’•÷Ñ’Ω’∂’•÷Ä’® ’Ω’ø’•’≤’Æ’æ’°’Æ ’•’∂ ’∞’°’≥’°’≠’°’Ø’´ ’∞’°÷Ä÷Å’∏÷Ç’¥’∂’•÷Ä’´ ’∞’°’¥’°÷Ä
- [ ] ’Ñ’´’£÷Ä’°÷Å’´’°’∂’•÷Ä’® ’©’•’Ω’ø’°’æ’∏÷Ä’æ’°’Æ ’•’∂ ’ø’æ’µ’°’¨’∂’•÷Ä’´ ’∫’°’ø’≥’•’∂’´ ’æ÷Ä’°
- [ ] N+1 ’≠’∂’§’´÷Ä’∂’•÷Ä ’π’Ø’°’∂
- [ ] ’è÷Ä’°’∂’¶’°’Ø÷Å’´’°’∂’•÷Ä ’Ø’°’∫’æ’°’Æ ’£’∏÷Ä’Æ’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’´ ’∞’°’¥’°÷Ä
- [ ] ‘ª’¥’∏÷Ç’ø’°÷Å’´’∏’∂ ’ª’∂’ª’∏÷Ç’¥ ’Ø’°÷Ä÷á’∏÷Ä ’ø’æ’µ’°’¨’∂’•÷Ä’´ ’∞’°’¥’°÷Ä
- [ ] Backup-’® ’Ø’°÷Ä’£’°’æ’∏÷Ä’æ’°’Æ ’ß *(’°’æ’ø’∏’¥’°’ø ’•’©’• Neon)*
- [ ] **Restore testing-’® ’Ø’°’ø’°÷Ä’æ’°’Æ ’ß** *(’∫’•’ø÷Ñ ’π’ß ’•’©’• Neon)*
- [ ] **RTO/RPO-’∂ ’Ω’°’∞’¥’°’∂’æ’°’Æ ’•’∂** *(Neon. RPO ~0, RTO ÷Ä’∏’∫’•’∂’•÷Ä)*

### ‘¥’•÷Ä’•÷Ä ÷á ’¨’´’¥’´’ø’∂’•÷Ä

#### ‘≤’∏’¨’∏÷Ä ’∂’°’≠’°’£’Æ’•÷Ä (A/B/C)

- [ ] `app_user`-’® ’Ω’ø’•’≤’Æ’æ’°’Æ ’ß DML-only ’´÷Ä’°’æ’∏÷Ç’∂÷Ñ’∂’•÷Ä’∏’æ
- [ ] `DEFAULT PRIVILEGES`-’® ’Ø’°÷Ä’£’°’æ’∏÷Ä’æ’°’Æ ’ß owner-’´ ’°’∂’∏÷Ç’∂’´÷Å
- [ ] `DATABASE_URL`-’® ÷Ö’£’ø’°’£’∏÷Ä’Æ’∏÷Ç’¥ ’ß `app_user` (’∏’π owner)
- [ ] `DIRECT_URL`-’® ÷Ö’£’ø’°’£’∏÷Ä’Æ’∏÷Ç’¥ ’ß owner (’¥’´’°’µ’∂ ’¥’´’£÷Ä’°÷Å’´’°’∂’•÷Ä’´ ’∞’°’¥’°÷Ä)
- [ ] `statement_timeout`-’® ’§÷Ä’æ’°’Æ ’ß `app_user`-’´ ’æ÷Ä’°
- [ ] `idle_in_transaction_session_timeout`-’® ’§÷Ä’æ’°’Æ ’ß `app_user`-’´ ’æ÷Ä’°
- [ ] `lock_timeout`-’® ’§÷Ä’æ’°’Æ ’ß `app_user`-’´ ’æ÷Ä’°
- [ ] `app_user`-’´ ’£’°’≤’ø’∂’°’¢’°’º’® ’£’•’∂’•÷Ä’°÷Å’æ’°’Æ ’ß ’Ø÷Ä’´’∫’ø’∏’£÷Ä’°÷Ü’´’°’Ø’°’∂ (`openssl rand -base64 32`)

#### ’Ñ’´’ª’´’∂ ÷á ’¥’•’Æ ’∂’°’≠’°’£’Æ’•÷Ä (B/C)

- [ ] `readonly_user`-’® ’Ω’ø’•’≤’Æ’æ’°’Æ ’ß *(’°’∂’°’¨’´’ø’´’Ø’°/’°’ª’°’Ø÷Å’∏÷Ç’©’µ’°’∂ ’∞’°’¥’°÷Ä)*
- [ ] `CONNECTION LIMIT`-’® ’§÷Ä’æ’°’Æ ’ß *(’•’©’• long-running backend)*
- [ ] ‘º’´’¥’´’ø’´ ’¢’°’∂’°’±÷á’® ÷É’°’Ω’ø’°’©’≤’©’°’æ’∏÷Ä’æ’°’Æ ’ß *(instance √ó pool + ’∫’°’∞’∏÷Ç’Ω’ø)*

#### ’Ñ’•’Æ ’∂’°’≠’°’£’Æ’•÷Ä (C)

- [ ] `analytics_user`-’® ’Ω’ø’•’≤’Æ’æ’°’Æ ’ß *(’•’©’• ’•÷Ä’Ø’°÷Ä ’∞’°’∑’æ’•’ø’æ’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä ’•’∂ ’∫’•’ø÷Ñ)*
- [ ] CI ’Ω’Ø÷Ä’´’∫’ø ’§’•÷Ä’•÷Ä’´ ’Ω’ø’•’≤’Æ’¥’°’∂ ’∞’°’¥’°÷Ä preview branches-’∏÷Ç’¥
- [ ] `pg_stat_activity`-’´ ’¥’∏’∂’´’ø’∏÷Ä’´’∂’£’® ’Ø’°÷Ä’£’°’æ’∏÷Ä’æ’°’Æ ’ß
- [ ] ‘±’¨’•÷Ä’ø CONNECTION LIMIT-’´ > 80% ÷Ö’£’ø’°’£’∏÷Ä’Æ’¥’°’∂ ’∞’°’¥’°÷Ä

### Backup ’Ω’ø’∏÷Ç’£’°÷Å’∏÷Ç÷Å’°’Ø (self-hosted)

> ‘≤’°÷Å ’©’∏’≤’∂’•’¨ ’•’©’• ÷Ö’£’ø’°’£’∏÷Ä’Æ’æ’∏÷Ç’¥ ’ß Neon ’Ø’°’¥ ’°’µ’¨ managed ’Ω’•÷Ä’æ’´’Ω

- [ ] ‘±’æ’ø’∏’¥’°’ø ’¢’•÷Ñ’°÷É’∂’•÷Ä’® ’Ø’°÷Ä’£’°’æ’∏÷Ä’æ’°’Æ ’•’∂
- [ ] Retention policy-’∂ ’Ω’°’∞’¥’°’∂’æ’°’Æ ’ß
- [ ] ‘≤’•÷Ñ’°÷É’∂’•÷Ä’® ’∫’°’∞’æ’∏÷Ç’¥ ’•’∂ ’°’º’°’∂’±’´’∂ ’ø’•’≤’∏÷Ç’¥ (’∏’π ’∂’∏÷Ç’µ’∂ ’Ω’•÷Ä’æ’•÷Ä’∏÷Ç’¥)
- [ ] Restore testing-’® ’Ø’°’ø’°÷Ä’æ’∏÷Ç’¥ ’ß ’∫’°÷Ä’¢’•÷Ä’°’¢’°÷Ä (’°’º’∂’æ’°’¶’∂ ’°’¥’Ω’°’Ø’°’∂)
- [ ] ’é’•÷Ä’°’Ø’°’∂’£’∂’¥’°’∂ Runbook-’® ÷É’°’Ω’ø’°’©’≤’©’°’æ’∏÷Ä’æ’°’Æ ’ß
- [ ] ‘±’¨’•÷Ä’ø’∂’•÷Ä ’¢’•÷Ñ’°÷É’∂’•÷Ä’´ ’¢’°÷Å’°’Ø’°’µ’∏÷Ç’©’µ’°’∂ ’∞’°’¥’°÷Ä

### Neon ’Ω’ø’∏÷Ç’£’°÷Å’∏÷Ç÷Å’°’Ø

- [ ] ’É’´’∑’ø ’∫’¨’°’∂’∂ ’®’∂’ø÷Ä’æ’°’Æ ’ß (Free/Pro/Scale)
- [ ] Vercel Integration-’® ’Ø’°÷Ä’£’°’æ’∏÷Ä’æ’°’Æ ’ß (’•’©’• Vercel)
- [ ] Connection pooling-’® ’¥’´’°÷Å’æ’°’Æ ’ß
- [ ] `directUrl`-’® ’Ø’°÷Ä’£’°’æ’∏÷Ä’æ’°’Æ ’ß ’¥’´’£÷Ä’°÷Å’´’°’∂’•÷Ä’´ ’∞’°’¥’°÷Ä

---

**’è’°÷Ä’¢’•÷Ä’°’Ø.** 1.3
**‘±’¥’Ω’°’©’´’æ.** 2026-02-12
