---
description: Observability-Õ« Õ¯Õ¡Õ¶Õ¸Õ¶Õ¶Õ¥Ö€Ö‰ Ô¼Õ¸Õ£Õ¡Õ¾Õ¸Ö€Õ¸Ö‚Õ´, Õ´Õ¥Õ¿Ö€Õ«Õ¯Õ¡Õ¶Õ¥Ö€, Õ°Õ¥Õ¿Õ¡Õ£Õ®Õ¸Ö‚Õ´, Õ´Õ¸Õ¶Õ«Õ¿Õ¸Ö€Õ«Õ¶Õ£Ö‰
globs: ["**/*.ts", "**/*.tsx", "**/api/**", "**/server/**"]
alwaysApply: false
---

# OBSERVABILITY-Ô» Ô¿Ô±Õ†ÕˆÕ†Õ†ÔµÕ

> ÔµÕ©Õ¥ Õ¹Õ¥Õ½ Õ¯Õ¡Ö€Õ¸Õ² Õ¹Õ¡ÖƒÕ¥Õ¬ â€” Õ¹Õ¥Õ½ Õ¯Õ¡Ö€Õ¸Õ² Õ¢Õ¡Ö€Õ¥Õ¬Õ¡Õ¾Õ¥Õ¬Ö‰ Ô¼Õ¸Õ£Õ¥Ö€, Õ´Õ¥Õ¿Ö€Õ«Õ¯Õ¡Õ¶Õ¥Ö€, Õ°Õ¥Õ¿Õ¡Õ£Õ®Õ¥Ö€ = Õ°Õ¡Õ´Õ¡Õ¯Õ¡Ö€Õ£Õ« Õ¨Õ¶Õ¯Õ¡Õ¬Õ¸Ö‚Õ´Ö‰

---

## ğŸ¯ Õ€Ô»Õ„Õ†Ô±Ô¿Ô±Õ† ÕÔ¿Ô¶Ô²ÕˆÕ’Õ†Õ”Õ†ÔµÕ

1. **Structured Logging** â€” JSON Õ¬Õ¸Õ£Õ¥Ö€ Õ¯Õ¸Õ¶Õ¿Õ¥Ö„Õ½Õ¿Õ¸Õ¾
2. **Correlation** â€” Request ID Õ¡Õ¶ÖÕ¶Õ¸Ö‚Õ´ Õ§ Õ¡Õ´Õ¢Õ¸Õ²Õ» Õ°Õ¡Õ´Õ¡Õ¯Õ¡Ö€Õ£Õ¸Õ¾
3. **Levels** â€” Õ³Õ«Õ·Õ¿ Õ¬Õ¸Õ£Õ¡Õ¾Õ¸Ö€Õ´Õ¡Õ¶ Õ´Õ¡Õ¯Õ¡Ö€Õ¤Õ¡Õ¯Õ¶Õ¥Ö€
4. **No PII** â€” Õ¡Õ¶Õ±Õ¶Õ¡Õ¯Õ¡Õ¶ Õ¿Õ¾ÕµÕ¡Õ¬Õ¶Õ¥Ö€ Õ¬Õ¸Õ£Õ¥Ö€Õ¸Ö‚Õ´ Õ‰Ô¼Ô»Õ†ÔµÔ¼

---

## ğŸ“Š OBSERVABILITY-Ô» ÔµÕÔµÕ” Õ€Ô±Õ„Ô±Õ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OBSERVABILITY                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     LOGS        â”‚    METRICS      â”‚     TRACES          â”‚
â”‚                 â”‚                 â”‚                     â”‚
â”‚  Ô»Õ¶Õ¹ Õ¿Õ¥Õ²Õ« Õ¸Ö‚Õ¶Õ¥ÖÕ¡Õ¾ â”‚  Õ”Õ¡Õ¶Õ«/ÔµÖ€Õ¢      â”‚  Õ€Õ¡Ö€ÖÕ´Õ¡Õ¶ Õ¸Ö‚Õ²Õ«Õ¶     â”‚
â”‚  Ô»Ö€Õ¡Õ¤Õ¡Ö€Õ±Õ¸Ö‚Õ©ÕµÕ¸Ö‚Õ¶Õ¶Õ¥Ö€Õ« Õ´Õ¡Õ¶Ö€Õ¡Õ´Õ¡Õ½Õ¶Õ¥Ö€ â”‚  Ô±Õ£Ö€Õ¥Õ£Õ¡ÖÕ¾Õ¡Õ®       â”‚  Ô²Õ¡Õ·Õ­Õ¾Õ¡Õ®           â”‚
â”‚  Debug/Troubleshootâ”‚ Ô±Õ¬Õ¥Ö€Õ¿Õ¶Õ¥Ö€/Õ¤Õ¡Õ·Õ¢Õ¸Ö€Õ¤Õ¶Õ¥Ö€â”‚  Ô¼Õ¡Õ¿Õ¥Õ¶Õ¿Õ¸Ö‚Õ©ÕµÕ¸Ö‚Õ¶   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Ô¼ÕˆÔ³Ô±ÕÕˆÕÕ„Ô±Õ† Ô¿Ô±Õ†ÕˆÕ†Õ†ÔµÕ

### Ô¼Õ¸Õ£Õ¡Õ¾Õ¸Ö€Õ´Õ¡Õ¶ Õ´Õ¡Õ¯Õ¡Ö€Õ¤Õ¡Õ¯Õ¶Õ¥Ö€

| Õ„Õ¡Õ¯Õ¡Ö€Õ¤Õ¡Õ¯ | ÔµÖ€Õ¢ Ö…Õ£Õ¿Õ¡Õ£Õ¸Ö€Õ®Õ¥Õ¬ | Production |
|---------|-------------------|------------|
| `error` | ÕˆÖ‚Õ·Õ¡Õ¤Ö€Õ¸Ö‚Õ©ÕµÕ¸Ö‚Õ¶ ÕºÕ¡Õ°Õ¡Õ¶Õ»Õ¸Õ² Õ½Õ­Õ¡Õ¬Õ¶Õ¥Ö€ | âœ… Ô±ÕµÕ¸ |
| `warn` | Õ€Õ¶Õ¡Ö€Õ¡Õ¾Õ¸Ö€ Õ­Õ¶Õ¤Õ«Ö€Õ¶Õ¥Ö€ | âœ… Ô±ÕµÕ¸ |
| `info` | Ô¿Õ¡Ö€Ö‡Õ¸Ö€ Õ¢Õ«Õ¦Õ¶Õ¥Õ½-Õ«Ö€Õ¡Õ¤Õ¡Ö€Õ±Õ¸Ö‚Õ©ÕµÕ¸Ö‚Õ¶Õ¶Õ¥Ö€ | âœ… Ô±ÕµÕ¸ |
| `debug` | Õ„Õ¡Õ¶Ö€Õ¡Õ´Õ¡Õ½Õ¶Õ¥Ö€ debug-Õ« Õ°Õ¡Õ´Õ¡Ö€ | âŒ ÕˆÕ¹ |
| `trace` | Õ‡Õ¡Õ¿ Õ´Õ¡Õ¶Ö€Õ¡Õ´Õ¡Õ½Õ¶ Õ¿Õ¥Õ²Õ¥Õ¯Õ¸Ö‚Õ©ÕµÕ¸Ö‚Õ¶ | âŒ ÕˆÕ¹ |

### Ô¿Õ¡Õ¼Õ¸Ö‚ÖÕ¾Õ¡Õ®Ö„Õ¡ÕµÕ«Õ¶ Õ¬Õ¸Õ£Õ¥Ö€

```typescript
// lib/logger.ts
import pino from 'pino';

const isProduction = process.env.NODE_ENV === 'production';

export const logger = pino({
  level: isProduction ? 'info' : 'debug',
  
  // JSON production-Õ¸Ö‚Õ´, pretty development-Õ¸Ö‚Õ´
  transport: isProduction
    ? undefined
    : {
        target: 'pino-pretty',
        options: {
          colorize: true,
          translateTime: 'HH:MM:ss',
        },
      },
  
  // Ô²Õ¡Õ¦Õ¡ÕµÕ«Õ¶ Õ¤Õ¡Õ·Õ¿Õ¥Ö€ Õ¢Õ¸Õ¬Õ¸Ö€ Õ¬Õ¸Õ£Õ¥Ö€Õ« Õ°Õ¡Õ´Õ¡Ö€
  base: {
    service: process.env.SERVICE_NAME || 'app',
    env: process.env.NODE_ENV,
    version: process.env.APP_VERSION,
  },
  
  // Timestamp-Õ« Ö†Õ¸Ö€Õ´Õ¡Õ¿Õ¡Õ¾Õ¸Ö€Õ¸Ö‚Õ´
  timestamp: pino.stdTimeFunctions.isoTime,
  
  // Ô¶Õ£Õ¡ÕµÕ¸Ö‚Õ¶ Õ¿Õ¾ÕµÕ¡Õ¬Õ¶Õ¥Ö€Õ« Õ­Õ´Õ¢Õ¡Õ£Ö€Õ¸Ö‚Õ´
  redact: {
    paths: [
      'password',
      'passwordHash',
      'token',
      'accessToken',
      'refreshToken',
      'authorization',
      'cookie',
      'creditCard',
      '*.password',
      '*.token',
    ],
    censor: '[REDACTED]',
  },
});

// Child logger Õ¯Õ¸Õ¶Õ¿Õ¥Ö„Õ½Õ¿Õ¸Õ¾
export function createLogger(context: Record<string, unknown>) {
  return logger.child(context);
}
```

### Ô¼Õ¸Õ£Õ¡Õ¾Õ¸Ö€Õ´Õ¡Õ¶ Õ¯Õ¡Õ¶Õ¸Õ¶Õ¶Õ¥Ö€

```typescript
// âœ… ÕƒÔ»Õ‡Õ â€” Õ¯Õ¡Õ¼Õ¸Ö‚ÖÕ¾Õ¡Õ®Ö„Õ¡ÕµÕ«Õ¶ Õ¬Õ¸Õ£Õ¥Ö€ Õ¯Õ¸Õ¶Õ¿Õ¥Ö„Õ½Õ¿Õ¸Õ¾

// INFO â€” Õ¯Õ¡Ö€Ö‡Õ¸Ö€ Õ¢Õ«Õ¦Õ¶Õ¥Õ½-Õ«Ö€Õ¡Õ¤Õ¡Ö€Õ±Õ¸Ö‚Õ©ÕµÕ¸Ö‚Õ¶Õ¶Õ¥Ö€
logger.info({
  event: 'order.created',
  orderId: order.id,
  userId: user.id,
  total: order.total,
  itemCount: order.items.length,
}, 'Order created successfully');

// WARN â€” Õ°Õ¶Õ¡Ö€Õ¡Õ¾Õ¸Ö€ Õ­Õ¶Õ¤Õ«Ö€Õ¶Õ¥Ö€
logger.warn({
  event: 'payment.retry',
  orderId,
  attempt: 3,
  maxAttempts: 5,
}, 'Payment retry attempt');

// ERROR â€” Õ½Õ­Õ¡Õ¬Õ¶Õ¥Ö€ Õ¡Õ´Õ¢Õ¸Õ²Õ» Õ¯Õ¸Õ¶Õ¿Õ¥Ö„Õ½Õ¿Õ¸Õ¾
logger.error({
  event: 'payment.failed',
  orderId,
  errorCode: error.code,
  errorMessage: error.message,
  stack: error.stack,
}, 'Payment processing failed');

// DEBUG â€” Õ´Õ¡Õ¶Ö€Õ¡Õ´Õ¡Õ½Õ¶Õ¥Ö€ debug-Õ« Õ°Õ¡Õ´Õ¡Ö€ (Õ¸Õ¹ production-Õ¸Ö‚Õ´)
logger.debug({
  event: 'cache.miss',
  key: cacheKey,
  duration: fetchTime,
}, 'Cache miss, fetched from database');
```

```typescript
// âŒ ÕÔ½Ô±Ô¼

// Ô¿Õ¡Õ¼Õ¸Ö‚ÖÕ¾Õ¡Õ®Ö„ Õ¹Õ¯Õ¡
logger.info('Order created');

// Ô±Õ¶Õ±Õ¶Õ¡Õ¯Õ¡Õ¶ Õ¿Õ¾ÕµÕ¡Õ¬Õ¶Õ¥Ö€
logger.info({ email, password }, 'User login');

// Õ‰Õ¡ÖƒÕ«Ö Õ·Õ¡Õ¿ info-Õ¸Ö‚Õ´
logger.info({ fullRequest, fullResponse }, 'API call');

// ÕÕ­Õ¡Õ¬Õ« Õ°Õ¡Õ´Õ¡Ö€ Õ¯Õ¸Õ¶Õ¿Õ¥Ö„Õ½Õ¿ Õ¹Õ¯Õ¡
logger.error('Something went wrong');
```

### Next.js Request Logging (middleware)

```typescript
// middleware.ts
import { NextRequest, NextResponse } from 'next/server';
import { v4 as uuid } from 'uuid';

export function middleware(req: NextRequest) {
  const requestId = req.headers.get('x-request-id') ?? uuid();
  const start = Date.now();

  const response = NextResponse.next();
  response.headers.set('x-request-id', requestId);

  // Structured log Vercel Logs / ÖÕ¡Õ¶Õ¯Õ¡ÖÕ¡Õ® log collector-Õ« Õ°Õ¡Õ´Õ¡Ö€
  // Edge Runtime-Õ¸Ö‚Õ´ (middleware) pino-Õ¶ Õ¹Õ« Õ¡Õ·Õ­Õ¡Õ¿Õ¸Ö‚Õ´, Ö…Õ£Õ¿Õ¡Õ£Õ¸Ö€Õ®Õ¸Ö‚Õ´ Õ¥Õ¶Ö„ structuredClone + stdout
  const log = {
    level: 'info',
    event: 'request',
    requestId,
    method: req.method,
    path: req.nextUrl.pathname,
    userAgent: req.headers.get('user-agent'),
    ip: req.headers.get('x-forwarded-for'),
    timestamp: new Date().toISOString(),
  };
  // eslint-disable-next-line no-console -- Edge Runtime-Õ¸Ö‚Õ´ pino-Õ¶ Õ°Õ¡Õ½Õ¡Õ¶Õ¥Õ¬Õ« Õ¹Õ§
  console.info(JSON.stringify(log));

  return response;
}

export const config = {
  matcher: ['/api/:path*'],
};
```

### Next.js Logging Route Handlers-Õ¸Ö‚Õ´ Ö‡ Server Actions-Õ¸Ö‚Õ´

```typescript
// lib/logger.ts â€” Õ´Õ«Õ¡Õ½Õ¶Õ¡Õ¯Õ¡Õ¶ logger Next.js-Õ« Õ°Õ¡Õ´Õ¡Ö€
import pino from 'pino';

export const logger = pino({
  level: process.env.LOG_LEVEL || 'info',
  transport: process.env.NODE_ENV === 'development'
    ? { target: 'pino-pretty' }
    : undefined,
});

// app/api/orders/route.ts â€” Ö…Õ£Õ¿Õ¡Õ£Õ¸Ö€Õ®Õ¸Ö‚Õ´ route handler-Õ¸Ö‚Õ´
import { NextRequest, NextResponse } from 'next/server';
import { logger } from '@/lib/logger';

export async function POST(req: NextRequest) {
  const reqLogger = logger.child({ handler: 'POST /api/orders' });
  const body = await req.json();

  reqLogger.info({ userId: body.userId }, 'Creating order');

  try {
    const order = await createOrder(body);
    reqLogger.info({ orderId: order.id }, 'Order created');
    return NextResponse.json({ data: order }, { status: 201 });
  } catch (error) {
    reqLogger.error({ err: error }, 'Failed to create order');
    return NextResponse.json({ error: { code: 'SERVER_ERROR' } }, { status: 500 });
  }
}
```

### NestJS/Express Request Logging Middleware

```typescript
// middleware/request-logger.ts
import { Request, Response, NextFunction } from 'express';
import { v4 as uuid } from 'uuid';
import { logger } from '@/lib/logger';

export function requestLogger(
  req: Request,
  res: Response,
  next: NextFunction,
) {
  // ÕÕ¿Õ¥Õ²Õ®Õ¸Ö‚Õ´ Õ¯Õ¡Õ´ Õ¾Õ¥Ö€ÖÕ¶Õ¸Ö‚Õ´ Õ¥Õ¶Ö„ requestId
  const requestId = (req.headers['x-request-id'] as string) || uuid();
  req.headers['x-request-id'] = requestId;
  res.setHeader('x-request-id', requestId);

  // Ô¸Õ¶Õ¤Õ¬Õ¡ÕµÕ¶Õ¾Õ¡Õ® Request-Õ« Õ¿Õ«ÕºÕ¡ÖÕ¸Ö‚Õ´
  interface AuthenticatedRequest extends Request {
    user?: { id: string };
    logger?: ReturnType<typeof logger.child>;
  }

  const authReq = req as AuthenticatedRequest;

  // ÕÕ¿Õ¥Õ²Õ®Õ¸Ö‚Õ´ Õ¥Õ¶Ö„ logger Õ°Õ¡Ö€ÖÕ´Õ¡Õ¶ Õ¯Õ¸Õ¶Õ¿Õ¥Ö„Õ½Õ¿Õ¸Õ¾
  const reqLogger = logger.child({
    requestId,
    method: req.method,
    path: req.path,
    userAgent: req.headers['user-agent'],
    ip: req.ip,
    userId: authReq.user?.id,
  });

  // ÕÕ¯Õ¦Õ¢Õ« ÕªÕ¡Õ´Õ¡Õ¶Õ¡Õ¯
  const startTime = Date.now();

  // Ô¼Õ¸Õ£Õ¡Õ¾Õ¸Ö€Õ¸Ö‚Õ´ Õ¥Õ¶Ö„ Õ°Õ¡Ö€ÖÕ´Õ¡Õ¶ Õ½Õ¯Õ«Õ¦Õ¢Õ¨
  reqLogger.info({ event: 'request.start' }, 'Incoming request');

  // Ô¼Õ¸Õ£Õ¡Õ¾Õ¸Ö€Õ¸Ö‚Õ´ Õ¥Õ¶Ö„ Õ¡Õ¾Õ¡Ö€Õ¿Õ¨
  res.on('finish', () => {
    const duration = Date.now() - startTime;
    const level = res.statusCode >= 400 ? 'warn' : 'info';

    reqLogger[level]({
      event: 'request.end',
      statusCode: res.statusCode,
      duration,
    }, `Request completed in ${duration}ms`);
  });

  // Ô±Õ¾Õ¥Õ¬Õ¡ÖÕ¶Õ¸Ö‚Õ´ Õ¥Õ¶Ö„ logger request-Õ«Õ¶ handlers-Õ¸Ö‚Õ´ Ö…Õ£Õ¿Õ¡Õ£Õ¸Ö€Õ®Õ¥Õ¬Õ¸Ö‚ Õ°Õ¡Õ´Õ¡Ö€
  authReq.logger = reqLogger;

  next();
}
```

### NestJS Logger

```typescript
// common/logger/logger.service.ts
import { Injectable, LoggerService, Scope } from '@nestjs/common';
import { logger as pinoLogger } from '@/lib/logger';
import type { Logger } from 'pino';

@Injectable({ scope: Scope.TRANSIENT })
export class AppLogger implements LoggerService {
  private context?: string;
  private logger: Logger;

  constructor() {
    this.logger = pinoLogger;
  }

  setContext(context: string) {
    this.context = context;
    this.logger = pinoLogger.child({ context });
  }

  log(message: string, context?: Record<string, unknown>) {
    this.logger.info(context || {}, message);
  }

  error(message: string, trace?: string, context?: Record<string, unknown>) {
    this.logger.error({ ...context, stack: trace }, message);
  }

  warn(message: string, context?: Record<string, unknown>) {
    this.logger.warn(context || {}, message);
  }

  debug(message: string, context?: Record<string, unknown>) {
    this.logger.debug(context || {}, message);
  }
}

// Õ•Õ£Õ¿Õ¡Õ£Õ¸Ö€Õ®Õ¸Ö‚Õ´ Õ½Õ¥Ö€Õ¾Õ«Õ½Õ¸Ö‚Õ´
@Injectable()
export class OrdersService {
  private readonly logger = new AppLogger();

  constructor() {
    this.logger.setContext(OrdersService.name);
  }

  async create(dto: CreateOrderDto, userId: string) {
    this.logger.log('Creating order', { userId, itemCount: dto.items.length });
    
    try {
      const order = await this.processOrder(dto);
      this.logger.log('Order created', { orderId: order.id, userId });
      return order;
    } catch (error) {
      this.logger.error('Failed to create order', error.stack, {
        userId,
        errorCode: error.code,
      });
      throw error;
    }
  }
}
```

---

## ğŸ“ˆ Õ„ÔµÕÕÔ»Ô¿Ô±Õ†ÔµÕ

### Õ„Õ¥Õ¿Ö€Õ«Õ¯Õ¡Õ¶Õ¥Ö€Õ« Õ¿Õ«ÕºÕ¥Ö€

| ÕÕ«Õº | Õ†Õ¯Õ¡Ö€Õ¡Õ£Ö€Õ¸Ö‚Õ©ÕµÕ¸Ö‚Õ¶ | Õ•Ö€Õ«Õ¶Õ¡Õ¯ |
|-----|----------|--------|
| Counter | Õ€Õ¡Õ·Õ¾Õ«Õ¹ (Õ´Õ«Õ¡ÕµÕ¶ Õ¡Õ³Õ¸Ö‚Õ´ Õ§) | Õ€Õ¡Ö€ÖÕ¸Ö‚Õ´Õ¶Õ¥Ö€Õ« Ö„Õ¡Õ¶Õ¡Õ¯ |
| Gauge | Ô¸Õ¶Õ©Õ¡ÖÕ«Õ¯ Õ¡Ö€ÕªÕ¥Ö„ | Ô±Õ¯Õ¿Õ«Õ¾ Õ¯Õ¡ÕºÕ¥Ö€ |
| Histogram | Ô±Ö€ÕªÕ¥Ö„Õ¶Õ¥Ö€Õ« Õ¢Õ¡Õ·Õ­Õ¸Ö‚Õ´ | ÕŠÕ¡Õ¿Õ¡Õ½Õ­Õ¡Õ¶Õ« ÕªÕ¡Õ´Õ¡Õ¶Õ¡Õ¯ |
| Summary | Ô¿Õ¾Õ¡Õ¶Õ¿Õ«Õ¬Õ¶Õ¥Ö€ | P50, P95, P99 Õ¬Õ¡Õ¿Õ¥Õ¶Õ¿Õ¸Ö‚Õ©ÕµÕ¸Ö‚Õ¶ |

### Õ€Õ«Õ´Õ¶Õ¡Õ¯Õ¡Õ¶ Õ´Õ¥Õ¿Ö€Õ«Õ¯Õ¡Õ¶Õ¥Ö€

```typescript
// metrics/app.metrics.ts
import { Counter, Histogram, Gauge, Summary } from 'prom-client';

// HTTP Õ´Õ¥Õ¿Ö€Õ«Õ¯Õ¡Õ¶Õ¥Ö€
export const httpMetrics = {
  // Õ€Õ¡Ö€ÖÕ¸Ö‚Õ´Õ¶Õ¥Ö€Õ« Ö„Õ¡Õ¶Õ¡Õ¯
  requestsTotal: new Counter({
    name: 'http_requests_total',
    help: 'Total number of HTTP requests',
    labelNames: ['method', 'path', 'status'],
  }),

  // ÕŠÕ¡Õ¿Õ¡Õ½Õ­Õ¡Õ¶Õ« ÕªÕ¡Õ´Õ¡Õ¶Õ¡Õ¯
  requestDuration: new Histogram({
    name: 'http_request_duration_seconds',
    help: 'HTTP request duration in seconds',
    labelNames: ['method', 'path', 'status'],
    buckets: [0.01, 0.05, 0.1, 0.5, 1, 2, 5],
  }),

  // Ô±Õ¯Õ¿Õ«Õ¾ Õ°Õ¡Ö€ÖÕ¸Ö‚Õ´Õ¶Õ¥Ö€
  requestsInProgress: new Gauge({
    name: 'http_requests_in_progress',
    help: 'Number of HTTP requests in progress',
    labelNames: ['method'],
  }),
};

// Ô²Õ«Õ¦Õ¶Õ¥Õ½ Õ´Õ¥Õ¿Ö€Õ«Õ¯Õ¡Õ¶Õ¥Ö€
export const businessMetrics = {
  ordersCreated: new Counter({
    name: 'orders_created_total',
    help: 'Total number of orders created',
    labelNames: ['status'],
  }),

  orderValue: new Histogram({
    name: 'order_value_amount',
    help: 'Order value distribution',
    buckets: [10, 50, 100, 500, 1000, 5000],
  }),

  paymentProcessingTime: new Histogram({
    name: 'payment_processing_seconds',
    help: 'Payment processing time',
    labelNames: ['provider'],
    buckets: [0.5, 1, 2, 5, 10, 30],
  }),
};

// Ô²Ô´ Õ´Õ¥Õ¿Ö€Õ«Õ¯Õ¡Õ¶Õ¥Ö€
export const dbMetrics = {
  queryDuration: new Histogram({
    name: 'db_query_duration_seconds',
    help: 'Database query duration',
    labelNames: ['operation', 'table'],
    buckets: [0.001, 0.01, 0.05, 0.1, 0.5, 1],
  }),

  connectionPoolSize: new Gauge({
    name: 'db_connection_pool_size',
    help: 'Database connection pool size',
    labelNames: ['state'], // active, idle, waiting
  }),
};
```

### RED Õ´Õ¥Õ¿Ö€Õ«Õ¯Õ¡Õ¶Õ¥Ö€ (Õ½Õ¥Ö€Õ¾Õ«Õ½Õ¶Õ¥Ö€Õ« Õ°Õ¡Õ´Õ¡Ö€)

```
Rate     â€” Õ°Õ¡Ö€ÖÕ¸Ö‚Õ´Õ¶Õ¥Ö€ Õ¾Õ¡ÕµÖ€Õ¯ÕµÕ¡Õ¶Õ¸Ö‚Õ´
Errors   â€” Õ½Õ­Õ¡Õ¬Õ¶Õ¥Ö€Õ« Õ¿Õ¸Õ¯Õ¸Õ½
Duration â€” ÕºÕ¡Õ¿Õ¡Õ½Õ­Õ¡Õ¶Õ« ÕªÕ¡Õ´Õ¡Õ¶Õ¡Õ¯ (P50, P95, P99)
```

### USE Õ´Õ¥Õ¿Ö€Õ«Õ¯Õ¡Õ¶Õ¥Ö€ (Õ¼Õ¥Õ½Õ¸Ö‚Ö€Õ½Õ¶Õ¥Ö€Õ« Õ°Õ¡Õ´Õ¡Ö€)

```
Utilization â€” Ö…Õ£Õ¿Õ¡Õ£Õ¸Ö€Õ®Õ´Õ¡Õ¶ %
Saturation  â€” Õ°Õ¥Ö€Õ©/Õ½ÕºÕ¡Õ½Õ¸Ö‚Õ´
Errors      â€” Õ½Õ­Õ¡Õ¬Õ¶Õ¥Ö€Õ« Ö„Õ¡Õ¶Õ¡Õ¯
```

---

## ğŸ”— DISTRIBUTED TRACING

### Correlation ID

```typescript
// === Next.js â€” middleware.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { v4 as uuid } from 'uuid';

export function middleware(req: NextRequest) {
  const correlationId =
    req.headers.get('x-correlation-id') ??
    req.headers.get('x-request-id') ??
    uuid();

  // Õ“Õ¸Õ­Õ¡Õ¶ÖÕ¸Ö‚Õ´ Õ¥Õ¶Ö„ headers-Õ¸Ö‚Õ´ route handlers-Õ«Õ¶
  const requestHeaders = new Headers(req.headers);
  requestHeaders.set('x-correlation-id', correlationId);

  const response = NextResponse.next({ request: { headers: requestHeaders } });
  response.headers.set('x-correlation-id', correlationId);
  return response;
}

// Ô¿Õ¡Ö€Õ¤Õ¡Õ¬ route handler-Õ¸Ö‚Õ´:
// const correlationId = req.headers.get('x-correlation-id');

// === NestJS/Express â€” middleware/correlation.ts ===
import { AsyncLocalStorage } from 'async_hooks';
import { v4 as uuid } from 'uuid';
import { Request, Response, NextFunction } from 'express';

const correlationStorage = new AsyncLocalStorage<{ correlationId: string }>();

export function correlationMiddleware(
  req: Request,
  res: Response,
  next: NextFunction,
) {
  const correlationId = 
    (req.headers['x-correlation-id'] as string) ??
    (req.headers['x-request-id'] as string) ??
    uuid();

  req.headers['x-correlation-id'] = correlationId;
  res.setHeader('x-correlation-id', correlationId);

  // Ô±Õ¾Õ¥Õ¬Õ¡ÖÕ¶Õ¸Ö‚Õ´ Õ¥Õ¶Ö„ AsyncLocalStorage-Õ¸Ö‚Õ´ Õ¡Õ´Õ¥Õ¶Õ¸Ö‚Ö€ Õ°Õ¡Õ½Õ¡Õ¶Õ¥Õ¬Õ«Õ¸Ö‚Õ©ÕµÕ¡Õ¶ Õ°Õ¡Õ´Õ¡Ö€
  correlationStorage.run({ correlationId }, () => {
    next();
  });
}

// Correlation ID-Õ« Õ½Õ¿Õ¡ÖÕ¸Ö‚Õ´ Õ¯Õ¸Õ¤Õ« ÖÕ¡Õ¶Õ¯Õ¡ÖÕ¡Õ® Õ¿Õ¥Õ²Õ«Ö
export function getCorrelationId(): string | undefined {
  return correlationStorage.getStore()?.correlationId;
}
```

### Õ“Õ¸Õ­Õ¡Õ¶ÖÕ¸Ö‚Õ´ Õ¡Ö€Õ¿Õ¡Ö„Õ«Õ¶ Õ¯Õ¡Õ¶Õ¹Õ¥Ö€Õ«Õ¶

```typescript
// lib/api-client.ts

export async function externalApiCall<T>(
  url: string,
  options?: RequestInit,
): Promise<T> {
  const correlationId = getCorrelationId();

  const response = await fetch(url, {
    ...options,
    headers: {
      ...options?.headers,
      'x-correlation-id': correlationId || uuid(),
    },
  });

  return response.json();
}
```

### OpenTelemetry (Õ´Õ¥Õ® Õ¶Õ¡Õ­Õ¡Õ£Õ®Õ¥Ö€Õ« Õ°Õ¡Õ´Õ¡Ö€)

```typescript
// instrumentation.ts
import { NodeSDK } from '@opentelemetry/sdk-node';
import { getNodeAutoInstrumentations } from '@opentelemetry/auto-instrumentations-node';
import { OTLPTraceExporter } from '@opentelemetry/exporter-trace-otlp-http';

const sdk = new NodeSDK({
  serviceName: process.env.SERVICE_NAME,
  traceExporter: new OTLPTraceExporter({
    url: process.env.OTEL_EXPORTER_OTLP_ENDPOINT,
  }),
  instrumentations: [
    getNodeAutoInstrumentations({
      '@opentelemetry/instrumentation-fs': { enabled: false },
    }),
  ],
});

sdk.start();
```

---

## ğŸš¨ Ô±Ô¼ÔµÕÕÕ†ÔµÕ

### Ô±Õ¬Õ¥Ö€Õ¿Õ¶Õ¥Ö€Õ« Õ¯Õ¡Õ¶Õ¸Õ¶Õ¶Õ¥Ö€

```yaml
# Ô¿Ö€Õ«Õ¿Õ«Õ¯ (Õ¡Õ¶Õ°Õ¡ÕºÕ¡Õ² Õ¡Ö€Õ±Õ¡Õ£Õ¡Õ¶Ö„)
- alert: HighErrorRate
  condition: error_rate > 5%
  for: 5m
  severity: critical

- alert: ServiceDown
  condition: up == 0
  for: 1m
  severity: critical

# Õ†Õ¡Õ­Õ¡Õ¦Õ£Õ¸Ö‚Õ·Õ¡ÖÕ¸Ö‚Õ´Õ¶Õ¥Ö€ (ÕºÕ¡Ö€Õ¦Õ¡Õ¢Õ¡Õ¶Õ¥Õ¬)
- alert: HighLatency
  condition: p99_latency > 2s
  for: 10m
  severity: warning

- alert: DiskSpaceRunningLow
  condition: disk_usage > 80%
  for: 30m
  severity: warning
```

### SLI/SLO (Service Level Indicators/Objectives)

```markdown
## SLO API-Õ« Õ°Õ¡Õ´Õ¡Ö€

| Õ„Õ¥Õ¿Ö€Õ«Õ¯Õ¡ | SLO | Õ‰Õ¡ÖƒÕ¸Ö‚Õ´ |
|---------|-----|--------|
| Availability | 99.9% | Õ€Õ¡Õ»Õ¸Õ² Õ°Õ¡Ö€ÖÕ¸Ö‚Õ´Õ¶Õ¥Ö€ / Ô²Õ¸Õ¬Õ¸Ö€ Õ°Õ¡Ö€ÖÕ¸Ö‚Õ´Õ¶Õ¥Ö€ |
| Latency P99 | < 500ms | ÕŠÕ¡Õ¿Õ¡Õ½Õ­Õ¡Õ¶Õ« ÕªÕ¡Õ´Õ¡Õ¶Õ¡Õ¯Õ« 99-Ö€Õ¤ ÕºÕ¥Ö€ÖÕ¥Õ¶Õ¿Õ«Õ¬ |
| Error Rate | < 0.1% | 5xx Õ½Õ­Õ¡Õ¬Õ¶Õ¥Ö€ / Ô²Õ¸Õ¬Õ¸Ö€ Õ°Õ¡Ö€ÖÕ¸Ö‚Õ´Õ¶Õ¥Ö€ |

## Error Budget

- SLO 99.9% = 0.1% Õ©Õ¸Ö‚ÕµÕ¬Õ¡Õ¿Ö€Õ¥Õ¬Õ« Õ½Õ­Õ¡Õ¬Õ¶Õ¥Ö€
- 43.2 Ö€Õ¸ÕºÕ¥ downtime Õ¡Õ´Õ½Õ¸Ö‚Õ´
- Ô¹Õ¥Ö€Õ¡ÖÕ¸Ö‚Õ´Õ«Ö Õ¢Õ¡Ö€Õ±Ö€ â€” Õ¼Õ¥Õ¬Õ«Õ¦Õ¶Õ¥Ö€Õ« Õ½Õ¡Õ¼Õ¥ÖÕ¸Ö‚Õ´
```

---

## ğŸ“‹ Ô»Õ†Õ‰ Ô¼ÕˆÔ³Ô±ÕÕˆÕÔµÔ¼

### âœ… Ô¼ÕˆÔ³Ô±ÕÕˆÕÔ»Õ›Õ

```typescript
// Ô²Õ«Õ¦Õ¶Õ¥Õ½-Õ«Ö€Õ¡Õ¤Õ¡Ö€Õ±Õ¸Ö‚Õ©ÕµÕ¸Ö‚Õ¶Õ¶Õ¥Ö€
logger.info({ event: 'user.registered', userId });
logger.info({ event: 'order.created', orderId, total });
logger.info({ event: 'payment.completed', orderId, amount });

// ÕÕ­Õ¡Õ¬Õ¶Õ¥Ö€ Õ¯Õ¸Õ¶Õ¿Õ¥Ö„Õ½Õ¿Õ¸Õ¾
logger.error({ event: 'payment.failed', orderId, errorCode, stack });

// Ô±Ö€Õ¿Õ¡Õ¤Ö€Õ¸Õ²Õ¡Õ¯Õ¡Õ¶Õ¸Ö‚Õ©ÕµÕ¸Ö‚Õ¶
logger.info({ event: 'db.query', duration, query: 'findUsers' });

// Security Õ«Ö€Õ¡Õ¤Õ¡Ö€Õ±Õ¸Ö‚Õ©ÕµÕ¸Ö‚Õ¶Õ¶Õ¥Ö€
logger.warn({ event: 'auth.failed', ip, email: maskEmail(email) });
logger.info({ event: 'password.changed', userId });
```

### âŒ Õ„Ô» Ô¼ÕˆÔ³Ô±ÕÕˆÕÔ»Õ›Õ

```typescript
// Ô±Õ¶Õ±Õ¶Õ¡Õ¯Õ¡Õ¶ Õ¿Õ¾ÕµÕ¡Õ¬Õ¶Õ¥Ö€
logger.info({ password, ssn, creditCard }); // âŒ

// Ô¹Õ¸Ö„Õ¥Õ¶Õ¶Õ¥Ö€ Ö‡ Õ£Õ¡Õ²Õ¿Õ¶Õ«Ö„Õ¶Õ¥Ö€
logger.debug({ accessToken, apiKey }); // âŒ

// Õ‰Õ¡ÖƒÕ«Ö Õ´Õ¡Õ¶Ö€Õ¡Õ´Õ¡Õ½Õ¶ Õ¿Õ¾ÕµÕ¡Õ¬Õ¶Õ¥Ö€
logger.info({ fullRequestBody, fullResponseBody }); // âŒ

// Õ…Õ¸Ö‚Ö€Õ¡Ö„Õ¡Õ¶Õ¹ÕµÕ¸Ö‚Ö€ Ö†Õ¸Ö‚Õ¶Õ¯ÖÕ«Õ¡ÕµÕ« Õ¯Õ¡Õ¶Õ¹
logger.debug('Entering function X'); // âŒ Õ‰Õ¡ÖƒÕ«Ö Õ¡Õ²Õ´Õ¯Õ¸Õ¿
```

---

## ğŸ“‹ ÕÕÕˆÕ’Ô³Ô±Õ‘ÕˆÕ’Õ‘Ô±Ô¿

### Ô¼Õ¸Õ£Õ¡Õ¾Õ¸Ö€Õ¸Ö‚Õ´

- [ ] Õ•Õ£Õ¿Õ¡Õ£Õ¸Ö€Õ®Õ¾Õ¸Ö‚Õ´ Õ§ structured logging (JSON)
- [ ] Ô¿Õ¡Ö€Õ£Õ¡Õ¾Õ¸Ö€Õ¾Õ¡Õ® Õ¥Õ¶ Õ³Õ«Õ·Õ¿ Õ´Õ¡Õ¯Õ¡Ö€Õ¤Õ¡Õ¯Õ¶Õ¥Ö€ (info prod-Õ¸Ö‚Õ´)
- [ ] Request ID ÕµÕ¸Ö‚Ö€Õ¡Ö„Õ¡Õ¶Õ¹ÕµÕ¸Ö‚Ö€ Õ¬Õ¸Õ£Õ¸Ö‚Õ´
- [ ] PII/Õ£Õ¡Õ²Õ¿Õ¶Õ«Ö„Õ¶Õ¥Ö€ Õ¬Õ¸Õ£Õ¥Ö€Õ¸Ö‚Õ´ Õ¹Õ¯Õ¡Õ¶
- [ ] ÕÕ­Õ¡Õ¬Õ¶Õ¥Ö€Õ¨ Õ¬Õ¸Õ£Õ¡Õ¾Õ¸Ö€Õ¾Õ¸Ö‚Õ´ Õ¥Õ¶ Õ¯Õ¸Õ¶Õ¿Õ¥Ö„Õ½Õ¿Õ¸Õ¾ Ö‡ stack trace-Õ¸Õ¾
- [ ] Ô²Õ«Õ¦Õ¶Õ¥Õ½-Õ«Ö€Õ¡Õ¤Õ¡Ö€Õ±Õ¸Ö‚Õ©ÕµÕ¸Ö‚Õ¶Õ¶Õ¥Ö€Õ¨ Õ¬Õ¸Õ£Õ¡Õ¾Õ¸Ö€Õ¾Õ¸Ö‚Õ´ Õ¥Õ¶

### Õ„Õ¥Õ¿Ö€Õ«Õ¯Õ¡Õ¶Õ¥Ö€

- [ ] HTTP Õ´Õ¥Õ¿Ö€Õ«Õ¯Õ¡Õ¶Õ¥Ö€ (rate, errors, duration)
- [ ] Ô²Õ«Õ¦Õ¶Õ¥Õ½-Õ´Õ¥Õ¿Ö€Õ«Õ¯Õ¡Õ¶Õ¥Ö€ (orders, payments, etc.)
- [ ] Ô²Ô´ Õ´Õ¥Õ¿Ö€Õ«Õ¯Õ¡Õ¶Õ¥Ö€ (query time, connections)
- [ ] Õ„Õ¥Õ¿Ö€Õ«Õ¯Õ¡Õ¶Õ¥Ö€ Õ°Õ¡Õ½Õ¡Õ¶Õ¥Õ¬Õ« /metrics endpoint-Õ¸Õ¾

### Õ„Õ¸Õ¶Õ«Õ¿Õ¸Ö€Õ«Õ¶Õ£

- [ ] Ô´Õ¡Õ·Õ¢Õ¸Ö€Õ¤Õ¶Õ¥Ö€ Õ°Õ«Õ´Õ¶Õ¡Õ¯Õ¡Õ¶ Õ´Õ¥Õ¿Ö€Õ«Õ¯Õ¡Õ¶Õ¥Ö€Õ« Õ°Õ¡Õ´Õ¡Ö€
- [ ] Ô±Õ¬Õ¥Ö€Õ¿Õ¶Õ¥Ö€ Õ¯Ö€Õ«Õ¿Õ«Õ¯ Õ«Ö€Õ¡Õ¤Õ¡Ö€Õ±Õ¸Ö‚Õ©ÕµÕ¸Ö‚Õ¶Õ¶Õ¥Ö€Õ« Õ°Õ¡Õ´Õ¡Ö€
- [ ] SLO-Õ¶Õ¥Ö€ Õ½Õ¡Õ°Õ´Õ¡Õ¶Õ¾Õ¡Õ® Ö‡ Õ°Õ¥Õ¿Ö‡Õ¾Õ¸Ö‚Õ´ Õ¥Õ¶

---

**ÕÕ¡Ö€Õ¢Õ¥Ö€Õ¡Õ¯.** 1.1
**Ô±Õ´Õ½Õ¡Õ©Õ«Õ¾.** 2026-02-12
