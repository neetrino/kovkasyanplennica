---
description: API-’´ ’∂’°’≠’°’£’Æ’¥’°’∂ ’Ø’°’∂’∏’∂’∂’•÷Ä÷â ‘ø’´÷Ä’°’º’æ’∏÷Ç’¥ ’ß REST endpoints-’´’∂ ÷á ’Ø’∏’∂’ø÷Ä’°’Ø’ø’∂’•÷Ä’´’∂÷â
globs: ["**/api/**", "**/*.controller.ts", "**/routes/**"]
alwaysApply: false
---

# API-‘ª ’Ü‘±‘Ω‘±‘≥‘æ’Ñ‘±’Ü ‘ø‘±’Ü’à’Ü’Ü‘µ’ê

> RESTful, ’∞’°’¥’°’∞’∏÷Ç’∂’π, ÷É’°’Ω’ø’°’©’≤’©’°’æ’∏÷Ä’æ’°’Æ API÷â

---

## üéØ ’Ä‘ª’Ñ’Ü‘±‘ø‘±’Ü ’ç‘ø‘∂‘≤’à’í’Ü’î’Ü‘µ’ê

1. **REST ’¨’º’•’¨’µ’°’µ’∂** ‚Äî ’º’•’Ω’∏÷Ç÷Ä’Ω’∂’•÷Ä ÷á HTTP ’¥’•’©’∏’§’∂’•÷Ä
2. **’Ä’°’¥’°’∞’∏÷Ç’∂’π’∏÷Ç’©’µ’∏÷Ç’∂** ‚Äî ’¥’´’°’Ω’∂’°’Ø’°’∂ ÷Ü’∏÷Ä’¥’°’ø ’°’¥’•’∂’∏÷Ç÷Ä
3. **’è’°÷Ä’¢’•÷Ä’°’Ø’°’æ’∏÷Ä’∏÷Ç’¥** ‚Äî /api/v1/...
4. **’ì’°’Ω’ø’°’©’≤’©’°’æ’∏÷Ä’∏÷Ç’¥** ‚Äî OpenAPI/Swagger

---

## üîó URL ‘ø‘±’å’à’í’ë’é‘±‘æ’î

### ‘±’∂’æ’°’∂’°’æ’∏÷Ä’¥’°’∂ ’Ø’°’∂’∏’∂’∂’•÷Ä

```
‚úÖ ’É‘ª’á’è:
GET    /api/v1/products          # ’ë’°’∂’Ø
GET    /api/v1/products/:id      # ’Ñ’•’Ø ’ø’°÷Ä÷Ä
POST   /api/v1/products          # ’ç’ø’•’≤’Æ’•’¨
PUT    /api/v1/products/:id      # ‘π’°÷Ä’¥’°÷Å’∂’•’¨ ’°’¥’¢’∏’≤’ª’∏÷Ç’©’µ’°’¥’¢
PATCH  /api/v1/products/:id      # ‘π’°÷Ä’¥’°÷Å’∂’•’¨ ’¥’°’Ω’∂’°’Ø’´
DELETE /api/v1/products/:id      # ’ã’∂’ª’•’¨

# ’Ü’•÷Ä’§÷Ä’æ’°’Æ ’º’•’Ω’∏÷Ç÷Ä’Ω’∂’•÷Ä
GET    /api/v1/orders/:orderId/items
POST   /api/v1/orders/:orderId/items

# ‘≥’∏÷Ä’Æ’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä (’•÷Ä’¢ CRUD ’π’ß)
POST   /api/v1/orders/:id/cancel
POST   /api/v1/orders/:id/refund
POST   /api/v1/auth/login
POST   /api/v1/auth/logout

‚ùå ’ç‘Ω‘±‘º:
GET    /api/v1/getProducts       # ‘≤’°’µ URL-’∏÷Ç’¥
POST   /api/v1/createProduct     # ‘≤’°’µ URL-’∏÷Ç’¥
GET    /api/v1/product           # ‘µ’¶’°’Ø’´ ’©’´’æ
DELETE /api/v1/products/delete/1 # ‘±’æ’•’¨’∏÷Ä’§ ’Ω’•’£’¥’•’∂’ø
```

### Query ’∫’°÷Ä’°’¥’•’ø÷Ä’•÷Ä

```
# ‘∑’ª’°’æ’∏÷Ä’∏÷Ç’¥
GET /api/v1/products?page=1&limit=20

# ‘¥’°’Ω’°’æ’∏÷Ä’∏÷Ç’¥
GET /api/v1/products?sort=price&order=asc
GET /api/v1/products?sort=-createdAt  # ’Ñ’´’∂’∏÷Ç’Ω = DESC

# ’ñ’´’¨’ø÷Ä’°÷Å’∏÷Ç’¥
GET /api/v1/products?category=electronics&minPrice=1000&maxPrice=5000

# ’à÷Ä’∏’∂’∏÷Ç’¥
GET /api/v1/products?search=iphone

# ‘ø’°’∫’•÷Ä’´ ’∂’•÷Ä’°’º’∏÷Ç’¥
GET /api/v1/products?include=category,variants

# ‘¥’°’∑’ø’•÷Ä’´ ’®’∂’ø÷Ä’∏÷Ç’©’µ’∏÷Ç’∂
GET /api/v1/products?fields=id,name,price
```

---

## üì§ ’ä‘±’è‘±’ç‘Ω‘±’Ü‘ª ’ñ’à’ê’Ñ‘±’è

### ’Ä’°’ª’∏’≤ ’∫’°’ø’°’Ω’≠’°’∂ (’¥’•’Ø ÷Ö’¢’µ’•’Ø’ø)

```json
{
  "data": {
    "id": "clx123abc",
    "name": "iPhone 15",
    "price": 99900,
    "category": {
      "id": "clx456def",
      "name": "’ç’¥’°÷Ä’©÷Ü’∏’∂’∂’•÷Ä"
    },
    "createdAt": "2024-01-15T10:30:00Z",
    "updatedAt": "2024-01-15T10:30:00Z"
  }
}
```

### ’Ä’°’ª’∏’≤ ’∫’°’ø’°’Ω’≠’°’∂ (÷Å’°’∂’Ø)

```json
{
  "data": [
    { "id": "clx123abc", "name": "iPhone 15" },
    { "id": "clx456def", "name": "Samsung S24" }
  ],
  "meta": {
    "total": 150,
    "page": 1,
    "limit": 20,
    "totalPages": 8,
    "hasNextPage": true,
    "hasPrevPage": false
  }
}
```

### ’ç’≠’°’¨’´ ’∫’°’ø’°’Ω’≠’°’∂ (RFC 7807)

```json
{
  "type": "https://api.example.com/errors/validation",
  "title": "Validation Error",
  "status": 400,
  "detail": "One or more fields have invalid values",
  "instance": "/api/v1/products",
  "errors": [
    {
      "field": "price",
      "code": "INVALID_VALUE",
      "message": "Price must be a positive number"
    },
    {
      "field": "name",
      "code": "REQUIRED",
      "message": "Name is required"
    }
  ],
  "timestamp": "2024-01-15T10:30:00Z",
  "traceId": "abc-123-def"
}
```

---

## üìä HTTP ’ç’è‘±’è’à’í’ç‘ª ‘ø’à‘¥‘µ’ê

### ’Ä’°’ª’∏’≤ ’∫’°’ø’°’Ω’≠’°’∂’∂’•÷Ä (2xx)

| ‘ø’∏’§ | ‘µ÷Ä’¢ ÷Ö’£’ø’°’£’∏÷Ä’Æ’•’¨ |
|-----|------------------|
| 200 OK | GET, PUT, PATCH ’∞’°’ª’∏’≤ |
| 201 Created | POST-’® ’Ω’ø’•’≤’Æ’•’¨ ’ß ’º’•’Ω’∏÷Ç÷Ä’Ω |
| 204 No Content | DELETE ’∞’°’ª’∏’≤, body ’π’Ø’° |

### ‘ø’¨’´’•’∂’ø’´ ’Ω’≠’°’¨’∂’•÷Ä (4xx)

| ‘ø’∏’§ | ‘µ÷Ä’¢ ÷Ö’£’ø’°’£’∏÷Ä’Æ’•’¨ |
|-----|------------------|
| 400 Bad Request | ‘±’∂’æ’°’æ’•÷Ä ’ø’æ’µ’°’¨’∂’•÷Ä |
| 401 Unauthorized | ’Ü’æ’´÷Ä’°’£÷Ä’æ’°’Æ ’π’ß |
| 403 Forbidden | ’Ñ’∏÷Ç’ø÷Ñ’´ ’´÷Ä’°’æ’∏÷Ç’∂÷Ñ ’π’Ø’° |
| 404 Not Found | ’å’•’Ω’∏÷Ç÷Ä’Ω’® ’π’´ ’£’ø’∂’æ’•’¨ |
| 409 Conflict | ‘ø’∏’∂÷Ü’¨’´’Ø’ø (’§’∏÷Ç’∫’¨’´’Ø’°’ø) |
| 422 Unprocessable | ‘≤’´’¶’∂’•’Ω-’¨’∏’£’´’Ø’°’µ’´ ’æ’°’¨’´’§’°÷Å’´’° |
| 429 Too Many Requests | Rate limit |

### ’ç’•÷Ä’æ’•÷Ä’´ ’Ω’≠’°’¨’∂’•÷Ä (5xx)

| ‘ø’∏’§ | ‘µ÷Ä’¢ ÷Ö’£’ø’°’£’∏÷Ä’Æ’•’¨ |
|-----|------------------|
| 500 Internal Server Error | ‘±’∂’Ω’∫’°’Ω’•’¨’´ ’Ω’≠’°’¨ |
| 502 Bad Gateway | Upstream ’Ω’•÷Ä’æ’´’Ω’´ ’Ω’≠’°’¨ |
| 503 Service Unavailable | ’ç’•÷Ä’æ’´’Ω’® ’∞’°’Ω’°’∂’•’¨’´ ’π’ß |

---

## üîê ’Ü’é‘ª’ê‘±‘≥’ê’à’í’Ñ

### JWT Bearer Token

```http
# ’Ä’°÷Ä÷Å’∏÷Ç’¥
POST /api/v1/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "secret"
}

# ’ä’°’ø’°’Ω’≠’°’∂
{
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIs...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIs...",
    "expiresIn": 3600,
    "tokenType": "Bearer"
  }
}

# ’ï’£’ø’°’£’∏÷Ä’Æ’∏÷Ç’¥
GET /api/v1/products
Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
```

### Refresh Token

```http
POST /api/v1/auth/refresh
Content-Type: application/json

{
  "refreshToken": "eyJhbGciOiJIUzI1NiIs..."
}
```

---

## üìù ’Ñ’à’í’è’î‘±’Ö‘ª’Ü ’è’é’Ö‘±‘º’Ü‘µ’ê‘ª ’é‘±‘º‘ª‘¥‘±’ë‘ª‘±

### Next.js Route Handlers ‚Äî ’æ’°’¨’´’§’°÷Å’´’° Zod-’∏’æ

```typescript
// app/api/products/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { z } from 'zod';
import { prisma } from '@/lib/prisma';

const createProductSchema = z.object({
  name: z.string().max(255),
  description: z.string().max(5000).optional(),
  price: z.number().min(0),
  categoryId: z.string().uuid(),
});

export async function GET(req: NextRequest) {
  const { searchParams } = req.nextUrl;
  const page = Number(searchParams.get('page') ?? 1);
  const limit = Math.min(Number(searchParams.get('limit') ?? 20), 100);

  const [data, total] = await Promise.all([
    prisma.product.findMany({ skip: (page - 1) * limit, take: limit }),
    prisma.product.count(),
  ]);

  return NextResponse.json({
    data,
    meta: { page, limit, total, totalPages: Math.ceil(total / limit) },
  });
}

export async function POST(req: NextRequest) {
  const body = await req.json();
  const parsed = createProductSchema.safeParse(body);
  if (!parsed.success) {
    return NextResponse.json(
      {
        error: {
          code: 'VALIDATION_ERROR',
          message: '’Ñ’∏÷Ç’ø÷Ñ’°’µ’´’∂ ’ø’æ’µ’°’¨’∂’•÷Ä’´ ’æ’°’¨’´’§’°÷Å’´’°’µ’´ ’Ω’≠’°’¨',
          details: parsed.error.flatten().fieldErrors,
        },
      },
      { status: 422 },
    );
  }

  const product = await prisma.product.create({ data: parsed.data });
  return NextResponse.json({ data: product }, { status: 201 });
}
```

### NestJS ‚Äî DTO class-validator-’∏’æ ’æ’°’¨’´’§’°÷Å’´’°

```typescript
// dto/create-product.dto.ts
import { 
  IsString, 
  IsNumber, 
  IsOptional, 
  Min, 
  Max,
  MaxLength,
  IsUUID,
  IsUrl,
  IsArray,
  ValidateNested,
  ArrayMinSize,
} from 'class-validator';
import { Type } from 'class-transformer';
import { ApiProperty, ApiPropertyOptional } from '@nestjs/swagger';

export class CreateProductDto {
  @ApiProperty({ 
    description: '‘±’∫÷Ä’°’∂÷Ñ’´ ’°’∂’∏÷Ç’∂',
    example: 'iPhone 15 Pro',
    maxLength: 255,
  })
  @IsString()
  @MaxLength(255)
  name: string;

  @ApiPropertyOptional({ 
    description: '‘±’∫÷Ä’°’∂÷Ñ’´ ’∂’Ø’°÷Ä’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂',
    example: '’Ü’∏÷Ä iPhone ’¢’°÷Ä’•’¨’°’æ’æ’°’Æ ’≠÷Å’´’Ø’∏’æ...',
  })
  @IsOptional()
  @IsString()
  @MaxLength(5000)
  description?: string;

  @ApiProperty({ 
    description: '‘≥’´’∂ ’Ø’∏’∫’•’Ø’∂’•÷Ä’∏’æ',
    example: 9990000,
    minimum: 0,
  })
  @IsNumber()
  @Min(0)
  price: number;

  @ApiProperty({ 
    description: '‘ø’°’ø’•’£’∏÷Ä’´’°’µ’´ ID',
    example: 'clx123abc',
  })
  @IsUUID()
  categoryId: string;

  @ApiPropertyOptional({ 
    description: '’Ü’Ø’°÷Ä’∂’•÷Ä',
    type: [String],
  })
  @IsOptional()
  @IsArray()
  @IsUrl({}, { each: true })
  images?: string[];

  @ApiPropertyOptional({ 
    description: '‘±’∫÷Ä’°’∂÷Ñ’´ ’ø’°÷Ä’¢’•÷Ä’°’Ø’∂’•÷Ä',
    type: [CreateVariantDto],
  })
  @IsOptional()
  @IsArray()
  @ValidateNested({ each: true })
  @Type(() => CreateVariantDto)
  @ArrayMinSize(1)
  variants?: CreateVariantDto[];
}
```

### ’é’°’¨’´’§’°÷Å’´’°’µ’´ ’Ω’≠’°’¨’´ ’∫’°’ø’°’Ω’≠’°’∂

```json
{
  "type": "https://api.example.com/errors/validation",
  "title": "Validation Error",
  "status": 400,
  "detail": "Request body validation failed",
  "errors": [
    {
      "field": "price",
      "code": "MIN",
      "message": "price must not be less than 0",
      "value": -100
    },
    {
      "field": "name",
      "code": "MAX_LENGTH",
      "message": "name must be shorter than or equal to 255 characters",
      "value": "very long name..."
    }
  ]
}
```

---

## üìñ SWAGGER ’ì‘±’ç’è‘±‘π’Ç‘π‘±’é’à’ê’à’í’Ñ

### ‘ø’∏’∂’ø÷Ä’∏’¨’•÷Ä’´ ’§’•’Ø’∏÷Ä’°’ø’∏÷Ä’∂’•÷Ä

```typescript
@Controller('products')
@ApiTags('Products')
@ApiBearerAuth()
export class ProductsController {
  
  @Get()
  @ApiOperation({ 
    summary: '’ç’ø’°’∂’°’¨ ’°’∫÷Ä’°’∂÷Ñ’∂’•÷Ä’´ ÷Å’°’∂’Ø',
    description: '’é’•÷Ä’°’§’°÷Ä’±’∂’∏÷Ç’¥ ’ß ’ß’ª’°’æ’∏÷Ä’æ’°’Æ ’°’∫÷Ä’°’∂÷Ñ’∂’•÷Ä’´ ÷Å’°’∂’Ø ÷Ü’´’¨’ø÷Ä’°÷Å’´’°’µ’∏’æ',
  })
  @ApiQuery({ name: 'page', required: false, type: Number })
  @ApiQuery({ name: 'limit', required: false, type: Number })
  @ApiQuery({ name: 'category', required: false, type: String })
  @ApiResponse({ 
    status: 200, 
    description: '‘±’∫÷Ä’°’∂÷Ñ’∂’•÷Ä’´ ÷Å’°’∂’Ø',
    type: PaginatedProductsResponse,
  })
  async findAll(@Query() query: ProductQueryDto) {
    return this.productsService.findAll(query);
  }

  @Get(':id')
  @ApiOperation({ summary: '’ç’ø’°’∂’°’¨ ’°’∫÷Ä’°’∂÷Ñ ID-’∏’æ' })
  @ApiParam({ name: 'id', description: '‘±’∫÷Ä’°’∂÷Ñ’´ ID' })
  @ApiResponse({ status: 200, description: '‘±’∫÷Ä’°’∂÷Ñ', type: Product })
  @ApiResponse({ status: 404, description: '‘±’∫÷Ä’°’∂÷Ñ’® ’π’´ ’£’ø’∂’æ’•’¨' })
  async findOne(@Param('id', ParseUUIDPipe) id: string) {
    return this.productsService.findOne(id);
  }

  @Post()
  @UseGuards(JwtAuthGuard, RolesGuard)
  @Roles('admin')
  @ApiOperation({ summary: '’ç’ø’•’≤’Æ’•’¨ ’°’∫÷Ä’°’∂÷Ñ' })
  @ApiBody({ type: CreateProductDto })
  @ApiResponse({ status: 201, description: '‘±’∫÷Ä’°’∂÷Ñ’® ’Ω’ø’•’≤’Æ’æ’°’Æ ’ß', type: Product })
  @ApiResponse({ status: 400, description: '’é’°’¨’´’§’°÷Å’´’°’µ’´ ’Ω’≠’°’¨' })
  @ApiResponse({ status: 401, description: '’Ü’æ’´÷Ä’°’£÷Ä’æ’°’Æ ’π’ß' })
  @ApiResponse({ status: 403, description: '‘ª÷Ä’°’æ’∏÷Ç’∂÷Ñ ’π’Ø’°' })
  async create(
    @Body() dto: CreateProductDto,
    @CurrentUser() user: User,
  ) {
    return this.productsService.create(dto, user);
  }
}
```

---

## üîÑ ’è‘±’ê‘≤‘µ’ê‘±‘ø‘±’é’à’ê’à’í’Ñ

### URL ’ø’°÷Ä’¢’•÷Ä’°’Ø’°’æ’∏÷Ä’∏÷Ç’¥ (’≠’∏÷Ä’∞’∏÷Ç÷Ä’§)

```
/api/v1/products
/api/v2/products
```

### ’è’°÷Ä’¢’•÷Ä’°’Ø’°’æ’∏÷Ä’¥’°’∂ ’Ø’°’∂’∏’∂’∂’•÷Ä

```typescript
// ‚úÖ ’Ü’∏÷Ä ’ø’°÷Ä’¢’•÷Ä’°’Ø ’•÷Ä’¢:
// - Breaking changes ’∫’°’ø’°’Ω’≠’°’∂’∏÷Ç’¥
// - ‘¥’°’∑’ø’•÷Ä’´ ’ª’∂’ª’∏÷Ç’¥
// - ‘¥’°’∑’ø’•÷Ä’´ ’ø’´’∫’•÷Ä’´ ÷É’∏÷É’∏’≠’∏÷Ç’©’µ’∏÷Ç’∂
// - ’é’°÷Ä÷Ñ’°’£’Æ’´ ÷É’∏÷É’∏’≠’∏÷Ç’©’µ’∏÷Ç’∂

// ‚ùå ’Ü’∏÷Ä ’ø’°÷Ä’¢’•÷Ä’°’Ø ’â‘∑ ’∫’•’ø÷Ñ ’•÷Ä’¢:
// - ’Ü’∏÷Ä ’§’°’∑’ø’•÷Ä’´ ’°’æ’•’¨’°÷Å’∏÷Ç’¥
// - ’Ü’∏÷Ä endpoints-’´ ’°’æ’•’¨’°÷Å’∏÷Ç’¥
// - ‘≤’°’£’•÷Ä’´ ’∏÷Ç’≤’≤’∏÷Ç’¥
// - ‘±÷Ä’ø’°’§÷Ä’∏’≤’°’Ø’°’∂’∏÷Ç’©’µ’°’∂ ’¢’°÷Ä’•’¨’°’æ’∏÷Ç’¥
```

### ’Ñ’´ ÷Ñ’°’∂’´ ’ø’°÷Ä’¢’•÷Ä’°’Ø’∂’•÷Ä’´ ’°’ª’°’Ø÷Å’∏÷Ç’©’µ’∏÷Ç’∂

```typescript
// Deprecation header
app.use('/api/v1/*', (req, res, next) => {
  res.setHeader('Deprecation', 'true');
  res.setHeader('Sunset', 'Sat, 01 Jan 2025 00:00:00 GMT');
  res.setHeader('Link', '</api/v2>; rel="successor-version"');
  next();
});
```

---

## ‚ö° ‘±’ê’è‘±‘¥’ê’à’Ç‘±‘ø‘±’Ü’à’í‘π’Ö’à’í’Ü

### Rate Limiting

> ‘º’´’¥’´’ø’∂’•÷Ä’® ‚Äî *’°’§’°’∫’ø’´’æ ’°÷Ä’™’•÷Ñ*÷â ‘Ω’∏÷Ä’∞’∏÷Ç÷Ä’§. 50‚Äì200 req/min API-’´, 5‚Äì20 req/min auth endpoints-’´ ’∞’°’¥’°÷Ä÷â ’Ä’°÷Ä÷Å÷Ä’∏÷Ç’õ ’¥’∑’°’Ø’∏’≤’´’∂÷â

```typescript
// === Next.js ‚Äî middleware + in-memory (serverless-’´ ’∞’°’¥’°÷Ä) ===
// middleware.ts (’Ø’°’¥ ÷Ö’£’ø’°’£’∏÷Ä’Æ’´’õ÷Ä Vercel KV / Upstash Redis distributed-’´ ’∞’°’¥’°÷Ä)
import { NextRequest, NextResponse } from 'next/server';

const rateLimit = new Map<string, { count: number; resetTime: number }>();

export function middleware(req: NextRequest) {
  if (!req.nextUrl.pathname.startsWith('/api/')) return;

  const ip = req.headers.get('x-forwarded-for') ?? 'unknown';
  const now = Date.now();
  const window = rateLimit.get(ip);

  if (!window || now > window.resetTime) {
    rateLimit.set(ip, { count: 1, resetTime: now + 60_000 });
    return;
  }

  if (window.count >= 100) {
    return NextResponse.json(
      { error: { code: 'RATE_LIMIT', message: 'Too many requests' } },
      { status: 429, headers: { 'Retry-After': '60' } },
    );
  }
  window.count++;
}

// === NestJS ‚Äî ThrottlerModule ===
@Module({
  imports: [
    ThrottlerModule.forRoot({
      ttl: 60,       // ’ä’°’ø’∏÷Ç’∞’°’∂ ’æ’°’µ÷Ä’Ø’µ’°’∂’∂’•÷Ä’∏’æ
      limit: 100,    // ’Ä’°÷Ä÷Å’∏÷Ç’¥’∂’•÷Ä ’∫’°’ø’∏÷Ç’∞’°’∂’∏÷Ç’¥
    }),
  ],
})
export class AppModule {}

// Per-endpoint
@Throttle(10, 60) // 10 ’∞’°÷Ä÷Å’∏÷Ç’¥ ÷Ä’∏’∫’•’∏÷Ç’¥
@Post('login')
async login() { ... }
```

### Cache-’°’æ’∏÷Ä’∏÷Ç’¥

```typescript
// Cache-Control headers
@Get('products')
@Header('Cache-Control', 'public, max-age=300') // 5 ÷Ä’∏’∫’•
async findAll() { ... }

// ETags
@Get('products/:id')
async findOne(@Param('id') id: string, @Res() res: Response) {
  const product = await this.service.findOne(id);
  const etag = generateEtag(product);
  
  res.setHeader('ETag', etag);
  res.json({ data: product });
}
```

### ’ç’•’≤’¥’∏÷Ç’¥

```typescript
// main.ts
import compression from 'compression';

app.use(compression());
```

---

## üîî WEBHOOKS

### Webhooks-’´ ’∏÷Ç’≤’°÷Ä’Ø’∏÷Ç’¥

```typescript
// services/webhook.service.ts
@Injectable()
export class WebhookService {
  private readonly logger = new Logger(WebhookService.name);

  async send(
    url: string,
    event: string,
    payload: unknown,
    secret: string,
  ): Promise<void> {
    const timestamp = Date.now();
    const body = JSON.stringify({
      event,
      timestamp,
      data: payload,
    });

    // ’ç’ø’∏÷Ä’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂ ’æ’•÷Ä’°’∞’Ω’Ø’¥’°’∂ ’∞’°’¥’°÷Ä
    const signature = this.createSignature(body, secret, timestamp);

    try {
      const response = await fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Webhook-Signature': signature,
          'X-Webhook-Timestamp': timestamp.toString(),
          'X-Webhook-Event': event,
        },
        body,
        signal: AbortSignal.timeout(10000), // 10s timeout
      });

      if (!response.ok) {
        throw new Error(`Webhook failed: ${response.status}`);
      }

      this.logger.log(`Webhook sent: ${event} to ${url}`);
    } catch (error) {
      this.logger.error(`Webhook failed: ${event} to ${url}`, error);
      // ‘¥’∂’•’¨ ’∞’•÷Ä’©’∏÷Ç’¥ retry-’´ ’∞’°’¥’°÷Ä
      await this.queueRetry(url, event, payload, secret);
    }
  }

  private createSignature(
    body: string,
    secret: string,
    timestamp: number,
  ): string {
    const payload = `${timestamp}.${body}`;
    return crypto
      .createHmac('sha256', secret)
      .update(payload)
      .digest('hex');
  }

  private async queueRetry(...args: unknown[]) {
    // ‘±’æ’•’¨’°÷Å’∂’•’¨ BullMQ-’∏÷Ç’¥ ’Ø÷Ä’Ø’∂’°’Ø’´ ’∏÷Ç’≤’°÷Ä’Ø’¥’°’∂ ’∞’°’¥’°÷Ä
  }
}
```

### Webhooks-’´ ’®’∂’§’∏÷Ç’∂’∏÷Ç’¥

```typescript
// === Next.js ‚Äî app/api/webhooks/stripe/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import Stripe from 'stripe';

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!);

export async function POST(req: NextRequest) {
  const body = await req.text(); // raw body ’æ’•÷Ä’°’∞’Ω’Ø’¥’°’∂ ’∞’°’¥’°÷Ä
  const signature = req.headers.get('stripe-signature')!;

  let event: Stripe.Event;
  try {
    event = stripe.webhooks.constructEvent(body, signature, process.env.STRIPE_WEBHOOK_SECRET!);
  } catch {
    return NextResponse.json({ error: 'Invalid signature' }, { status: 400 });
  }

  // ‘ª’§’•’¥’∫’∏’ø’•’∂’ø’∏÷Ç’©’µ’∏÷Ç’∂ + ’¥’∑’°’Ø’∏÷Ç’¥
  await processStripeEvent(event);

  return NextResponse.json({ received: true });
}

// === NestJS ‚Äî controllers/webhook.controller.ts ===
@Controller('webhooks')
export class WebhookController {
  
  @Post('stripe')
  async handleStripe(
    @Body() body: unknown,
    @Headers('stripe-signature') signature: string,
  ) {
    // ’ç’ø’∏÷Ä’°’£÷Ä’∏÷Ç’©’µ’°’∂ ’æ’•÷Ä’°’∞’Ω’Ø’∏÷Ç’¥
    const event = this.verifyStripeSignature(body, signature);
    
    // ‘ª’§’•’¥’∫’∏’ø’•’∂’ø’∏÷Ç’©’µ’∏÷Ç’∂ ‚Äî ’Ω’ø’∏÷Ç’£’∏÷Ç’¥, ’∏÷Ä ’°÷Ä’§’•’∂ ’π’•’∂÷Ñ ’¥’∑’°’Ø’•’¨
    const processed = await this.cache.get(`webhook:${event.id}`);
    if (processed) {
      return { received: true, duplicate: true };
    }
    
    // ’Ñ’∑’°’Ø’∏÷Ç’¥
    await this.processEvent(event);
    
    // ’Ü’∑’•’¨ ’∏÷Ä’∫’•’Ω ’¥’∑’°’Ø’æ’°’Æ
    await this.cache.set(`webhook:${event.id}`, true, 86400 * 7); // 7 ÷Ö÷Ä
    
    return { received: true };
  }
}
```

### Webhooks-’´ ’Ø’°’∂’∏’∂’∂’•÷Ä

```markdown
## Webhooks ’∏÷Ç’≤’°÷Ä’Ø’•’¨’´’Ω

### ’ç’ø’∏÷Ä’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂
- ‚úÖ HMAC-SHA256 ’Ω’ø’∏÷Ä’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂ header-’∏÷Ç’¥
- ‚úÖ Timestamp replay attacks-’´÷Å ’∫’°’∑’ø’∫’°’∂’∏÷Ç’©’µ’°’∂ ’∞’°’¥’°÷Ä
- ‚úÖ ’ì’°’Ω’ø’°’©’≤’©’°’æ’∏÷Ä’•’¨ ’Ω’ø’∏÷Ä’°’£÷Ä’∏÷Ç’©’µ’°’∂ ÷Ü’∏÷Ä’¥’°’ø’®

### Retry ’º’°’¶’¥’°’æ’°÷Ä’∏÷Ç’©’µ’∏÷Ç’∂
- ‚úÖ Exponential backoff: 1m, 5m, 30m, 2h, 24h
- ‚úÖ ‘±’º’°’æ’•’¨’°’£’∏÷Ç’µ’∂’® 5-10 ÷É’∏÷Ä’±
- ‚úÖ ‘º’∏’£’°’æ’∏÷Ä’•’¨ ’¢’∏’¨’∏÷Ä ÷É’∏÷Ä’±’•÷Ä’®
- ‚úÖ ‘æ’°’∂’∏÷Ç÷Å’•’¨ ’æ’•÷Ä’ª’∂’°’Ø’°’∂ ’±’°’≠’∏’≤’¥’°’∂ ’§’•’∫÷Ñ’∏÷Ç’¥

### Payload
- ‚úÖ ’Ü’æ’°’¶’°’£’∏÷Ç’µ’∂ ’ø’æ’µ’°’¨’∂’•÷Ä (id + event type)
- ‚úÖ ’ç’ø’°÷Å’∏’≤’® ’¥’°’∂÷Ä’°’¥’°’Ω’∂’•÷Ä’® API-’∏’æ ’∫’•’ø÷Ñ ’ß ’∞’°÷Ä÷Å’∂’´
- ‚úÖ ‘≥’°’≤’ø’∂’´ ’ø’æ’µ’°’¨’∂’•÷Ä ’π’∏÷Ç’≤’°÷Ä’Ø’•’¨

## Webhooks ’®’∂’§’∏÷Ç’∂’•’¨’´’Ω

### ’é’•÷Ä’°’∞’Ω’Ø’∏÷Ç’¥
- ‚úÖ ’ç’ø’∏÷Ç’£’•’¨ ’Ω’ø’∏÷Ä’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂’®
- ‚úÖ ’ç’ø’∏÷Ç’£’•’¨ timestamp (’∏’π ’°’æ’•’¨’´ ÷Ñ’°’∂ 5 ÷Ä’∏’∫’•)
- ‚úÖ ’Ñ’´’°’µ’∂ HTTPS

### ‘ª’§’•’¥’∫’∏’ø’•’∂’ø’∏÷Ç’©’µ’∏÷Ç’∂
- ‚úÖ ’ä’°’∞’•’¨ ’¥’∑’°’Ø’æ’°’Æ ’´÷Ä’°’§’°÷Ä’±’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’´ ID-’∂’•÷Ä’®
- ‚úÖ ‘ø÷Ä’Ø’∂’∏÷Ç’©’µ’°’∂ ’§’•’∫÷Ñ’∏÷Ç’¥ ‚Äî ’æ’•÷Ä’°’§’°÷Ä’±’∂’•’¨ 200, ’¢’°’µ÷Å ’π’¥’∑’°’Ø’•’¨
- ‚úÖ ID-’∂’•÷Ä’® ’∫’°’∞’•’¨ ’°’º’∂’æ’°’¶’∂ 7 ÷Ö÷Ä

### ’Ñ’∑’°’Ø’∏÷Ç’¥
- ‚úÖ ‘±÷Ä’°’£ ’æ’•÷Ä’°’§’°÷Ä’±’∂’•’¨ 200 (< 3 ’æ’°’µ÷Ä’Ø’µ’°’∂)
- ‚úÖ ‘æ’°’∂÷Ä ’¥’∑’°’Ø’∏÷Ç’¥ ‚Äî ’∞’•÷Ä’©’´ ’¥’•’ª
- ‚úÖ ‘º’∏’£’°’æ’∏÷Ä’•’¨ ’¢’∏’¨’∏÷Ä ’¥’∏÷Ç’ø÷Ñ’°’µ’´’∂ ’´÷Ä’°’§’°÷Ä’±’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’®
```

### Webhook ’´÷Ä’°’§’°÷Ä’±’∏÷Ç’©’µ’°’∂ ÷Ü’∏÷Ä’¥’°’ø

```json
{
  "id": "evt_123abc",
  "event": "order.completed",
  "timestamp": 1705312800000,
  "data": {
    "orderId": "ord_456def",
    "status": "completed"
  }
}
```

---

## üìã ’ç’è’à’í‘≥‘±’ë’à’í’ë‘±‘ø

### ’Ü’∏÷Ä endpoint

- [ ] RESTful URL ’Ø’°’º’∏÷Ç÷Å’æ’°’Æ÷Ñ
- [ ] ’É’´’∑’ø HTTP ’¥’•’©’∏’§
- [ ] ’É’´’∑’ø status ’Ø’∏’§
- [ ] DTO ’æ’°’¨’´’§’°÷Å’´’°’µ’∏’æ
- [ ] Swagger ÷É’°’Ω’ø’°’©’≤’©’°’æ’∏÷Ä’∏÷Ç’¥
- [ ] ’ç’≠’°’¨’∂’•÷Ä’´ ’¥’∑’°’Ø’∏÷Ç’¥
- [ ] Rate limiting (’°’∂’∞÷Ä’°’™’•’∑’ø’∏÷Ç’©’µ’°’∂ ’§’•’∫÷Ñ’∏÷Ç’¥)
- [ ] ‘±’æ’©’∏÷Ä’´’¶’°÷Å’´’° (’°’∂’∞÷Ä’°’™’•’∑’ø’∏÷Ç’©’µ’°’∂ ’§’•’∫÷Ñ’∏÷Ç’¥)

### API Review

- [ ] ’Ä’°’¥’°’∞’∏÷Ç’∂’π’∏÷Ç’©’µ’∏÷Ç’∂ ’°’º’Ø’° endpoints-’´ ’∞’•’ø
- [ ] Breaking changes ’π’Ø’°’∂
- [ ] ’ä’°’ø’°’Ω’≠’°’∂’´ ÷Ü’∏÷Ä’¥’°’ø’® ’∞’°’¥’°’∫’°’ø’°’Ω’≠’°’∂’∏÷Ç’¥ ’ß ’Ω’ø’°’∂’§’°÷Ä’ø’´’∂
- [ ] ‘∑’ª’°’æ’∏÷Ä’∏÷Ç’¥ ÷Å’°’∂’Ø’•÷Ä’´ ’∞’°’¥’°÷Ä
- [ ] ‘º’∏’£’°’æ’∏÷Ä’∏÷Ç’¥

### Webhooks (’•’©’• ÷Ö’£’ø’°’£’∏÷Ä’Æ’æ’∏÷Ç’¥ ’•’∂)

- [ ] ’ç’ø’∏÷Ä’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂’® ’´÷Ä’°’Ø’°’∂’°÷Å’æ’°’Æ ’ß (HMAC-SHA256)
- [ ] Retry exponential backoff-’∏’æ
- [ ] ‘ª’§’•’¥’∫’∏’ø’•’∂’ø’∏÷Ç’©’µ’∏÷Ç’∂ ’®’∂’§’∏÷Ç’∂’•’¨’´’Ω
- [ ] Timestamp-’® ’Ω’ø’∏÷Ç’£’æ’∏÷Ç’¥ ’ß
- [ ] ’ì’°’Ω’ø’°’©’≤’©’°’æ’∏÷Ä’∏÷Ç’¥ ’Ω’ø’°÷Å’∏’≤’∂’•÷Ä’´ ’∞’°’¥’°÷Ä

---

**’è’°÷Ä’¢’•÷Ä’°’Ø.** 1.2
**‘±’¥’Ω’°’©’´’æ.** 2026-02-12
