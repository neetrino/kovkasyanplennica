{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/white%20shop/White-Shop-templete/WhiteShop-Template/packages/db/client.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as any;\n\n// Ensure UTF-8 encoding for PostgreSQL connection\n// This fixes encoding issues with Armenian and other UTF-8 characters\nconst databaseUrl = process.env.DATABASE_URL || '';\nlet urlWithEncoding = databaseUrl;\n\nif (!databaseUrl.includes('client_encoding')) {\n  urlWithEncoding = databaseUrl.includes('?') \n    ? `${databaseUrl}&client_encoding=UTF8`\n    : `${databaseUrl}?client_encoding=UTF8`;\n  \n  // Temporarily override DATABASE_URL for Prisma Client\n  process.env.DATABASE_URL = urlWithEncoding;\n}\n\nexport const db =\n  globalForPrisma.prisma ??\n  new PrismaClient({ \n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"error\", \"warn\"] : [\"error\"],\n    errorFormat: \"pretty\",\n  });\n\n// Prisma Client connects automatically on first query (lazy connection)\n// No need to call $connect() explicitly as it can cause issues in Next.js API routes\n// Connection will be established automatically when the first database query is made\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = db;\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAExB,kDAAkD;AAClD,sEAAsE;AACtE,MAAM,cAAc,QAAQ,GAAG,CAAC,YAAY,IAAI;AAChD,IAAI,kBAAkB;AAEtB,IAAI,CAAC,YAAY,QAAQ,CAAC,oBAAoB;IAC5C,kBAAkB,YAAY,QAAQ,CAAC,OACnC,GAAG,YAAY,qBAAqB,CAAC,GACrC,GAAG,YAAY,qBAAqB,CAAC;IAEzC,sDAAsD;IACtD,QAAQ,GAAG,CAAC,YAAY,GAAG;AAC7B;AAEO,MAAM,KACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;IAC3E,aAAa;AACf;AAEF,wEAAwE;AACxE,qFAAqF;AACrF,qFAAqF;AAErF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/white%20shop/White-Shop-templete/WhiteShop-Template/packages/db/index.ts"],"sourcesContent":["export * from \"./client\";\r\n\r\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/white%20shop/White-Shop-templete/WhiteShop-Template/apps/web/lib/services/categories.service.ts"],"sourcesContent":["import { db } from \"@white-shop/db\";\r\n\r\nclass CategoriesService {\r\n  /**\r\n   * Get category tree\r\n   */\r\n  async getTree(lang: string = \"en\") {\r\n    const categories = await db.category.findMany({\r\n      where: {\r\n        published: true,\r\n        deletedAt: null,\r\n      },\r\n      include: {\r\n        translations: true,\r\n        children: {\r\n          include: {\r\n            translations: true,\r\n          },\r\n        },\r\n      },\r\n      orderBy: {\r\n        position: \"asc\",\r\n      },\r\n    });\r\n\r\n    // Build tree structure\r\n    const categoryMap = new Map();\r\n    const rootCategories: any[] = [];\r\n\r\n    categories.forEach((category: {\r\n      id: string;\r\n      parentId: string | null;\r\n      translations: Array<{ locale: string; slug: string; title: string; fullPath: string }>;\r\n    }) => {\r\n      const translation =\r\n        category.translations.find((t: { locale: string }) => t.locale === lang) ||\r\n        category.translations[0];\r\n      if (!translation) return;\r\n\r\n      const categoryData = {\r\n        id: category.id,\r\n        slug: translation.slug,\r\n        title: translation.title,\r\n        fullPath: translation.fullPath,\r\n        children: [] as any[],\r\n      };\r\n\r\n      categoryMap.set(category.id, categoryData);\r\n\r\n      if (!category.parentId) {\r\n        rootCategories.push(categoryData);\r\n      }\r\n    });\r\n\r\n    // Build parent-child relationships\r\n    categories.forEach((category: {\r\n      id: string;\r\n      parentId: string | null;\r\n    }) => {\r\n      if (category.parentId) {\r\n        const parent = categoryMap.get(category.parentId);\r\n        const child = categoryMap.get(category.id);\r\n        if (parent && child) {\r\n          parent.children.push(child);\r\n        }\r\n      }\r\n    });\r\n\r\n    return {\r\n      data: rootCategories,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get category by slug\r\n   */\r\n  async findBySlug(slug: string, lang: string = \"en\") {\r\n    const category = await db.category.findFirst({\r\n      where: {\r\n        translations: {\r\n          some: {\r\n            slug,\r\n            locale: lang,\r\n          },\r\n        },\r\n        published: true,\r\n        deletedAt: null,\r\n      },\r\n      include: {\r\n        translations: true,\r\n        parent: {\r\n          include: {\r\n            translations: true,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!category) {\r\n      throw {\r\n        status: 404,\r\n        type: \"https://api.shop.am/problems/not-found\",\r\n        title: \"Category not found\",\r\n        detail: `Category with slug '${slug}' does not exist or is not published`,\r\n      };\r\n    }\r\n\r\n    const translation =\r\n      category.translations.find((t: { locale: string }) => t.locale === lang) ||\r\n      category.translations[0];\r\n    const parentTranslation = category.parent\r\n      ? category.parent.translations.find((t: { locale: string }) => t.locale === lang) ||\r\n        category.parent.translations[0]\r\n      : null;\r\n\r\n    return {\r\n      id: category.id,\r\n      slug: translation?.slug || \"\",\r\n      title: translation?.title || \"\",\r\n      description: translation?.description || null,\r\n      fullPath: translation?.fullPath || \"\",\r\n      seo: {\r\n        title: translation?.seoTitle || translation?.title,\r\n        description: translation?.seoDescription || null,\r\n      },\r\n      parent: category.parent\r\n        ? {\r\n            id: category.parent.id,\r\n            slug: parentTranslation?.slug || \"\",\r\n            title: parentTranslation?.title || \"\",\r\n          }\r\n        : null,\r\n    };\r\n  }\r\n}\r\n\r\nexport const categoriesService = new CategoriesService();\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEA,MAAM;IACJ;;GAEC,GACD,MAAM,QAAQ,OAAe,IAAI,EAAE;QACjC,MAAM,aAAa,MAAM,gIAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC;YAC5C,OAAO;gBACL,WAAW;gBACX,WAAW;YACb;YACA,SAAS;gBACP,cAAc;gBACd,UAAU;oBACR,SAAS;wBACP,cAAc;oBAChB;gBACF;YACF;YACA,SAAS;gBACP,UAAU;YACZ;QACF;QAEA,uBAAuB;QACvB,MAAM,cAAc,IAAI;QACxB,MAAM,iBAAwB,EAAE;QAEhC,WAAW,OAAO,CAAC,CAAC;YAKlB,MAAM,cACJ,SAAS,YAAY,CAAC,IAAI,CAAC,CAAC,IAA0B,EAAE,MAAM,KAAK,SACnE,SAAS,YAAY,CAAC,EAAE;YAC1B,IAAI,CAAC,aAAa;YAElB,MAAM,eAAe;gBACnB,IAAI,SAAS,EAAE;gBACf,MAAM,YAAY,IAAI;gBACtB,OAAO,YAAY,KAAK;gBACxB,UAAU,YAAY,QAAQ;gBAC9B,UAAU,EAAE;YACd;YAEA,YAAY,GAAG,CAAC,SAAS,EAAE,EAAE;YAE7B,IAAI,CAAC,SAAS,QAAQ,EAAE;gBACtB,eAAe,IAAI,CAAC;YACtB;QACF;QAEA,mCAAmC;QACnC,WAAW,OAAO,CAAC,CAAC;YAIlB,IAAI,SAAS,QAAQ,EAAE;gBACrB,MAAM,SAAS,YAAY,GAAG,CAAC,SAAS,QAAQ;gBAChD,MAAM,QAAQ,YAAY,GAAG,CAAC,SAAS,EAAE;gBACzC,IAAI,UAAU,OAAO;oBACnB,OAAO,QAAQ,CAAC,IAAI,CAAC;gBACvB;YACF;QACF;QAEA,OAAO;YACL,MAAM;QACR;IACF;IAEA;;GAEC,GACD,MAAM,WAAW,IAAY,EAAE,OAAe,IAAI,EAAE;QAClD,MAAM,WAAW,MAAM,gIAAE,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC3C,OAAO;gBACL,cAAc;oBACZ,MAAM;wBACJ;wBACA,QAAQ;oBACV;gBACF;gBACA,WAAW;gBACX,WAAW;YACb;YACA,SAAS;gBACP,cAAc;gBACd,QAAQ;oBACN,SAAS;wBACP,cAAc;oBAChB;gBACF;YACF;QACF;QAEA,IAAI,CAAC,UAAU;YACb,MAAM;gBACJ,QAAQ;gBACR,MAAM;gBACN,OAAO;gBACP,QAAQ,CAAC,oBAAoB,EAAE,KAAK,oCAAoC,CAAC;YAC3E;QACF;QAEA,MAAM,cACJ,SAAS,YAAY,CAAC,IAAI,CAAC,CAAC,IAA0B,EAAE,MAAM,KAAK,SACnE,SAAS,YAAY,CAAC,EAAE;QAC1B,MAAM,oBAAoB,SAAS,MAAM,GACrC,SAAS,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,IAA0B,EAAE,MAAM,KAAK,SAC1E,SAAS,MAAM,CAAC,YAAY,CAAC,EAAE,GAC/B;QAEJ,OAAO;YACL,IAAI,SAAS,EAAE;YACf,MAAM,aAAa,QAAQ;YAC3B,OAAO,aAAa,SAAS;YAC7B,aAAa,aAAa,eAAe;YACzC,UAAU,aAAa,YAAY;YACnC,KAAK;gBACH,OAAO,aAAa,YAAY,aAAa;gBAC7C,aAAa,aAAa,kBAAkB;YAC9C;YACA,QAAQ,SAAS,MAAM,GACnB;gBACE,IAAI,SAAS,MAAM,CAAC,EAAE;gBACtB,MAAM,mBAAmB,QAAQ;gBACjC,OAAO,mBAAmB,SAAS;YACrC,IACA;QACN;IACF;AACF;AAEO,MAAM,oBAAoB,IAAI"}},
    {"offset": {"line": 207, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/white%20shop/White-Shop-templete/WhiteShop-Template/apps/web/app/api/v1/categories/tree/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { categoriesService } from \"@/lib/services/categories.service\";\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const lang = searchParams.get(\"lang\") || \"en\";\r\n    const result = await categoriesService.getTree(lang);\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error(\"‚ùå [CATEGORIES] Error:\", error);\r\n    return NextResponse.json(\r\n      {\r\n        type: error.type || \"https://api.shop.am/problems/internal-error\",\r\n        title: error.title || \"Internal Server Error\",\r\n        status: error.status || 500,\r\n        detail: error.detail || error.message || \"An error occurred\",\r\n        instance: req.url,\r\n      },\r\n      { status: error.status || 500 }\r\n    );\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,MAAM,OAAO,aAAa,GAAG,CAAC,WAAW;QACzC,MAAM,SAAS,MAAM,8KAAiB,CAAC,OAAO,CAAC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,MAAM,MAAM,IAAI,IAAI;YACpB,OAAO,MAAM,KAAK,IAAI;YACtB,QAAQ,MAAM,MAAM,IAAI;YACxB,QAAQ,MAAM,MAAM,IAAI,MAAM,OAAO,IAAI;YACzC,UAAU,IAAI,GAAG;QACnB,GACA;YAAE,QAAQ,MAAM,MAAM,IAAI;QAAI;IAElC;AACF"}}]
}