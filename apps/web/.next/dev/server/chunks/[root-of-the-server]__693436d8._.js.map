{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/white%20shop/White-Shop-templete/WhiteShop-Template/packages/db/client.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as any;\n\n// Ensure UTF-8 encoding for PostgreSQL connection\n// This fixes encoding issues with Armenian and other UTF-8 characters\nconst databaseUrl = process.env.DATABASE_URL || '';\nlet urlWithEncoding = databaseUrl;\n\nif (!databaseUrl.includes('client_encoding')) {\n  urlWithEncoding = databaseUrl.includes('?') \n    ? `${databaseUrl}&client_encoding=UTF8`\n    : `${databaseUrl}?client_encoding=UTF8`;\n  \n  // Temporarily override DATABASE_URL for Prisma Client\n  process.env.DATABASE_URL = urlWithEncoding;\n}\n\nexport const db =\n  globalForPrisma.prisma ??\n  new PrismaClient({ \n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"error\", \"warn\"] : [\"error\"],\n    errorFormat: \"pretty\",\n  });\n\n// Prisma Client connects automatically on first query (lazy connection)\n// No need to call $connect() explicitly as it can cause issues in Next.js API routes\n// Connection will be established automatically when the first database query is made\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = db;\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAExB,kDAAkD;AAClD,sEAAsE;AACtE,MAAM,cAAc,QAAQ,GAAG,CAAC,YAAY,IAAI;AAChD,IAAI,kBAAkB;AAEtB,IAAI,CAAC,YAAY,QAAQ,CAAC,oBAAoB;IAC5C,kBAAkB,YAAY,QAAQ,CAAC,OACnC,GAAG,YAAY,qBAAqB,CAAC,GACrC,GAAG,YAAY,qBAAqB,CAAC;IAEzC,sDAAsD;IACtD,QAAQ,GAAG,CAAC,YAAY,GAAG;AAC7B;AAEO,MAAM,KACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;IAC3E,aAAa;AACf;AAEF,wEAAwE;AACxE,qFAAqF;AACrF,qFAAqF;AAErF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/white%20shop/White-Shop-templete/WhiteShop-Template/packages/db/index.ts"],"sourcesContent":["export * from \"./client\";\r\n\r\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/white%20shop/White-Shop-templete/WhiteShop-Template/apps/web/lib/middleware/auth.ts"],"sourcesContent":["import { NextRequest } from \"next/server\";\r\nimport * as jwt from \"jsonwebtoken\";\r\nimport { db } from \"@white-shop/db\";\r\n\r\nexport interface AuthUser {\r\n  id: string;\r\n  email: string | null;\r\n  phone: string | null;\r\n  locale: string;\r\n  roles: string[];\r\n}\r\n\r\n/**\r\n * Authenticate JWT token from request headers\r\n */\r\nexport async function authenticateToken(\r\n  request: NextRequest\r\n): Promise<AuthUser | null> {\r\n  try {\r\n    const authHeader = request.headers.get(\"authorization\");\r\n    const token = authHeader?.split(\" \")[1]; // Bearer TOKEN\r\n\r\n    if (!token) {\r\n      return null;\r\n    }\r\n\r\n    if (!process.env.JWT_SECRET) {\r\n      console.error(\"âŒ [AUTH] JWT_SECRET is not set!\");\r\n      return null;\r\n    }\r\n\r\n    const decoded = jwt.verify(token, process.env.JWT_SECRET) as {\r\n      userId: string;\r\n    };\r\n\r\n    const user = await db.user.findUnique({\r\n      where: { id: decoded.userId },\r\n      select: {\r\n        id: true,\r\n        email: true,\r\n        phone: true,\r\n        locale: true,\r\n        roles: true,\r\n        blocked: true,\r\n        deletedAt: true,\r\n      },\r\n    });\r\n\r\n    if (!user || user.blocked || user.deletedAt) {\r\n      return null;\r\n    }\r\n\r\n    return {\r\n      id: user.id,\r\n      email: user.email,\r\n      phone: user.phone,\r\n      locale: user.locale,\r\n      roles: user.roles,\r\n    };\r\n  } catch (error) {\r\n    if (\r\n      error instanceof jwt.JsonWebTokenError ||\r\n      error instanceof jwt.TokenExpiredError\r\n    ) {\r\n      return null;\r\n    }\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Check if user is admin\r\n */\r\nexport function requireAdmin(user: AuthUser | null): boolean {\r\n  if (!user) {\r\n    return false;\r\n  }\r\n  return user.roles.includes(\"admin\");\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AACA;AACA;AAAA;;;AAaO,eAAe,kBACpB,OAAoB;IAEpB,IAAI;QACF,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,MAAM,QAAQ,YAAY,MAAM,IAAI,CAAC,EAAE,EAAE,eAAe;QAExD,IAAI,CAAC,OAAO;YACV,OAAO;QACT;QAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,UAAU,EAAE;YAC3B,QAAQ,KAAK,CAAC;YACd,OAAO;QACT;QAEA,MAAM,UAAU,iJAAU,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;QAIxD,MAAM,OAAO,MAAM,gIAAE,CAAC,IAAI,CAAC,UAAU,CAAC;YACpC,OAAO;gBAAE,IAAI,QAAQ,MAAM;YAAC;YAC5B,QAAQ;gBACN,IAAI;gBACJ,OAAO;gBACP,OAAO;gBACP,QAAQ;gBACR,OAAO;gBACP,SAAS;gBACT,WAAW;YACb;QACF;QAEA,IAAI,CAAC,QAAQ,KAAK,OAAO,IAAI,KAAK,SAAS,EAAE;YAC3C,OAAO;QACT;QAEA,OAAO;YACL,IAAI,KAAK,EAAE;YACX,OAAO,KAAK,KAAK;YACjB,OAAO,KAAK,KAAK;YACjB,QAAQ,KAAK,MAAM;YACnB,OAAO,KAAK,KAAK;QACnB;IACF,EAAE,OAAO,OAAO;QACd,IACE,iBAAiB,4JAAqB,IACtC,iBAAiB,4JAAqB,EACtC;YACA,OAAO;QACT;QACA,MAAM;IACR;AACF;AAKO,SAAS,aAAa,IAAqB;IAChD,IAAI,CAAC,MAAM;QACT,OAAO;IACT;IACA,OAAO,KAAK,KAAK,CAAC,QAAQ,CAAC;AAC7B"}},
    {"offset": {"line": 179, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/white%20shop/White-Shop-templete/WhiteShop-Template/apps/web/lib/services/cart.service.ts"],"sourcesContent":["import { db } from \"@white-shop/db\";\r\n\r\nclass CartService {\r\n  /**\r\n   * Get or create user's cart\r\n   */\r\n  async getCart(userId: string, locale: string = \"en\") {\r\n    // Get discount settings\r\n    const discountSettings = await db.settings.findMany({\r\n      where: {\r\n        key: {\r\n          in: [\"globalDiscount\", \"categoryDiscounts\", \"brandDiscounts\"],\r\n        },\r\n      },\r\n    });\r\n\r\n    const globalDiscount =\r\n      Number(\r\n        discountSettings.find((s: { key: string; value: unknown }) => s.key === \"globalDiscount\")?.value\r\n      ) || 0;\r\n    \r\n    const categoryDiscountsSetting = discountSettings.find((s: { key: string; value: unknown }) => s.key === \"categoryDiscounts\");\r\n    const categoryDiscounts = categoryDiscountsSetting ? (categoryDiscountsSetting.value as Record<string, number>) || {} : {};\r\n    \r\n    const brandDiscountsSetting = discountSettings.find((s: { key: string; value: unknown }) => s.key === \"brandDiscounts\");\r\n    const brandDiscounts = brandDiscountsSetting ? (brandDiscountsSetting.value as Record<string, number>) || {} : {};\r\n    let cart = await db.cart.findFirst({\r\n      where: {\r\n        userId,\r\n      },\r\n      include: {\r\n        items: {\r\n          include: {\r\n            variant: {\r\n              include: {\r\n                product: {\r\n                  include: {\r\n                    translations: true,\r\n                  },\r\n                },\r\n              },\r\n            },\r\n            product: {\r\n              include: {\r\n                translations: true,\r\n              },\r\n            },\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!cart) {\r\n      cart = await db.cart.create({\r\n        data: {\r\n          userId,\r\n          locale,\r\n          expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days\r\n          items: {\r\n            create: [],\r\n          },\r\n        },\r\n        include: {\r\n          items: {\r\n            include: {\r\n              variant: {\r\n                include: {\r\n                  product: {\r\n                    include: {\r\n                      translations: true,\r\n                    },\r\n                  },\r\n                },\r\n              },\r\n              product: {\r\n                include: {\r\n                  translations: true,\r\n                },\r\n              },\r\n            },\r\n          },\r\n        },\r\n      });\r\n    }\r\n\r\n    // Format items with details\r\n    const itemsWithDetails = await Promise.all(\r\n      cart.items.map(async (item: {\r\n        id: string;\r\n        productId: string;\r\n        variantId: string;\r\n        quantity: number;\r\n      }) => {\r\n        const product = await db.product.findUnique({\r\n          where: { id: item.productId },\r\n          include: {\r\n            translations: true,\r\n            variants: {\r\n              where: { id: item.variantId },\r\n            },\r\n          },\r\n        });\r\n\r\n        const variant = product?.variants[0];\r\n        const translation =\r\n          product?.translations.find((t: { locale: string }) => t.locale === locale) ||\r\n          product?.translations[0];\r\n\r\n        let imageUrl = null;\r\n        if (product?.media && Array.isArray(product.media) && product.media.length > 0) {\r\n          const firstMedia = product.media[0];\r\n          if (typeof firstMedia === \"string\") {\r\n            imageUrl = firstMedia;\r\n          } else if ((firstMedia as any)?.url) {\r\n            imageUrl = (firstMedia as any).url;\r\n          } else if ((firstMedia as any)?.src) {\r\n            imageUrl = (firstMedia as any).src;\r\n          }\r\n        }\r\n\r\n        // Calculate discount and original price\r\n        // Always use the latest discount from the product, not the stored priceSnapshot\r\n        const productDiscount = product?.discountPercent || 0;\r\n        let appliedDiscount = 0;\r\n        if (productDiscount > 0) {\r\n          appliedDiscount = productDiscount;\r\n        } else {\r\n          // Check category discounts\r\n          const primaryCategoryId = product?.primaryCategoryId;\r\n          if (primaryCategoryId && categoryDiscounts[primaryCategoryId]) {\r\n            appliedDiscount = categoryDiscounts[primaryCategoryId];\r\n          } else {\r\n            // Check brand discounts\r\n            const brandId = product?.brandId;\r\n            if (brandId && brandDiscounts[brandId]) {\r\n              appliedDiscount = brandDiscounts[brandId];\r\n            } else if (globalDiscount > 0) {\r\n              appliedDiscount = globalDiscount;\r\n            }\r\n          }\r\n        }\r\n\r\n        // Always calculate the latest price from variant.price with current discount\r\n        // This ensures that if product discount is updated, cart shows the latest price\r\n        const variantOriginalPrice = variant?.price || 0;\r\n        let finalPrice = variantOriginalPrice;\r\n        let originalPrice: number | null = null;\r\n\r\n        if (appliedDiscount > 0 && variantOriginalPrice > 0) {\r\n          // Calculate discounted price with latest discount\r\n          finalPrice = variantOriginalPrice * (1 - appliedDiscount / 100);\r\n          originalPrice = variantOriginalPrice;\r\n        } else if (variant?.compareAtPrice && variant.compareAtPrice > variantOriginalPrice) {\r\n          originalPrice = Number(variant.compareAtPrice);\r\n        }\r\n\r\n        return {\r\n          id: item.id,\r\n          variant: {\r\n            id: variant?.id || item.variantId,\r\n            sku: variant?.sku || \"\",\r\n            stock: variant?.stock || 0,\r\n            product: {\r\n              id: product?.id || \"\",\r\n              title: translation?.title || \"\",\r\n              slug: translation?.slug || \"\",\r\n              image: imageUrl,\r\n            },\r\n          },\r\n          quantity: item.quantity,\r\n          price: finalPrice,\r\n          originalPrice: originalPrice,\r\n          total: finalPrice * item.quantity,\r\n        };\r\n      })\r\n    );\r\n\r\n    const subtotal = itemsWithDetails.reduce((sum, item) => sum + item.total, 0);\r\n\r\n    return {\r\n      cart: {\r\n        id: cart.id,\r\n        items: itemsWithDetails,\r\n        totals: {\r\n          subtotal,\r\n          discount: 0,\r\n          shipping: 0,\r\n          tax: 0,\r\n          total: subtotal,\r\n          currency: \"AMD\",\r\n        },\r\n        itemsCount: itemsWithDetails.reduce((sum, item) => sum + item.quantity, 0),\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Add item to cart\r\n   */\r\n  async addItem(\r\n    userId: string,\r\n    data: { variantId: string; productId: string; quantity?: number },\r\n    locale: string = \"en\"\r\n  ) {\r\n    const { variantId, productId, quantity = 1 } = data;\r\n\r\n    if (!variantId || !productId) {\r\n      throw {\r\n        status: 400,\r\n        type: \"https://api.shop.am/problems/validation-error\",\r\n        title: \"Validation failed\",\r\n        detail: \"variantId and productId are required\",\r\n      };\r\n    }\r\n\r\n    // Get or create cart\r\n    let cart = await db.cart.findFirst({\r\n      where: { userId },\r\n      include: { items: true },\r\n    });\r\n\r\n    if (!cart) {\r\n      cart = await db.cart.create({\r\n        data: {\r\n          userId,\r\n          locale,\r\n          expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),\r\n          items: {\r\n            create: [],\r\n          },\r\n        },\r\n        include: { items: true },\r\n      });\r\n    }\r\n\r\n    // Get variant\r\n    const variant = await db.productVariant.findUnique({\r\n      where: { id: variantId },\r\n      include: {\r\n        product: true,\r\n      },\r\n    });\r\n\r\n    if (!variant || !variant.published || variant.productId !== productId) {\r\n      throw {\r\n        status: 404,\r\n        type: \"https://api.shop.am/problems/not-found\",\r\n        title: \"Variant not found\",\r\n      };\r\n    }\r\n\r\n    // Check if item already exists\r\n    const existingItem = cart.items.find((item: { variantId: string }) => item.variantId === variantId);\r\n\r\n    // Calculate total quantity that will be in cart after adding\r\n    const totalQuantity = existingItem ? existingItem.quantity + quantity : quantity;\r\n\r\n    // Check if total quantity exceeds available stock\r\n    if (totalQuantity > variant.stock) {\r\n      console.log('ðŸš« [CART SERVICE] Stock limit exceeded:', {\r\n        variantId,\r\n        currentInCart: existingItem?.quantity || 0,\r\n        requestedQuantity: quantity,\r\n        totalQuantity,\r\n        availableStock: variant.stock\r\n      });\r\n      throw {\r\n        status: 422,\r\n        type: \"https://api.shop.am/problems/validation-error\",\r\n        title: \"Insufficient stock\",\r\n        detail: `No more stock available. Maximum available: ${variant.stock}, already in cart: ${existingItem?.quantity || 0}, requested: ${quantity}`,\r\n      };\r\n    }\r\n\r\n    let item;\r\n    if (existingItem) {\r\n      console.log('âœ… [CART SERVICE] Updating existing cart item:', {\r\n        itemId: existingItem.id,\r\n        oldQuantity: existingItem.quantity,\r\n        newQuantity: totalQuantity,\r\n        variantStock: variant.stock\r\n      });\r\n      item = await db.cartItem.update({\r\n        where: { id: existingItem.id },\r\n        data: {\r\n          quantity: totalQuantity,\r\n        },\r\n      });\r\n    } else {\r\n      console.log('âœ… [CART SERVICE] Creating new cart item:', {\r\n        variantId,\r\n        quantity,\r\n        variantStock: variant.stock\r\n      });\r\n      item = await db.cartItem.create({\r\n        data: {\r\n          cartId: cart.id,\r\n          variantId,\r\n          productId,\r\n          quantity,\r\n          priceSnapshot: variant.price,\r\n        },\r\n      });\r\n    }\r\n\r\n    return {\r\n      item: {\r\n        id: item.id,\r\n        variantId: variantId,\r\n        quantity: item.quantity,\r\n        price: Number(item.priceSnapshot),\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Update cart item\r\n   */\r\n  async updateItem(userId: string, itemId: string, quantity: number) {\r\n    if (!quantity || quantity < 1) {\r\n      throw {\r\n        status: 400,\r\n        type: \"https://api.shop.am/problems/validation-error\",\r\n        title: \"Validation failed\",\r\n        detail: \"quantity must be at least 1\",\r\n      };\r\n    }\r\n\r\n    const cart = await db.cart.findFirst({\r\n      where: {\r\n        userId,\r\n        items: {\r\n          some: {\r\n            id: itemId,\r\n          },\r\n        },\r\n      },\r\n      include: {\r\n        items: {\r\n          where: { id: itemId },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!cart || cart.items.length === 0) {\r\n      throw {\r\n        status: 404,\r\n        type: \"https://api.shop.am/problems/not-found\",\r\n        title: \"Cart item not found\",\r\n      };\r\n    }\r\n\r\n    const item = cart.items[0];\r\n    const variant = await db.productVariant.findUnique({\r\n      where: { id: item.variantId },\r\n    });\r\n\r\n    if (!variant || variant.stock < quantity) {\r\n      throw {\r\n        status: 422,\r\n        type: \"https://api.shop.am/problems/validation-error\",\r\n        title: \"Insufficient stock\",\r\n        detail: `Requested quantity (${quantity}) exceeds available stock (${variant?.stock || 0})`,\r\n      };\r\n    }\r\n\r\n    const updatedItem = await db.cartItem.update({\r\n      where: { id: itemId },\r\n      data: { quantity },\r\n    });\r\n\r\n    return {\r\n      item: {\r\n        id: updatedItem.id,\r\n        quantity: updatedItem.quantity,\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Remove item from cart\r\n   */\r\n  async removeItem(userId: string, itemId: string) {\r\n    const cart = await db.cart.findFirst({\r\n      where: {\r\n        userId,\r\n        items: {\r\n          some: {\r\n            id: itemId,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!cart) {\r\n      throw {\r\n        status: 404,\r\n        type: \"https://api.shop.am/problems/not-found\",\r\n        title: \"Cart item not found\",\r\n      };\r\n    }\r\n\r\n    await db.cartItem.delete({\r\n      where: { id: itemId },\r\n    });\r\n\r\n    return null;\r\n  }\r\n}\r\n\r\nexport const cartService = new CartService();\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEA,MAAM;IACJ;;GAEC,GACD,MAAM,QAAQ,MAAc,EAAE,SAAiB,IAAI,EAAE;QACnD,wBAAwB;QACxB,MAAM,mBAAmB,MAAM,gIAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC;YAClD,OAAO;gBACL,KAAK;oBACH,IAAI;wBAAC;wBAAkB;wBAAqB;qBAAiB;gBAC/D;YACF;QACF;QAEA,MAAM,iBACJ,OACE,iBAAiB,IAAI,CAAC,CAAC,IAAuC,EAAE,GAAG,KAAK,mBAAmB,UACxF;QAEP,MAAM,2BAA2B,iBAAiB,IAAI,CAAC,CAAC,IAAuC,EAAE,GAAG,KAAK;QACzG,MAAM,oBAAoB,2BAA2B,AAAC,yBAAyB,KAAK,IAA+B,CAAC,IAAI,CAAC;QAEzH,MAAM,wBAAwB,iBAAiB,IAAI,CAAC,CAAC,IAAuC,EAAE,GAAG,KAAK;QACtG,MAAM,iBAAiB,wBAAwB,AAAC,sBAAsB,KAAK,IAA+B,CAAC,IAAI,CAAC;QAChH,IAAI,OAAO,MAAM,gIAAE,CAAC,IAAI,CAAC,SAAS,CAAC;YACjC,OAAO;gBACL;YACF;YACA,SAAS;gBACP,OAAO;oBACL,SAAS;wBACP,SAAS;4BACP,SAAS;gCACP,SAAS;oCACP,SAAS;wCACP,cAAc;oCAChB;gCACF;4BACF;wBACF;wBACA,SAAS;4BACP,SAAS;gCACP,cAAc;4BAChB;wBACF;oBACF;gBACF;YACF;QACF;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,MAAM,gIAAE,CAAC,IAAI,CAAC,MAAM,CAAC;gBAC1B,MAAM;oBACJ;oBACA;oBACA,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK,KAAK;oBACrD,OAAO;wBACL,QAAQ,EAAE;oBACZ;gBACF;gBACA,SAAS;oBACP,OAAO;wBACL,SAAS;4BACP,SAAS;gCACP,SAAS;oCACP,SAAS;wCACP,SAAS;4CACP,cAAc;wCAChB;oCACF;gCACF;4BACF;4BACA,SAAS;gCACP,SAAS;oCACP,cAAc;gCAChB;4BACF;wBACF;oBACF;gBACF;YACF;QACF;QAEA,4BAA4B;QAC5B,MAAM,mBAAmB,MAAM,QAAQ,GAAG,CACxC,KAAK,KAAK,CAAC,GAAG,CAAC,OAAO;YAMpB,MAAM,UAAU,MAAM,gIAAE,CAAC,OAAO,CAAC,UAAU,CAAC;gBAC1C,OAAO;oBAAE,IAAI,KAAK,SAAS;gBAAC;gBAC5B,SAAS;oBACP,cAAc;oBACd,UAAU;wBACR,OAAO;4BAAE,IAAI,KAAK,SAAS;wBAAC;oBAC9B;gBACF;YACF;YAEA,MAAM,UAAU,SAAS,QAAQ,CAAC,EAAE;YACpC,MAAM,cACJ,SAAS,aAAa,KAAK,CAAC,IAA0B,EAAE,MAAM,KAAK,WACnE,SAAS,YAAY,CAAC,EAAE;YAE1B,IAAI,WAAW;YACf,IAAI,SAAS,SAAS,MAAM,OAAO,CAAC,QAAQ,KAAK,KAAK,QAAQ,KAAK,CAAC,MAAM,GAAG,GAAG;gBAC9E,MAAM,aAAa,QAAQ,KAAK,CAAC,EAAE;gBACnC,IAAI,OAAO,eAAe,UAAU;oBAClC,WAAW;gBACb,OAAO,IAAK,YAAoB,KAAK;oBACnC,WAAW,AAAC,WAAmB,GAAG;gBACpC,OAAO,IAAK,YAAoB,KAAK;oBACnC,WAAW,AAAC,WAAmB,GAAG;gBACpC;YACF;YAEA,wCAAwC;YACxC,gFAAgF;YAChF,MAAM,kBAAkB,SAAS,mBAAmB;YACpD,IAAI,kBAAkB;YACtB,IAAI,kBAAkB,GAAG;gBACvB,kBAAkB;YACpB,OAAO;gBACL,2BAA2B;gBAC3B,MAAM,oBAAoB,SAAS;gBACnC,IAAI,qBAAqB,iBAAiB,CAAC,kBAAkB,EAAE;oBAC7D,kBAAkB,iBAAiB,CAAC,kBAAkB;gBACxD,OAAO;oBACL,wBAAwB;oBACxB,MAAM,UAAU,SAAS;oBACzB,IAAI,WAAW,cAAc,CAAC,QAAQ,EAAE;wBACtC,kBAAkB,cAAc,CAAC,QAAQ;oBAC3C,OAAO,IAAI,iBAAiB,GAAG;wBAC7B,kBAAkB;oBACpB;gBACF;YACF;YAEA,6EAA6E;YAC7E,gFAAgF;YAChF,MAAM,uBAAuB,SAAS,SAAS;YAC/C,IAAI,aAAa;YACjB,IAAI,gBAA+B;YAEnC,IAAI,kBAAkB,KAAK,uBAAuB,GAAG;gBACnD,kDAAkD;gBAClD,aAAa,uBAAuB,CAAC,IAAI,kBAAkB,GAAG;gBAC9D,gBAAgB;YAClB,OAAO,IAAI,SAAS,kBAAkB,QAAQ,cAAc,GAAG,sBAAsB;gBACnF,gBAAgB,OAAO,QAAQ,cAAc;YAC/C;YAEA,OAAO;gBACL,IAAI,KAAK,EAAE;gBACX,SAAS;oBACP,IAAI,SAAS,MAAM,KAAK,SAAS;oBACjC,KAAK,SAAS,OAAO;oBACrB,OAAO,SAAS,SAAS;oBACzB,SAAS;wBACP,IAAI,SAAS,MAAM;wBACnB,OAAO,aAAa,SAAS;wBAC7B,MAAM,aAAa,QAAQ;wBAC3B,OAAO;oBACT;gBACF;gBACA,UAAU,KAAK,QAAQ;gBACvB,OAAO;gBACP,eAAe;gBACf,OAAO,aAAa,KAAK,QAAQ;YACnC;QACF;QAGF,MAAM,WAAW,iBAAiB,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,KAAK,KAAK,EAAE;QAE1E,OAAO;YACL,MAAM;gBACJ,IAAI,KAAK,EAAE;gBACX,OAAO;gBACP,QAAQ;oBACN;oBACA,UAAU;oBACV,UAAU;oBACV,KAAK;oBACL,OAAO;oBACP,UAAU;gBACZ;gBACA,YAAY,iBAAiB,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,KAAK,QAAQ,EAAE;YAC1E;QACF;IACF;IAEA;;GAEC,GACD,MAAM,QACJ,MAAc,EACd,IAAiE,EACjE,SAAiB,IAAI,EACrB;QACA,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,WAAW,CAAC,EAAE,GAAG;QAE/C,IAAI,CAAC,aAAa,CAAC,WAAW;YAC5B,MAAM;gBACJ,QAAQ;gBACR,MAAM;gBACN,OAAO;gBACP,QAAQ;YACV;QACF;QAEA,qBAAqB;QACrB,IAAI,OAAO,MAAM,gIAAE,CAAC,IAAI,CAAC,SAAS,CAAC;YACjC,OAAO;gBAAE;YAAO;YAChB,SAAS;gBAAE,OAAO;YAAK;QACzB;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,MAAM,gIAAE,CAAC,IAAI,CAAC,MAAM,CAAC;gBAC1B,MAAM;oBACJ;oBACA;oBACA,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK,KAAK;oBACrD,OAAO;wBACL,QAAQ,EAAE;oBACZ;gBACF;gBACA,SAAS;oBAAE,OAAO;gBAAK;YACzB;QACF;QAEA,cAAc;QACd,MAAM,UAAU,MAAM,gIAAE,CAAC,cAAc,CAAC,UAAU,CAAC;YACjD,OAAO;gBAAE,IAAI;YAAU;YACvB,SAAS;gBACP,SAAS;YACX;QACF;QAEA,IAAI,CAAC,WAAW,CAAC,QAAQ,SAAS,IAAI,QAAQ,SAAS,KAAK,WAAW;YACrE,MAAM;gBACJ,QAAQ;gBACR,MAAM;gBACN,OAAO;YACT;QACF;QAEA,+BAA+B;QAC/B,MAAM,eAAe,KAAK,KAAK,CAAC,IAAI,CAAC,CAAC,OAAgC,KAAK,SAAS,KAAK;QAEzF,6DAA6D;QAC7D,MAAM,gBAAgB,eAAe,aAAa,QAAQ,GAAG,WAAW;QAExE,kDAAkD;QAClD,IAAI,gBAAgB,QAAQ,KAAK,EAAE;YACjC,QAAQ,GAAG,CAAC,2CAA2C;gBACrD;gBACA,eAAe,cAAc,YAAY;gBACzC,mBAAmB;gBACnB;gBACA,gBAAgB,QAAQ,KAAK;YAC/B;YACA,MAAM;gBACJ,QAAQ;gBACR,MAAM;gBACN,OAAO;gBACP,QAAQ,CAAC,4CAA4C,EAAE,QAAQ,KAAK,CAAC,mBAAmB,EAAE,cAAc,YAAY,EAAE,aAAa,EAAE,UAAU;YACjJ;QACF;QAEA,IAAI;QACJ,IAAI,cAAc;YAChB,QAAQ,GAAG,CAAC,iDAAiD;gBAC3D,QAAQ,aAAa,EAAE;gBACvB,aAAa,aAAa,QAAQ;gBAClC,aAAa;gBACb,cAAc,QAAQ,KAAK;YAC7B;YACA,OAAO,MAAM,gIAAE,CAAC,QAAQ,CAAC,MAAM,CAAC;gBAC9B,OAAO;oBAAE,IAAI,aAAa,EAAE;gBAAC;gBAC7B,MAAM;oBACJ,UAAU;gBACZ;YACF;QACF,OAAO;YACL,QAAQ,GAAG,CAAC,4CAA4C;gBACtD;gBACA;gBACA,cAAc,QAAQ,KAAK;YAC7B;YACA,OAAO,MAAM,gIAAE,CAAC,QAAQ,CAAC,MAAM,CAAC;gBAC9B,MAAM;oBACJ,QAAQ,KAAK,EAAE;oBACf;oBACA;oBACA;oBACA,eAAe,QAAQ,KAAK;gBAC9B;YACF;QACF;QAEA,OAAO;YACL,MAAM;gBACJ,IAAI,KAAK,EAAE;gBACX,WAAW;gBACX,UAAU,KAAK,QAAQ;gBACvB,OAAO,OAAO,KAAK,aAAa;YAClC;QACF;IACF;IAEA;;GAEC,GACD,MAAM,WAAW,MAAc,EAAE,MAAc,EAAE,QAAgB,EAAE;QACjE,IAAI,CAAC,YAAY,WAAW,GAAG;YAC7B,MAAM;gBACJ,QAAQ;gBACR,MAAM;gBACN,OAAO;gBACP,QAAQ;YACV;QACF;QAEA,MAAM,OAAO,MAAM,gIAAE,CAAC,IAAI,CAAC,SAAS,CAAC;YACnC,OAAO;gBACL;gBACA,OAAO;oBACL,MAAM;wBACJ,IAAI;oBACN;gBACF;YACF;YACA,SAAS;gBACP,OAAO;oBACL,OAAO;wBAAE,IAAI;oBAAO;gBACtB;YACF;QACF;QAEA,IAAI,CAAC,QAAQ,KAAK,KAAK,CAAC,MAAM,KAAK,GAAG;YACpC,MAAM;gBACJ,QAAQ;gBACR,MAAM;gBACN,OAAO;YACT;QACF;QAEA,MAAM,OAAO,KAAK,KAAK,CAAC,EAAE;QAC1B,MAAM,UAAU,MAAM,gIAAE,CAAC,cAAc,CAAC,UAAU,CAAC;YACjD,OAAO;gBAAE,IAAI,KAAK,SAAS;YAAC;QAC9B;QAEA,IAAI,CAAC,WAAW,QAAQ,KAAK,GAAG,UAAU;YACxC,MAAM;gBACJ,QAAQ;gBACR,MAAM;gBACN,OAAO;gBACP,QAAQ,CAAC,oBAAoB,EAAE,SAAS,2BAA2B,EAAE,SAAS,SAAS,EAAE,CAAC,CAAC;YAC7F;QACF;QAEA,MAAM,cAAc,MAAM,gIAAE,CAAC,QAAQ,CAAC,MAAM,CAAC;YAC3C,OAAO;gBAAE,IAAI;YAAO;YACpB,MAAM;gBAAE;YAAS;QACnB;QAEA,OAAO;YACL,MAAM;gBACJ,IAAI,YAAY,EAAE;gBAClB,UAAU,YAAY,QAAQ;YAChC;QACF;IACF;IAEA;;GAEC,GACD,MAAM,WAAW,MAAc,EAAE,MAAc,EAAE;QAC/C,MAAM,OAAO,MAAM,gIAAE,CAAC,IAAI,CAAC,SAAS,CAAC;YACnC,OAAO;gBACL;gBACA,OAAO;oBACL,MAAM;wBACJ,IAAI;oBACN;gBACF;YACF;QACF;QAEA,IAAI,CAAC,MAAM;YACT,MAAM;gBACJ,QAAQ;gBACR,MAAM;gBACN,OAAO;YACT;QACF;QAEA,MAAM,gIAAE,CAAC,QAAQ,CAAC,MAAM,CAAC;YACvB,OAAO;gBAAE,IAAI;YAAO;QACtB;QAEA,OAAO;IACT;AACF;AAEO,MAAM,cAAc,IAAI"}},
    {"offset": {"line": 571, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/white%20shop/White-Shop-templete/WhiteShop-Template/apps/web/app/api/v1/cart/items/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { authenticateToken } from \"@/lib/middleware/auth\";\r\nimport { cartService } from \"@/lib/services/cart.service\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const user = await authenticateToken(req);\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        {\r\n          type: \"https://api.shop.am/problems/unauthorized\",\r\n          title: \"Unauthorized\",\r\n          status: 401,\r\n          detail: \"Authentication token required\",\r\n          instance: req.url,\r\n        },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const data = await req.json();\r\n    const result = await cartService.addItem(user.id, data, user.locale);\r\n    return NextResponse.json(result, { status: 201 });\r\n  } catch (error: any) {\r\n    console.error(\"âŒ [CART] Error:\", error);\r\n    return NextResponse.json(\r\n      {\r\n        type: error.type || \"https://api.shop.am/problems/internal-error\",\r\n        title: error.title || \"Internal Server Error\",\r\n        status: error.status || 500,\r\n        detail: error.detail || error.message || \"An error occurred\",\r\n        instance: req.url,\r\n      },\r\n      { status: error.status || 500 }\r\n    );\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,+JAAiB,EAAC;QACrC,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,MAAM;gBACN,OAAO;gBACP,QAAQ;gBACR,QAAQ;gBACR,UAAU,IAAI,GAAG;YACnB,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,SAAS,MAAM,kKAAW,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE,MAAM,KAAK,MAAM;QACnE,OAAO,gJAAY,CAAC,IAAI,CAAC,QAAQ;YAAE,QAAQ;QAAI;IACjD,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,MAAM,MAAM,IAAI,IAAI;YACpB,OAAO,MAAM,KAAK,IAAI;YACtB,QAAQ,MAAM,MAAM,IAAI;YACxB,QAAQ,MAAM,MAAM,IAAI,MAAM,OAAO,IAAI;YACzC,UAAU,IAAI,GAAG;QACnB,GACA;YAAE,QAAQ,MAAM,MAAM,IAAI;QAAI;IAElC;AACF"}}]
}