{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/white%20shop/White-Shop-templete/WhiteShop-Template/packages/db/client.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as any;\n\n// Ensure UTF-8 encoding for PostgreSQL connection\n// This fixes encoding issues with Armenian and other UTF-8 characters\nconst databaseUrl = process.env.DATABASE_URL || '';\nlet urlWithEncoding = databaseUrl;\n\nif (!databaseUrl.includes('client_encoding')) {\n  urlWithEncoding = databaseUrl.includes('?') \n    ? `${databaseUrl}&client_encoding=UTF8`\n    : `${databaseUrl}?client_encoding=UTF8`;\n  \n  // Temporarily override DATABASE_URL for Prisma Client\n  process.env.DATABASE_URL = urlWithEncoding;\n}\n\nexport const db =\n  globalForPrisma.prisma ??\n  new PrismaClient({ \n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"error\", \"warn\"] : [\"error\"],\n    errorFormat: \"pretty\",\n  });\n\n// Prisma Client connects automatically on first query (lazy connection)\n// No need to call $connect() explicitly as it can cause issues in Next.js API routes\n// Connection will be established automatically when the first database query is made\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = db;\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAExB,kDAAkD;AAClD,sEAAsE;AACtE,MAAM,cAAc,QAAQ,GAAG,CAAC,YAAY,IAAI;AAChD,IAAI,kBAAkB;AAEtB,IAAI,CAAC,YAAY,QAAQ,CAAC,oBAAoB;IAC5C,kBAAkB,YAAY,QAAQ,CAAC,OACnC,GAAG,YAAY,qBAAqB,CAAC,GACrC,GAAG,YAAY,qBAAqB,CAAC;IAEzC,sDAAsD;IACtD,QAAQ,GAAG,CAAC,YAAY,GAAG;AAC7B;AAEO,MAAM,KACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;IAC3E,aAAa;AACf;AAEF,wEAAwE;AACxE,qFAAqF;AACrF,qFAAqF;AAErF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/white%20shop/White-Shop-templete/WhiteShop-Template/packages/db/index.ts"],"sourcesContent":["export * from \"./client\";\r\n\r\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/white%20shop/White-Shop-templete/WhiteShop-Template/apps/web/lib/middleware/auth.ts"],"sourcesContent":["import { NextRequest } from \"next/server\";\r\nimport * as jwt from \"jsonwebtoken\";\r\nimport { db } from \"@white-shop/db\";\r\n\r\nexport interface AuthUser {\r\n  id: string;\r\n  email: string | null;\r\n  phone: string | null;\r\n  locale: string;\r\n  roles: string[];\r\n}\r\n\r\n/**\r\n * Authenticate JWT token from request headers\r\n */\r\nexport async function authenticateToken(\r\n  request: NextRequest\r\n): Promise<AuthUser | null> {\r\n  try {\r\n    const authHeader = request.headers.get(\"authorization\");\r\n    const token = authHeader?.split(\" \")[1]; // Bearer TOKEN\r\n\r\n    if (!token) {\r\n      return null;\r\n    }\r\n\r\n    if (!process.env.JWT_SECRET) {\r\n      console.error(\"❌ [AUTH] JWT_SECRET is not set!\");\r\n      return null;\r\n    }\r\n\r\n    const decoded = jwt.verify(token, process.env.JWT_SECRET) as {\r\n      userId: string;\r\n    };\r\n\r\n    const user = await db.user.findUnique({\r\n      where: { id: decoded.userId },\r\n      select: {\r\n        id: true,\r\n        email: true,\r\n        phone: true,\r\n        locale: true,\r\n        roles: true,\r\n        blocked: true,\r\n        deletedAt: true,\r\n      },\r\n    });\r\n\r\n    if (!user || user.blocked || user.deletedAt) {\r\n      return null;\r\n    }\r\n\r\n    return {\r\n      id: user.id,\r\n      email: user.email,\r\n      phone: user.phone,\r\n      locale: user.locale,\r\n      roles: user.roles,\r\n    };\r\n  } catch (error) {\r\n    if (\r\n      error instanceof jwt.JsonWebTokenError ||\r\n      error instanceof jwt.TokenExpiredError\r\n    ) {\r\n      return null;\r\n    }\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Check if user is admin\r\n */\r\nexport function requireAdmin(user: AuthUser | null): boolean {\r\n  if (!user) {\r\n    return false;\r\n  }\r\n  return user.roles.includes(\"admin\");\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AACA;AACA;AAAA;;;AAaO,eAAe,kBACpB,OAAoB;IAEpB,IAAI;QACF,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,MAAM,QAAQ,YAAY,MAAM,IAAI,CAAC,EAAE,EAAE,eAAe;QAExD,IAAI,CAAC,OAAO;YACV,OAAO;QACT;QAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,UAAU,EAAE;YAC3B,QAAQ,KAAK,CAAC;YACd,OAAO;QACT;QAEA,MAAM,UAAU,iJAAU,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;QAIxD,MAAM,OAAO,MAAM,gIAAE,CAAC,IAAI,CAAC,UAAU,CAAC;YACpC,OAAO;gBAAE,IAAI,QAAQ,MAAM;YAAC;YAC5B,QAAQ;gBACN,IAAI;gBACJ,OAAO;gBACP,OAAO;gBACP,QAAQ;gBACR,OAAO;gBACP,SAAS;gBACT,WAAW;YACb;QACF;QAEA,IAAI,CAAC,QAAQ,KAAK,OAAO,IAAI,KAAK,SAAS,EAAE;YAC3C,OAAO;QACT;QAEA,OAAO;YACL,IAAI,KAAK,EAAE;YACX,OAAO,KAAK,KAAK;YACjB,OAAO,KAAK,KAAK;YACjB,QAAQ,KAAK,MAAM;YACnB,OAAO,KAAK,KAAK;QACnB;IACF,EAAE,OAAO,OAAO;QACd,IACE,iBAAiB,4JAAqB,IACtC,iBAAiB,4JAAqB,EACtC;YACA,OAAO;QACT;QACA,MAAM;IACR;AACF;AAKO,SAAS,aAAa,IAAqB;IAChD,IAAI,CAAC,MAAM;QACT,OAAO;IACT;IACA,OAAO,KAAK,KAAK,CAAC,QAAQ,CAAC;AAC7B"}},
    {"offset": {"line": 179, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/white%20shop/White-Shop-templete/WhiteShop-Template/apps/web/lib/services/users.service.ts"],"sourcesContent":["import { db } from \"@white-shop/db\";\r\nimport * as bcrypt from \"bcryptjs\";\r\n\r\nclass UsersService {\r\n  /**\r\n   * Get user profile\r\n   */\r\n  async getProfile(userId: string) {\r\n    const user = await db.user.findUnique({\r\n      where: { id: userId },\r\n      select: {\r\n        id: true,\r\n        email: true,\r\n        phone: true,\r\n        firstName: true,\r\n        lastName: true,\r\n        locale: true,\r\n        roles: true,\r\n        addresses: true,\r\n      },\r\n    });\r\n\r\n    if (!user) {\r\n      throw {\r\n        status: 404,\r\n        type: \"https://api.shop.am/problems/not-found\",\r\n        title: \"User not found\",\r\n      };\r\n    }\r\n\r\n    return {\r\n      id: user.id,\r\n      email: user.email,\r\n      phone: user.phone,\r\n      firstName: user.firstName,\r\n      lastName: user.lastName,\r\n      locale: user.locale,\r\n      roles: user.roles,\r\n      addresses: user.addresses,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Update user profile\r\n   */\r\n  async updateProfile(userId: string, data: any) {\r\n    const user = await db.user.update({\r\n      where: { id: userId },\r\n      data: {\r\n        firstName: data.firstName,\r\n        lastName: data.lastName,\r\n        locale: data.locale,\r\n      },\r\n      select: {\r\n        id: true,\r\n        email: true,\r\n        phone: true,\r\n        firstName: true,\r\n        lastName: true,\r\n        locale: true,\r\n      },\r\n    });\r\n\r\n    return {\r\n      id: user.id,\r\n      email: user.email,\r\n      phone: user.phone,\r\n      firstName: user.firstName,\r\n      lastName: user.lastName,\r\n      locale: user.locale,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Change password\r\n   */\r\n  async changePassword(userId: string, oldPassword: string, newPassword: string) {\r\n    // Validate input parameters\r\n    if (!oldPassword || typeof oldPassword !== 'string' || oldPassword.trim() === '') {\r\n      throw {\r\n        status: 400,\r\n        type: \"https://api.shop.am/problems/validation-error\",\r\n        title: \"Validation Error\",\r\n        detail: \"Old password is required and must be a non-empty string\",\r\n      };\r\n    }\r\n\r\n    if (!newPassword || typeof newPassword !== 'string' || newPassword.trim() === '') {\r\n      throw {\r\n        status: 400,\r\n        type: \"https://api.shop.am/problems/validation-error\",\r\n        title: \"Validation Error\",\r\n        detail: \"New password is required and must be a non-empty string\",\r\n      };\r\n    }\r\n\r\n    const user = await db.user.findUnique({\r\n      where: { id: userId },\r\n      select: {\r\n        id: true,\r\n        passwordHash: true,\r\n      },\r\n    });\r\n\r\n    if (!user || !user.passwordHash) {\r\n      throw {\r\n        status: 401,\r\n        type: \"https://api.shop.am/problems/unauthorized\",\r\n        title: \"Invalid credentials\",\r\n        detail: \"User not found or password not set\",\r\n      };\r\n    }\r\n\r\n    // Validate that passwordHash is a valid string\r\n    if (typeof user.passwordHash !== 'string' || user.passwordHash.trim() === '') {\r\n      throw {\r\n        status: 500,\r\n        type: \"https://api.shop.am/problems/internal-error\",\r\n        title: \"Internal Server Error\",\r\n        detail: \"User password hash is invalid\",\r\n      };\r\n    }\r\n\r\n    try {\r\n      const isValid = await bcrypt.compare(oldPassword.trim(), user.passwordHash);\r\n      if (!isValid) {\r\n        throw {\r\n          status: 401,\r\n          type: \"https://api.shop.am/problems/unauthorized\",\r\n          title: \"Invalid password\",\r\n          detail: \"The old password is incorrect\",\r\n        };\r\n      }\r\n    } catch (bcryptError: any) {\r\n      // Handle bcrypt errors\r\n      console.error(\"❌ [USERS SERVICE] bcrypt.compare error:\", {\r\n        error: bcryptError,\r\n        message: bcryptError?.message,\r\n        userId,\r\n        hasOldPassword: !!oldPassword,\r\n        hasPasswordHash: !!user.passwordHash,\r\n      });\r\n      throw {\r\n        status: 500,\r\n        type: \"https://api.shop.am/problems/internal-error\",\r\n        title: \"Internal Server Error\",\r\n        detail: \"Failed to verify password\",\r\n      };\r\n    }\r\n\r\n    try {\r\n      const newPasswordHash = await bcrypt.hash(newPassword.trim(), 10);\r\n      await db.user.update({\r\n        where: { id: userId },\r\n        data: { passwordHash: newPasswordHash },\r\n        select: { id: true },\r\n      });\r\n\r\n      return { success: true };\r\n    } catch (hashError: any) {\r\n      console.error(\"❌ [USERS SERVICE] bcrypt.hash error:\", {\r\n        error: hashError,\r\n        message: hashError?.message,\r\n        userId,\r\n      });\r\n      throw {\r\n        status: 500,\r\n        type: \"https://api.shop.am/problems/internal-error\",\r\n        title: \"Internal Server Error\",\r\n        detail: \"Failed to hash new password\",\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get addresses\r\n   */\r\n  async getAddresses(userId: string) {\r\n    const addresses = await db.address.findMany({\r\n      where: { userId },\r\n      orderBy: { isDefault: \"desc\" },\r\n    });\r\n\r\n    return { data: addresses };\r\n  }\r\n\r\n  /**\r\n   * Add address\r\n   */\r\n  async addAddress(userId: string, data: any) {\r\n    // If this is the first address, set it as default\r\n    const existingAddresses = await db.address.findMany({\r\n      where: { userId },\r\n    });\r\n\r\n    const address = await db.address.create({\r\n      data: {\r\n        ...data,\r\n        userId,\r\n        isDefault: existingAddresses.length === 0,\r\n      },\r\n    });\r\n\r\n    return address;\r\n  }\r\n\r\n  /**\r\n   * Update address\r\n   */\r\n  async updateAddress(userId: string, addressId: string, data: any) {\r\n    const address = await db.address.findFirst({\r\n      where: { id: addressId, userId },\r\n    });\r\n\r\n    if (!address) {\r\n      throw {\r\n        status: 404,\r\n        type: \"https://api.shop.am/problems/not-found\",\r\n        title: \"Address not found\",\r\n      };\r\n    }\r\n\r\n    return await db.address.update({\r\n      where: { id: addressId },\r\n      data,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Delete address\r\n   */\r\n  async deleteAddress(userId: string, addressId: string) {\r\n    const address = await db.address.findFirst({\r\n      where: { id: addressId, userId },\r\n    });\r\n\r\n    if (!address) {\r\n      throw {\r\n        status: 404,\r\n        type: \"https://api.shop.am/problems/not-found\",\r\n        title: \"Address not found\",\r\n      };\r\n    }\r\n\r\n    await db.address.delete({\r\n      where: { id: addressId },\r\n    });\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Set default address\r\n   */\r\n  async setDefaultAddress(userId: string, addressId: string) {\r\n    // Unset all other default addresses\r\n    await db.address.updateMany({\r\n      where: { userId, isDefault: true },\r\n      data: { isDefault: false },\r\n    });\r\n\r\n    // Set this one as default\r\n    return await db.address.update({\r\n      where: { id: addressId },\r\n      data: { isDefault: true },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get user dashboard statistics\r\n   */\r\n  async getDashboard(userId: string) {\r\n    // Get all orders for the user\r\n    const orders = await db.order.findMany({\r\n      where: { userId },\r\n      include: {\r\n        items: true,\r\n      },\r\n      orderBy: { createdAt: \"desc\" },\r\n    });\r\n\r\n    // Calculate statistics\r\n    const totalOrders = orders.length;\r\n    const pendingOrders = orders.filter((o: { status: string }) => o.status === \"pending\").length;\r\n    const completedOrders = orders.filter((o: { status: string }) => o.status === \"completed\").length;\r\n    const totalSpent = orders\r\n      .filter((o: { status: string; paymentStatus: string }) => o.status === \"completed\" || o.paymentStatus === \"paid\")\r\n      .reduce((sum: number, o: { total: number }) => sum + o.total, 0);\r\n\r\n    // Count addresses\r\n    const addressesCount = await db.address.count({\r\n      where: { userId },\r\n    });\r\n\r\n    // Count orders by status\r\n    const ordersByStatus: Record<string, number> = {};\r\n    orders.forEach((order: { status: string }) => {\r\n      ordersByStatus[order.status] = (ordersByStatus[order.status] || 0) + 1;\r\n    });\r\n\r\n    // Get recent orders (last 5)\r\n    const recentOrders = orders.slice(0, 5).map((order: { id: string; number: string; status: string; paymentStatus: string; fulfillmentStatus: string; total: number; subtotal: number; discountAmount: number; shippingAmount: number; taxAmount: number; currency: string | null; createdAt: Date; items: Array<unknown> }) => ({\r\n      id: order.id,\r\n      number: order.number,\r\n      status: order.status,\r\n      paymentStatus: order.paymentStatus,\r\n      fulfillmentStatus: order.fulfillmentStatus,\r\n      total: order.total,\r\n      subtotal: order.subtotal,\r\n      discountAmount: order.discountAmount,\r\n      shippingAmount: order.shippingAmount,\r\n      taxAmount: order.taxAmount,\r\n      currency: order.currency,\r\n      itemsCount: order.items.length,\r\n      createdAt: order.createdAt.toISOString(),\r\n    }));\r\n\r\n    return {\r\n      stats: {\r\n        totalOrders,\r\n        pendingOrders,\r\n        completedOrders,\r\n        totalSpent,\r\n        addressesCount,\r\n        ordersByStatus,\r\n      },\r\n      recentOrders,\r\n    };\r\n  }\r\n}\r\n\r\nexport const usersService = new UsersService();\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 524, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/white%20shop/White-Shop-templete/WhiteShop-Template/apps/web/app/api/v1/users/profile/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { authenticateToken } from \"@/lib/middleware/auth\";\r\nimport { usersService } from \"@/lib/services/users.service\";\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const user = await authenticateToken(req);\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        {\r\n          type: \"https://api.shop.am/problems/unauthorized\",\r\n          title: \"Unauthorized\",\r\n          status: 401,\r\n          detail: \"Authentication token required\",\r\n          instance: req.url,\r\n        },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const result = await usersService.getProfile(user.id);\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error(\"❌ [USERS] Error:\", error);\r\n    return NextResponse.json(\r\n      {\r\n        type: error.type || \"https://api.shop.am/problems/internal-error\",\r\n        title: error.title || \"Internal Server Error\",\r\n        status: error.status || 500,\r\n        detail: error.detail || error.message || \"An error occurred\",\r\n        instance: req.url,\r\n      },\r\n      { status: error.status || 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function PUT(req: NextRequest) {\r\n  try {\r\n    const user = await authenticateToken(req);\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        {\r\n          type: \"https://api.shop.am/problems/unauthorized\",\r\n          title: \"Unauthorized\",\r\n          status: 401,\r\n          detail: \"Authentication token required\",\r\n          instance: req.url,\r\n        },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const data = await req.json();\r\n    const result = await usersService.updateProfile(user.id, data);\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error(\"❌ [USERS] Error:\", error);\r\n    return NextResponse.json(\r\n      {\r\n        type: error.type || \"https://api.shop.am/problems/internal-error\",\r\n        title: error.title || \"Internal Server Error\",\r\n        status: error.status || 500,\r\n        detail: error.detail || error.message || \"An error occurred\",\r\n        instance: req.url,\r\n      },\r\n      { status: error.status || 500 }\r\n    );\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,+JAAiB,EAAC;QACrC,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,MAAM;gBACN,OAAO;gBACP,QAAQ;gBACR,QAAQ;gBACR,UAAU,IAAI,GAAG;YACnB,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS,MAAM,oKAAY,CAAC,UAAU,CAAC,KAAK,EAAE;QACpD,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,MAAM,MAAM,IAAI,IAAI;YACpB,OAAO,MAAM,KAAK,IAAI;YACtB,QAAQ,MAAM,MAAM,IAAI;YACxB,QAAQ,MAAM,MAAM,IAAI,MAAM,OAAO,IAAI;YACzC,UAAU,IAAI,GAAG;QACnB,GACA;YAAE,QAAQ,MAAM,MAAM,IAAI;QAAI;IAElC;AACF;AAEO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,+JAAiB,EAAC;QACrC,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,MAAM;gBACN,OAAO;gBACP,QAAQ;gBACR,QAAQ;gBACR,UAAU,IAAI,GAAG;YACnB,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,SAAS,MAAM,oKAAY,CAAC,aAAa,CAAC,KAAK,EAAE,EAAE;QACzD,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,MAAM,MAAM,IAAI,IAAI;YACpB,OAAO,MAAM,KAAK,IAAI;YACtB,QAAQ,MAAM,MAAM,IAAI;YACxB,QAAQ,MAAM,MAAM,IAAI,MAAM,OAAO,IAAI;YACzC,UAAU,IAAI,GAAG;QACnB,GACA;YAAE,QAAQ,MAAM,MAAM,IAAI;QAAI;IAElC;AACF"}}]
}